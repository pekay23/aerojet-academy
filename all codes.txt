import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';
import NextSteps from '@/components/NextSteps';

export const metadata: Metadata = {
  title: 'Admissions',
};

const documents = [
  "A copy of your Passport or National ID",
  "High School Diploma / WASSCE Certificate",
  "Official Academic Transcripts",
  "Recent passport-sized photograph",
  "Proof of English language proficiency (if applicable)"
];

export default function AdmissionsPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50">
      <Navbar />
      
      <div className="grow">
        <PageHero 
          title="Admissions & Enrollment"
          subtitle="Start your career in aviation with our clear, structured enrollment process."
          backgroundImage="/admissions.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="grid lg:grid-cols-3 gap-16">

            {/* --- Main Content: The Roadmap --- */}
            <div className="lg:col-span-2 space-y-12">
              <div className="bg-white p-8 md:p-12 rounded-3xl shadow-xl border border-slate-100">
                <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-8">
                  Your Path to Enrolment
                </h2>
                
                {/* Verbatim Steps 1-4 from Master Pack */}
                <div className="space-y-10 relative">
                    <div className="absolute left-5 top-2 bottom-2 w-0.5 bg-slate-100 z-0" />
                    
                    <div className="flex gap-6 relative z-10">
                        <div className="shrink-0 w-10 h-10 rounded-full bg-aerojet-sky text-white flex items-center justify-center font-black">1</div>
                        <div>
                            <h3 className="font-bold text-lg text-aerojet-blue">Registration Invoice</h3>
                            <p className="text-sm text-slate-500 leading-relaxed mt-1">We will first issue an invoice for the GHS 350 registration fee. Payment of the registration fee is required before you can complete the online application.</p>
                        </div>
                    </div>

                    <div className="flex gap-6 relative z-10">
                        <div className="shrink-0 w-10 h-10 rounded-full bg-aerojet-sky text-white flex items-center justify-center font-black">2</div>
                        <div>
                            <h3 className="font-bold text-lg text-aerojet-blue">Online Application Form</h3>
                            <p className="text-sm text-slate-500 leading-relaxed mt-1">Once payment is received and you send us confirmation, we will provide a link to complete the online application form for Academy review and approval.</p>
                        </div>
                    </div>

                    <div className="flex gap-6 relative z-10">
                        <div className="shrink-0 w-10 h-10 rounded-full bg-aerojet-sky text-white flex items-center justify-center font-black">3</div>
                        <div>
                            <h3 className="font-bold text-lg text-aerojet-blue">Confirmation Invoice</h3>
                            <p className="text-sm text-slate-500 leading-relaxed mt-1">Upon approval, we will issue an invoice for the Confirmation payment applicable to your selected training program. Once paid, your seat is secured.</p>
                        </div>
                    </div>

                    <div className="flex gap-6 relative z-10">
                        <div className="shrink-0 w-10 h-10 rounded-full bg-aerojet-sky text-white flex items-center justify-center font-black">4</div>
                        <div>
                            <h3 className="font-bold text-lg text-aerojet-blue">Portal Onboarding & Start Date</h3>
                            <p className="text-sm text-slate-500 leading-relaxed mt-1">After confirmation, you will be onboarded onto our student portal. You will receive confirmation of the start date as per the conditions of your course or access to modular learning materials.</p>
                        </div>
                    </div>
                </div>
              </div>

              {/* Simplified NextSteps teaser */}
              <div className="bg-slate-900 rounded-3xl p-8 text-white flex flex-col md:flex-row items-center justify-between gap-6 shadow-2xl">
                  <div>
                    <h4 className="font-black uppercase tracking-widest text-aerojet-sky mb-1">Ready to Start?</h4>
                    <p className="text-blue-100 text-sm">Request your registration fee invoice today.</p>
                  </div>
                  <Link href="/register" className="bg-white text-slate-900 px-8 py-3 rounded-xl font-black uppercase text-xs tracking-widest hover:bg-aerojet-sky hover:text-white transition-all whitespace-nowrap">
                    Start Registration Now
                  </Link>
              </div>
            </div>

            {/* --- Sidebar: Requirements & Checklist --- */}
            <aside className="lg:col-span-1 space-y-8">
              <div className="bg-white p-8 rounded-3xl shadow-lg border-t-4 border-aerojet-sky sticky top-28">
                <h3 className="font-black text-xs uppercase tracking-[0.2em] mb-6 text-slate-400">Document Checklist</h3>
                <p className="text-sm text-slate-600 mb-8 leading-relaxed">Please prepare high-quality digital copies of the following for Step 2 of the process:</p>
                
                <ul className="space-y-4">
                  {documents.map(doc => (
                    <li key={doc} className="flex items-start text-slate-700 text-xs font-bold p-4 bg-slate-50 rounded-2xl border border-slate-100 group hover:border-aerojet-sky transition-colors">
                      <span className="text-green-500 mr-3 text-lg">✓</span>
                      {doc}
                    </li>
                  ))}
                </ul>

                <div className="mt-10 pt-8 border-t border-slate-100">
                    <p className="text-[10px] text-slate-400 uppercase font-black text-center mb-4 tracking-widest">Questions?</p>
                    <Link href="/contact" className="block text-center border-2 border-slate-200 text-slate-600 font-black uppercase text-[10px] tracking-widest py-3 rounded-xl hover:bg-slate-50 transition-all">
                        Contact Admissions
                    </Link>
                </div>
              </div>
            </aside>

          </div>
        </div>
      </div>

      <Footer />
    </main>
  );
}


import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'Entry Requirements',
};

export default function EntryRequirementsPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50">
      <Navbar />
      
      <div className="grow">
        <PageHero 
          title="Entry Requirements"
          subtitle="Ensure you meet the academic and professional criteria for our EASA programmes."
          backgroundImage="/entry1.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="max-w-5xl mx-auto space-y-16">
            
            {/* 1. General & Full-Time Requirements */}
            <section>
                <div className="flex items-center gap-4 mb-8">
                    <div className="w-12 h-1 bg-aerojet-sky rounded-full" />
                    <h2 className="text-2xl font-black text-aerojet-blue uppercase tracking-tight">Full-Time & Crash Courses</h2>
                </div>
                
                <div className="grid md:grid-cols-2 gap-6">
                    <div className="bg-white p-8 rounded-4xl border border-slate-200 shadow-sm">
                        <h3 className="font-bold text-slate-800 mb-2">Age Requirement</h3>
                        <p className="text-sm text-slate-500 leading-relaxed">
                            Applicants must be a minimum of 18 years old at the time of course commencement.
                        </p>
                    </div>

                    <div className="bg-white p-8 rounded-4xl border border-slate-200 shadow-sm">
                        <h3 className="font-bold text-slate-800 mb-2">Academic Background</h3>
                        <p className="text-sm text-slate-500 leading-relaxed">
                            A High School Diploma, WASSCE, or equivalent is required. Strong credits in <b>Mathematics, Physics, and English</b> are highly recommended.
                        </p>
                    </div>

                    <div className="bg-white p-8 rounded-4xl border border-slate-200 shadow-sm">
                        <h3 className="font-bold text-slate-800 mb-2">Language Proficiency</h3>
                        <p className="text-sm text-slate-500 leading-relaxed">
                            All training is conducted in English. Applicants must demonstrate proficiency in reading, writing, and speaking the English language.
                        </p>
                    </div>

                    <div className="bg-white p-8 rounded-4xl border border-slate-200 shadow-sm">
                        <h3 className="font-bold text-slate-800 mb-2">Aptitude Assessment</h3>
                        <p className="text-sm text-slate-500 leading-relaxed">
                            Shortlisted applicants for full-time cohorts must pass an internal aptitude test to assess technical comprehension.
                        </p>
                    </div>
                </div>
            </section>

            {/* 2. Modular & Exam-Only Requirements */}
            <section className="bg-aerojet-blue rounded-[3rem] p-10 md:p-16 text-white shadow-2xl relative overflow-hidden">
                <div className="absolute top-0 right-0 p-10 opacity-10">
                    <svg className="w-40 h-40" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                </div>
                
                <div className="relative z-10">
                    <h2 className="text-2xl font-black uppercase tracking-tight mb-8">Modular & Exam-Only Candidates</h2>
                    <div className="grid md:grid-cols-2 gap-10">
                        <div>
                            <h4 className="font-bold text-aerojet-sky uppercase text-xs tracking-widest mb-3">Professional Standing</h4>
                            <p className="text-blue-100 text-sm leading-relaxed">
                                Self-study and modular candidates are expected to have a foundational understanding of aviation maintenance or be working under an existing MRO framework.
                            </p>
                        </div>
                        <div>
                            <h4 className="font-bold text-aerojet-sky uppercase text-xs tracking-widest mb-3">Identification</h4>
                            <p className="text-blue-100 text-sm leading-relaxed">
                                A valid Passport or National ID is mandatory for all examination bookings to comply with EASA invigilation standards.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            {/* 3. Help / FAQ CTA */}
            <div className="text-center bg-white border border-slate-200 p-12 rounded-[3rem] shadow-sm">
                <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-4">Unsure of your eligibility?</h2>
                <p className="text-slate-500 mb-10 max-w-xl mx-auto font-medium">
                    Our admissions team can provide a preliminary review of your transcripts or professional experience.
                </p>
                <div className="flex flex-col sm:flex-row justify-center gap-4">
                    <Link href="/contact" className="bg-aerojet-sky text-white px-10 py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-aerojet-blue transition-all shadow-lg">
                        Contact Admissions
                    </Link>
                    <Link href="/admissions/fees" className="bg-slate-100 text-slate-600 px-10 py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-slate-200 transition-all">
                        View Payment Rules
                    </Link>
                </div>
            </div>

          </div>
        </div>
      </div>

      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'Fees & Rules',
};

export default function FeesPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50">
      <Navbar />
      
      <div className="grow">
        <PageHero 
          title="Fees & Payment Rules"
          subtitle="Understanding the structured payment milestones for Aerojet Academy training programmes."
          backgroundImage="/feespayment.jpg"
        />
        
        <div className="container mx-auto px-6 py-20">
          <div className="max-w-5xl mx-auto space-y-16">
            
            {/* 1. Mandatory Registration Section */}
            <section className="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-xl border border-slate-100 flex flex-col md:flex-row items-center gap-10">
                <div className="flex-1">
                    <div className="inline-block bg-blue-50 text-aerojet-sky px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest mb-4">Step 01</div>
                    <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-4">Mandatory Registration</h2>
                    <p className="text-slate-500 leading-relaxed font-medium">
                        To initiate your journey, a one-time registration fee is required. This activates your record and unlocks the official application link. This fee covers administrative processing and background verification.
                    </p>
                </div>
                <div className="shrink-0 w-full md:w-auto bg-slate-900 text-white p-8 rounded-3xl text-center shadow-2xl relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-4 opacity-10">
                        <svg className="w-20 h-20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                    </div>
                    <span className="block text-[10px] font-bold text-aerojet-sky uppercase tracking-[0.2em] mb-2">Pre-Application</span>
                    <span className="text-4xl font-black block mb-1">GHS 350.00</span>
                    <span className="text-[10px] text-slate-400 font-medium uppercase tracking-tighter">Strictly Non-Refundable</span>
                </div>
            </section>

            {/* 2. Programme Structure Table */}
            <section>
                <div className="flex items-center gap-4 mb-8">
                    <div className="w-12 h-1 bg-aerojet-sky rounded-full" />
                    <h3 className="text-2xl font-black text-slate-900 uppercase tracking-tight">Payment Milestones</h3>
                </div>
                
                <div className="bg-white border border-slate-200 rounded-4xl overflow-hidden shadow-sm">
                    <div className="overflow-x-auto no-scrollbar">
                        <table className="w-full text-left text-sm min-w-175">
                            <thead className="bg-slate-50 text-slate-400 font-black uppercase text-[10px] tracking-widest border-b border-slate-100">
                                <tr>
                                    <th className="p-6">Option</th>
                                    <th className="p-6">Programme</th>
                                    <th className="p-6">Initial Confirmation</th>
                                    <th className="p-6">Balance Schedule</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-50">
                                {[
                                    { id: "A", name: "Four-Year Full-Time (B1.1 & B2)", deposit: "40% of Year 1", balance: "2 installments per year" },
                                    { id: "B", name: "Two-Year Full-Time (B1.1)", deposit: "40% of Year 1", balance: "2 installments per year" },
                                    { id: "C", name: "12-Month Crash Course", deposit: "40% Total Fee", balance: "2 installments total" },
                                    { id: "D", name: "Modular Training", deposit: "100% per Module", balance: "Pay-as-you-go" },
                                    { id: "E", name: "Examination-Only Seat", deposit: "50% per Exam", balance: "Settled by T-14 days" },
                                    { id: "F", name: "Revision Support", deposit: "100% per Block", balance: "Paid upfront" },
                                ] .map((row) => (
                                    <tr key={row.id} className="hover:bg-slate-50/50 transition-colors">
                                        <td className="p-6 font-black text-aerojet-sky">{row.id}</td>
                                        <td className="p-6 font-bold text-slate-800">{row.name}</td>
                                        <td className="p-6 font-black text-aerojet-blue">{row.deposit}</td>
                                        <td className="p-6 text-slate-500 font-medium text-xs">{row.balance}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div className="mt-6 p-6 bg-blue-50/50 rounded-2xl border border-blue-100/50 text-center">
                    <p className="text-[10px] font-black uppercase tracking-widest text-slate-500">
                        Detailed tuition and exam pricing is visible in the <Link href="/portal/login" className="text-aerojet-sky underline hover:text-aerojet-blue">Student Portal</Link> after registration fee is verified.
                    </p>
                </div>
            </section>

            {/* 3. Refund Rules Card */}
            <section className="max-w-3xl mx-auto">
                <div className="bg-white p-10 md:p-12 rounded-[3rem] shadow-sm border border-slate-200 relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-8 opacity-5">
                        <svg className="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M13 13h-2V7h2v6zm0 4h-2v-2h2v2zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" /></svg>
                    </div>
                    
                    <h3 className="text-xl font-black text-aerojet-blue uppercase tracking-tight mb-8 flex items-center gap-3">
                        <span className="w-2 h-8 bg-red-500 rounded-full" />
                        Refund & Cancellation Rules
                    </h3>
                    
                    <ul className="space-y-6">
                        <li className="flex gap-5 items-start group">
                            <div className="shrink-0 w-6 h-6 bg-red-50 text-red-600 rounded-full flex items-center justify-center text-[10px] font-black group-hover:bg-red-600 group-hover:text-white transition-colors mt-1">!</div>
                            <div>
                                <p className="text-sm text-slate-700 font-bold leading-tight mb-1 uppercase tracking-tight">Registration Fees</p>
                                <p className="text-xs text-slate-500 leading-relaxed">The GHS 350.00 fee is strictly non-refundable once the invoice is generated and processing begins.</p>
                            </div>
                        </li>
                        <li className="flex gap-5 items-start group">
                            <div className="shrink-0 w-6 h-6 bg-red-50 text-red-600 rounded-full flex items-center justify-center text-[10px] font-black group-hover:bg-red-600 group-hover:text-white transition-colors mt-1">!</div>
                            <div>
                                <p className="text-sm text-slate-700 font-bold leading-tight mb-1 uppercase tracking-tight">Seat Confirmation Deposits</p>
                                <p className="text-xs text-slate-500 leading-relaxed">The 40% deposit confirms your place in a specific cohort. This is non-refundable once the cohort has been officially confirmed.</p>
                            </div>
                        </li>
                        <li className="flex gap-5 items-start group">
                            <div className="shrink-0 w-6 h-6 bg-red-50 text-red-600 rounded-full flex items-center justify-center text-[10px] font-black group-hover:bg-red-600 group-hover:text-white transition-colors mt-1">!</div>
                            <div>
                                <p className="text-sm text-slate-700 font-bold leading-tight mb-1 uppercase tracking-tight">Examination Sittings</p>
                                <p className="text-xs text-slate-500 leading-relaxed">Confirmed bookings may roll forward to the next window if requested before <b>T-21</b>. No-shows result in total forfeiture of fees.</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </section>

            {/* 4. Final CTA */}
            <div className="text-center bg-aerojet-sky rounded-[3rem] py-16 px-8 shadow-2xl relative overflow-hidden">
                <div className="relative z-10">
                    <h2 className="text-3xl font-black text-white uppercase tracking-tight mb-4">Begin the Process</h2>
                    <p className="text-blue-100 mb-10 max-w-lg mx-auto font-medium">Request your registration invoice to unlock official pricing and gain portal access.</p>
                    <Link href="/register" className="bg-white text-aerojet-blue px-12 py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-slate-900 hover:text-white transition-all shadow-lg active:scale-95 inline-block">
                        Start Registration Now
                    </Link>
                </div>
            </div>

          </div>
        </div>
      </div>
      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'How to Enroll',
};

const documents = [
  "Passport or National ID card copy",
  "High School Diploma / WASSCE Certificate",
  "Official Academic Transcripts",
  "Recent passport-sized photograph",
  "English Language Proficiency (if required)"
];

export default function HowToApplyPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50">
      <Navbar />
      <div className="grow">
        <PageHero 
          title="How to Enroll"
          subtitle="Your step-by-step roadmap to joining Aerojet Academy."
          backgroundImage="/takeoff.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="max-w-6xl mx-auto grid lg:grid-cols-3 gap-16">
            
            {/* --- Main Content: The 4 Steps --- */}
            <div className="lg:col-span-2 space-y-12">
                <div className="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-xl border border-slate-100">
                    <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-10">The Enrollment Process</h2>
                    
                    <div className="space-y-12 relative">
                        {/* Connecting Line */}
                        <div className="absolute left-5 top-2 bottom-2 w-0.5 bg-slate-100 z-0" />

                        <div className="relative z-10 flex gap-6">
                            <div className="shrink-0 w-10 h-10 rounded-full bg-aerojet-sky text-white flex items-center justify-center font-black">1</div>
                            <div>
                                <h3 className="text-lg font-bold text-slate-800">Registration Invoice</h3>
                                <p className="text-sm text-slate-500 leading-relaxed mt-1">We will first issue an invoice for the GHS 350 registration fee. Payment of the registration fee is required before you can complete the online application.</p>
                            </div>
                        </div>

                        <div className="relative z-10 flex gap-6">
                            <div className="shrink-0 w-10 h-10 rounded-full bg-aerojet-sky text-white flex items-center justify-center font-black">2</div>
                            <div>
                                <h3 className="text-lg font-bold text-slate-800">Online Application Form</h3>
                                <p className="text-sm text-slate-500 leading-relaxed mt-1">Once payment is received and you send us confirmation, we will provide a link to complete the online application form for Academy review and approval.</p>
                            </div>
                        </div>

                        <div className="relative z-10 flex gap-6">
                            <div className="shrink-0 w-10 h-10 rounded-full bg-aerojet-sky text-white flex items-center justify-center font-black">3</div>
                            <div>
                                <h3 className="text-lg font-bold text-slate-800">Confirmation Invoice</h3>
                                <p className="text-sm text-slate-500 leading-relaxed mt-1">Upon approval, we will issue an invoice for the Confirmation payment applicable to your selected training programme. Once paid, your seat is secured.</p>
                            </div>
                        </div>

                        <div className="relative z-10 flex gap-6">
                            <div className="shrink-0 w-10 h-10 rounded-full bg-aerojet-sky text-white flex items-center justify-center font-black">4</div>
                            <div>
                                <h3 className="text-lg font-bold text-slate-800">Student Portal Onboarding</h3>
                                <p className="text-sm text-slate-500 leading-relaxed mt-1">After confirmation, you will be onboarded onto our student portal. You will receive confirmation of your start date or access to your learning materials.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div className="bg-slate-900 text-white p-8 md:p-12 rounded-[2.5rem] shadow-2xl flex flex-col md:flex-row items-center justify-between gap-8">
                    <div>
                        <h3 className="text-2xl font-black uppercase tracking-tight text-aerojet-sky">Ready to begin?</h3>
                        <p className="text-slate-400 text-sm mt-1">Request your registration invoice to start.</p>
                    </div>
                    <Link href="/register" className="bg-white text-slate-900 px-10 py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-aerojet-sky hover:text-white transition-all whitespace-nowrap">
                        Register Now →
                    </Link>
                </div>
            </div>

            {/* --- Sidebar: Checklist --- */}
            <aside className="lg:col-span-1">
                <div className="bg-white p-8 rounded-4xl border border-slate-200 shadow-sm sticky top-28">
                    <h3 className="font-black text-xs uppercase tracking-[0.2em] mb-6 text-slate-400">Document Checklist</h3>
                    <p className="text-xs text-slate-500 mb-8 font-medium">Please ensure you have these documents ready for your application submission (Step 2):</p>
                    <ul className="space-y-4 mb-10">
                        {documents.map(doc => (
                            <li key={doc} className="flex items-start text-[11px] font-bold text-slate-700 bg-slate-50 p-3 rounded-xl border border-slate-100">
                                <span className="text-green-500 mr-2 text-base">✓</span>
                                {doc}
                            </li>
                        ))}
                    </ul>
                    <div className="pt-6 border-t border-slate-100">
                        <Link href="/contact" className="text-aerojet-sky font-bold text-xs uppercase tracking-widest hover:underline">
                            Ask a question ↗
                        </Link>
                    </div>
                </div>
            </aside>

          </div>
        </div>
      </div>
      <Footer />
    </main>
  );
}

import NextAuth, { type NextAuthOptions } from "next-auth"
import GoogleProvider from "next-auth/providers/google"
import CredentialsProvider from "next-auth/providers/credentials"
import { PrismaAdapter } from "@auth/prisma-adapter"
import { PrismaClient } from "@prisma/client"
import { compare } from 'bcryptjs';

const prisma = new PrismaClient()

export const authOptions: NextAuthOptions = {
  adapter: PrismaAdapter(prisma) as any,
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
    CredentialsProvider({
      name: 'Credentials',
      credentials: { email: {}, password: {} },
      async authorize(credentials) {
        if (!credentials?.email || !credentials.password) return null;
        const user = await prisma.user.findUnique({ where: { email: credentials.email } });
        if (!user || !user.password) return null;
        const isValid = await compare(credentials.password, user.password);
        return isValid ? user : null;
      }
    })
  ],
  pages: {
    // signIn: '/portal/login',
  },
  session: {
    strategy: "jwt",
  },

  events: {
    // Set user to INACTIVE on first-time signup
    createUser: async ({ user }) => {
      await prisma.user.update({
        where: { id: user.id },
        data: { isActive: false }
      });
      // Also create a student profile automatically
      await prisma.student.create({
        data: { userId: user.id }
      });
    }
  },

  callbacks: {
    async signIn({ user, account, profile }) {
      // 1. Check if the user already exists in our database
      const existingUser = await prisma.user.findUnique({
        where: { email: user.email as string },
      });

      // 2. If the user DOES NOT exist, block them from creating an account
      if (!existingUser) {
        // You can redirect them to a custom "Not Authorized" or "Pay First" page
        return '/portal/login?error=AccessDenied'; 
      }

      // 3. If they exist and are inactive, we still let them in to the "Pending" page 
      // (or you can block them here too if you prefer)
      return true;
    },
    
    // 1. JWT CALLBACK: Fetch latest data from DB
    async jwt({ token, user }) {
      if (user) {
        token.sub = user.id;
        token.role = user.role;
      }
      
      // Update role dynamically from DB on each request
      if (token.sub) {
        const dbUser = await prisma.user.findUnique({
          where: { id: token.sub },
          select: { role: true }
        });
        if (dbUser) token.role = dbUser.role;
      }

      return token;
    },

    // 2. SESSION CALLBACK: Map token data to session object
    async session({ session, token }) {
      if (session.user) {
        session.user.id = token.sub!;
        session.user.role = token.role as string;
      }
      return session;
    },

    // 3. REDIRECT CALLBACK: Handle post-login navigation
    async redirect({ url, baseUrl }) {
      // Allows relative callback URLs
      if (url.startsWith("/")) return `${baseUrl}${url}`
      // Allows callback URLs on the same origin
      else if (new URL(url).origin === baseUrl) return url
      return `${baseUrl}/portal`
    }
  },
};

const handler = NextAuth(authOptions);

export { handler as GET, handler as POST };

import { NextResponse } from 'next/server';
import { sendEnquiryEmail, sendStaffNotification } from '@/app/lib/mail';

export async function POST(req: Request) {
  try {
    const { name, email, message } = await req.json();

    // 1. Send Auto-Response to the Student (Trust Building)
    await sendEnquiryEmail(email, name);

    // 2. Send Notification to your Microsoft Team Inbox
    await sendStaffNotification(name, email, message);

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Contact Form Error:", error);
    return NextResponse.json({ error: 'Failed to send' }, { status: 500 });
  }
}
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch application details
export async function GET(
  req: NextRequest, 
  { params }: { params: Promise<{ id: string }> } // Correct Next.js 15 Promise type
) {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  // Await the params promise to get the ID
  const { id } = await params;

  try {
    const application = await prisma.application.findUnique({
      where: { id },
      include: { course: true }
    });
    
    if (!application) {
      return NextResponse.json({ error: 'Application not found' }, { status: 404 });
    }

    return NextResponse.json({ application });
  } catch (error) {
    console.error("Fetch Application Error:", error);
    return NextResponse.json({ error: 'Failed to fetch application' }, { status: 500 });
  }
}

// POST: Save/Submit detailed application
export async function POST(
  req: NextRequest, 
  { params }: { params: Promise<{ id: string }> }
) {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  // Await the params promise to get the ID
  const { id } = await params;
  const body = await req.json();

  try {
    // 1. Get student profile and their fees
    const student = await prisma.student.findUnique({
        where: { userId: session.user.id },
        include: { fees: true }
    });

    if (!student) {
        return NextResponse.json({ error: 'Student profile not found' }, { status: 404 });
    }

    // 2. Security Check: Find if the Registration Fee is PAID
    const regFee = student.fees.find(f => f.description?.includes("Registration Fee"));
    
    if (regFee?.status !== 'PAID') {
        return NextResponse.json({ 
            error: 'Registration fee must be verified by admin before submitting the full form.' 
        }, { status: 403 });
    }

    // 3. Update the Application with detailed info
    const application = await prisma.application.update({
      where: { id },
      data: {
        educationLevel: body.educationLevel,
        institutionName: body.institutionName,
        graduationYear: body.graduationYear,
        idDocumentUrl: body.idDocumentUrl,
        certificateUrl: body.certificateUrl,
        transcriptUrl: body.transcriptUrl,
        isSubmitted: true,
        status: 'UNDER_REVIEW' 
      }
    });

    return NextResponse.json({ success: true, application });
  } catch (error) {
    console.error("Application Submit Error:", error);
    return NextResponse.json({ error: 'Submission failed' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });

  const student = await prisma.student.findUnique({ where: { userId: session.user.id } });
  if (!student) return NextResponse.json({ records: [] });

  const records = await prisma.attendanceRecord.findMany({
    where: { studentId: student.id },
    include: { course: true },
    orderBy: { date: 'desc' }
  });

  return NextResponse.json({ records });
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch all courses and the user's specific applications
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);

  if (!session || !session.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  try {
    // 1. Get available courses
    const courses = await prisma.course.findMany({
      orderBy: { code: 'asc' } // Sort nicely
    });

    // 2. Try to find student profile
    const student = await prisma.student.findUnique({
      where: { userId: session.user.id },
    });

    // 3. Get applications only if student exists
    let applications: any[] = [];
    if (student) {
      applications = await prisma.application.findMany({
        where: { studentId: student.id },
      });
    }

    return NextResponse.json({ courses, applications });
  } catch (error) {
    console.error("Fetch courses error:", error);
    return NextResponse.json({ error: 'Failed to fetch data' }, { status: 500 });
  }
}

// POST: Apply for a course AND generate invoice
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);

  if (!session || !session.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  try {
    const body = await req.json();
    const { courseId } = body;

    // 1. Ensure profile exists first
    const student = await prisma.student.findUnique({
      where: { userId: session.user.id },
    });

    if (!student) {
      return NextResponse.json({ error: 'Please complete your profile before applying.' }, { status: 400 });
    }

    // 2. Check if already applied
    const existing = await prisma.application.findFirst({
      where: {
        studentId: student.id,
        courseId: courseId
      }
    });

    if (existing) {
      return NextResponse.json({ error: 'You have already applied for this course.' }, { status: 400 });
    }

    // 3. TRANSACTION: Create Application AND Check/Create Registration Fee
    await prisma.$transaction(async (tx) => {
      // A. Create the Application
      await tx.application.create({
        data: {
          studentId: student.id,
          courseId: courseId,
          status: "PENDING"
        }
      });

      // B. Check if they already have a Registration Fee invoice
      const hasRegFee = await tx.fee.findFirst({
        where: {
          studentId: student.id,
          description: { contains: "Registration Fee" }
        }
      });

      // C. If not, create the GHS 350 Invoice
      if (!hasRegFee) {
        await tx.fee.create({
          data: {
            studentId: student.id,
            amount: 350.00, // GHS 350
            paid: 0,
            status: "UNPAID",
            description: "Registration Fee (One-Time)",
            dueDate: new Date() // Due immediately
          }
        });
      }
    });

    return NextResponse.json({ success: true });

  } catch (error) {
    console.error("Application error:", error);
    return NextResponse.json({ error: 'Application failed' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch upcoming exam runs
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });

  try {
    const examRuns = await prisma.examRun.findMany({
      where: {
        status: 'SCHEDULED',
        startDatetime: { gt: new Date() } // Future exams only
      },
      include: {
        course: true, // Include module details
        room: true,
        bookings: true // To calculate remaining seats
      },
      orderBy: { startDatetime: 'asc' }
    });

    return NextResponse.json({ examRuns });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch exams' }, { status: 500 });
  }
}

// POST: Book a seat (Uses Wallet or Creates Invoice)
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });

  const { runId } = await req.json();

  try {
    // 1. Get Student Profile
    const student = await prisma.student.findUnique({ where: { userId: session.user.id } });
    if (!student) return NextResponse.json({ error: 'Profile required' }, { status: 400 });

    // 2. Check for EXISTING booking
    const existingBooking = await prisma.examBooking.findFirst({
        where: {
            studentId: student.id,
            examRunId: runId
        }
    });

    if (existingBooking) {
        return NextResponse.json({ error: 'You have already booked a seat for this exam.' }, { status: 400 });
    }

    // 3. Check Exam Availability
    const run = await prisma.examRun.findUnique({
        where: { id: runId },
        include: { bookings: true, course: true }
    });

    if (!run) return NextResponse.json({ error: 'Exam not found' }, { status: 404 });
    if (run.bookings.length >= run.maxCapacity) {
        return NextResponse.json({ error: 'Exam is full' }, { status: 400 });
    }

    // 4. Check Wallet Balance
    const wallet = await prisma.wallet.findUnique({ where: { studentId: student.id } });
    const hasCredit = wallet && wallet.balance > 0;

    let bookingStatus = 'PENDING_PAYMENT'; 
    if (hasCredit) {
        bookingStatus = 'CONFIRMED';
    }

    // 5. TRANSACTION: Execute Booking Logic
    await prisma.$transaction(async (tx) => {
        // A. Create the Booking Record
        await tx.examBooking.create({
            data: {
                studentId: student.id,
                examRunId: runId,
                status: bookingStatus
            }
        });

        // B. Handle Payment Logic
        if (hasCredit && wallet) {
            // Case 1: Use a Credit from Wallet
            await tx.wallet.update({
                where: { id: wallet.id },
                data: { balance: { decrement: 1 } }
            });
            
            await tx.walletTransaction.create({
                data: {
                    walletId: wallet.id,
                    amount: -1,
                    type: 'USAGE',
                    description: `Booked Exam: ${run.course.code}`
                }
            });
        } else {
            // Case 2: Create a Single-Seat Invoice
            await tx.fee.create({
                data: {
                    studentId: student.id,
                    amount: 520.00, // Standard Single Seat Price (or fetch from run.course.price)
                    paid: 0,
                    status: 'UNPAID',
                    description: `Exam Booking: ${run.course.code} (${new Date(run.startDatetime).toLocaleDateString()})`,
                    dueDate: new Date(new Date().setDate(new Date().getDate() + 7)) // Due in 7 days
                }
            });
        }
    });

    // Return different messages based on outcome
    if (hasCredit) {
        return NextResponse.json({ success: true, message: "Booking confirmed using wallet credit." });
    } else {
        return NextResponse.json({ success: true, message: "Booking reserved. Please pay the invoice in Finance." });
    }

  } catch (error) {
    console.error("Booking Error:", error);
    return NextResponse.json({ error: 'Booking failed' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });

  try {
    const student = await prisma.student.findUnique({ where: { userId: session.user.id } });
    if (!student) return NextResponse.json({ bookings: [] });

    const bookings = await prisma.examBooking.findMany({
      where: { studentId: student.id },
      include: {
        run: {
          include: {
            course: true,
            room: true
          }
        }
      },
      orderBy: { run: { startDatetime: 'asc' } }
    });

    return NextResponse.json({ bookings });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch bookings' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });

  try {
    const student = await prisma.student.findUnique({
      where: { userId: session.user.id },
    });

    if (!student) return NextResponse.json({ fees: [], balance: 0 });

    // Fetch all fees linked to this student
    const fees = await prisma.fee.findMany({
      where: { studentId: student.id },
      orderBy: { dueDate: 'desc' }
    });

    // Calculate total outstanding balance
    const balance = fees.reduce((acc, fee) => {
        if (fee.status !== 'CLEARED' && fee.status !== 'PAID') {
            return acc + (fee.amount - fee.paid);
        }
        return acc;
    }, 0);

    return NextResponse.json({ fees, balance });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch ledger' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });

  try {
    const body = await req.json();
    const { feeId, proofUrl } = body; // Now receiving proofUrl

    // Update the fee status AND save the proof URL
    await prisma.fee.update({
        where: { id: feeId },
        data: { 
            status: "VERIFYING",
            proofUrl: proofUrl // Save the link
        }
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to upload' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch the student profile linked to the logged-in user
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);

  if (!session || !session.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  try {
    const student = await prisma.student.findUnique({
      where: { userId: session.user.id },
    });
    return NextResponse.json({ student });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch profile' }, { status: 500 });
  }
}

// POST: Create or Update the profile
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);

  if (!session || !session.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  const body = await req.json();
  const { 
    phone, dob, address, city, region, 
    emergencyName, emergencyRelation, emergencyPhone 
  } = body;

  try {
    const student = await prisma.student.upsert({
      where: {
        userId: session.user.id,
      },
      update: {
        phone,
        dob: dob ? new Date(dob) : null,
        address,
        city,
        region,
        emergencyName,
        emergencyRelation,
        emergencyPhone,
      },
      create: {
        userId: session.user.id,
        phone,
        dob: dob ? new Date(dob) : null,
        address,
        city,
        region,
        emergencyName,
        emergencyRelation,
        emergencyPhone,
      },
    });

    return NextResponse.json({ success: true, student });
  } catch (error) {
    console.error('Profile update error:', error);
    return NextResponse.json({ error: 'Failed to update profile' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch my results
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });

  try {
    const student = await prisma.student.findUnique({ where: { userId: session.user.id } });
    if (!student) return NextResponse.json({ results: [] });

    const results = await prisma.assessment.findMany({
      where: { studentId: student.id },
      include: {
        run: { include: { course: true } } // Include exam details
      },
      orderBy: { recordedAt: 'desc' }
    });

    return NextResponse.json({ results });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch results' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

const BUNDLES = {
  'BUNDLE_2': { name: '2-Exam Bundle', price: 980.00, credits: 2 },
  'BUNDLE_4': { name: '4-Exam Bundle', price: 1900.00, credits: 4 },
};

export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });

  const { bundleType } = await req.json(); // e.g. 'BUNDLE_4'
  const bundle = BUNDLES[bundleType as keyof typeof BUNDLES];

  if (!bundle) return NextResponse.json({ error: 'Invalid bundle' }, { status: 400 });

  const student = await prisma.student.findUnique({ where: { userId: session.user.id } });
  if (!student) return NextResponse.json({ error: 'Profile required' }, { status: 400 });

  // Create Invoice (Fee)
  // Note: description starts with "BUNDLE:" so we can detect it later during verification
  await prisma.fee.create({
    data: {
      studentId: student.id,
      amount: bundle.price,
      paid: 0,
      status: 'UNPAID',
      description: `BUNDLE: ${bundle.name} (${bundle.credits} Credits)`, 
      dueDate: new Date(new Date().setDate(new Date().getDate() + 7))
    }
  });

  return NextResponse.json({ success: true });
}

import { NextResponse } from 'next/server';
import { sendRegistrationInvoiceEmail } from '@/app/lib/mail';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function POST(req: Request) {
  const { email, name } = await req.json();

  try {
    // 1. Create the user in database (Inactive)
    // ... insert prisma logic here ...

    // 2. Send the Invoice Email with bank details
    await sendRegistrationInvoiceEmail(email, name || 'Applicant');

    return NextResponse.json({ success: true });
  } catch (error) {
    return NextResponse.json({ error: 'Registration failed' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch all applications
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  
  // Verify Admin/Staff Role
  if (!session || (session.user as any).role === 'STUDENT') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  try {
    const applications = await prisma.application.findMany({
      include: {
        student: { include: { user: true } }, // Get student name/email
        course: true // Get course details
      },
      orderBy: { appliedAt: 'desc' }
    });

    return NextResponse.json({ applications });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch applications' }, { status: 500 });
  }
}

// POST: Approve an application
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const { applicationId } = await req.json();

  try {
    const application = await prisma.application.findUnique({
      where: { id: applicationId },
      include: { course: true }
    });

    if (!application) return NextResponse.json({ error: 'Not found' }, { status: 404 });

    // Use Full Price for the Invoice
    const invoiceAmount = application.course.price;
    const description = `Tuition Fee: ${application.course.title}`;

    await prisma.$transaction(async (tx) => {
        // Update Application Status
        await tx.application.update({
            where: { id: applicationId },
            data: { status: 'APPROVED' }
        });

        // Create the Invoice for the FULL AMOUNT
        await tx.fee.create({
            data: {
                studentId: application.studentId,
                amount: invoiceAmount,
                paid: 0,
                status: 'UNPAID', // Will become PARTIAL once they pay 40%
                description: description,
                dueDate: new Date(new Date().setDate(new Date().getDate() + 14))
            }
        });
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    return NextResponse.json({ error: 'Approval failed' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// POST: Record Attendance for a list of students
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const { courseId, date, records } = await req.json(); // records: [{ studentId, attended, scheduled, late }]

  try {
    // Transactional save
    await prisma.$transaction(
        records.map((rec: any) => 
            prisma.attendanceRecord.create({
                data: {
                    courseId,
                    date: new Date(date),
                    studentId: rec.studentId,
                    scheduledHours: parseFloat(rec.scheduled),
                    attendedHours: parseFloat(rec.attended),
                    lateMinutes: parseInt(rec.late || 0),
                    recordedBy: session.user.id
                }
            })
        )
    );

    return NextResponse.json({ success: true });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to record' }, { status: 500 });
  }
}

// GET: Fetch attendance stats for a specific student (for the profile/dashboard)
// We'll create a separate endpoint for the Staff View later (or query via existing)

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch courses with instructors
export async function GET(req: Request) {
  // ... auth check ...
  const courses = await prisma.course.findMany({ 
      orderBy: { code: 'asc' },
      include: { instructors: true } // Include instructor details
  });
  // Also fetch list of all potential instructors for the dropdown
  const instructors = await prisma.user.findMany({ where: { role: 'INSTRUCTOR' } });
  
  return NextResponse.json({ courses, instructors });
}

// POST: Create a new course/module
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const { code, title, price, duration, description } = await req.json();

  try {
    const course = await prisma.course.create({
      data: {
        code,
        title,
        price: parseFloat(price),
        duration: duration || 'Exam Only',
        description: description || `Official EASA Part-66 Module Exam for ${title}.`
      }
    });
    return NextResponse.json({ success: true, course });
  } catch (error) {
    return NextResponse.json({ error: 'Creation failed. Code must be unique.' }, { status: 500 });
  }
}

// PATCH: Update course (including instructor assignment)
export async function PATCH(req: Request) {
  // ... auth check ...
  const { id, materialLink, price, title, instructorIds } = await req.json();

  try {
    await prisma.course.update({
        where: { id },
        data: { 
            materialLink,
            price: price ? parseFloat(price) : undefined,
            title,
            // Update instructors relationship
            instructors: instructorIds ? {
                set: instructorIds.map((uid: string) => ({ id: uid }))
            } : undefined
        }
    });
    return NextResponse.json({ success: true });
  } catch (error) {
    return NextResponse.json({ error: 'Update failed' }, { status: 500 });
  }
}

// DELETE: Remove a course
export async function DELETE(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const { id } = await req.json();

  try {
    await prisma.course.delete({ where: { id } });
    return NextResponse.json({ success: true });
  } catch (error) {
    return NextResponse.json({ error: 'Delete failed. May have dependent data.' }, { status: 500 });
  }
}

import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET(req: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    // 1. Security Check: Only Admin and Staff allowed
    if (!session || !['ADMIN', 'STAFF'].includes((session.user as any).role)) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
    }

    // --- 2. STUDENT DEMOGRAPHICS ---
    const totalStudents = await prisma.user.count({ where: { role: 'STUDENT' } });
    const activeStudents = await prisma.user.count({ where: { role: 'STUDENT', isActive: true } });
    const inactiveStudents = totalStudents - activeStudents;

    // Queries the Student table for gender (assumes profile exists)
    const maleStudents = await prisma.student.count({ where: { gender: 'MALE' } });
    const femaleStudents = await prisma.student.count({ where: { gender: 'FEMALE' } });

    // --- 3. TEAM STATS ---
    const totalStaff = await prisma.user.count({ where: { role: 'STAFF' } });
    const totalInstructors = await prisma.user.count({ where: { role: 'INSTRUCTOR' } });
    const totalAdmins = await prisma.user.count({ where: { role: 'ADMIN' } });

    // --- 4. OPERATIONAL STATS ---
    const pendingApps = await prisma.application.count({ where: { status: 'PENDING' } });
    const verifyingPayments = await prisma.fee.count({ where: { status: 'VERIFYING' } });

    // --- 5. EXAM WINDOW TRACKER LOGIC ---
    const nextWindow = await prisma.examWindow.findFirst({
      where: { endDate: { gt: new Date() } },
      include: {
        runs: {
          include: {
            course: true,
            bookings: {
              include: { 
                student: { include: { fees: true } } 
              }
            }
          }
        }
      },
      orderBy: { startDate: 'asc' }
    });

    let windowStats = null;

    if (nextWindow) {
      let paidSeatsCount = 0;
      nextWindow.runs.forEach(run => {
        run.bookings.forEach(booking => {
          // Verify if student has a fee record matching the module code that is marked PAID
          const examFee = booking.student.fees.find(f => 
            f.description?.includes(run.course.code) && f.status === 'PAID'
          );
          if (examFee) {
            paidSeatsCount++;
          }
        });
      });

      const today = new Date();
      const cutoff = new Date(nextWindow.cutoffDate);
      const diffTime = cutoff.getTime() - today.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

      windowStats = {
        id: nextWindow.id,
        name: nextWindow.name,
        cutoff: nextWindow.cutoffDate,
        paidSeats: paidSeatsCount,
        targetSeats: nextWindow.minSeatsRequired,
        isGo: paidSeatsCount >= nextWindow.minSeatsRequired,
        daysToCutoff: diffDays > 0 ? diffDays : 0
      };
    }

    // --- 6. FINAL RESPONSE ---
    return NextResponse.json({
      studentStats: {
        total: totalStudents,
        active: activeStudents,
        inactive: inactiveStudents,
        male: maleStudents,
        female: femaleStudents
      },
      teamStats: {
        staff: totalStaff,
        instructors: totalInstructors,
        admins: totalAdmins
      },
      opsStats: {
        pendingApps,
        verifyingPayments
      },
      windowTracker: windowStats 
    });

  } catch (error) {
    console.error("Dashboard API Error:", error);
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch all exam runs (with booking counts)
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  try {
    const runs = await prisma.examRun.findMany({
      include: {
        course: true,
        room: true,
        bookings: { include: { student: { include: { user: true } } } }
      },
      orderBy: { startDatetime: 'desc' }
    });
    
    // Also fetch available rooms and modules for the "Create" form
    const rooms = await prisma.examRoom.findMany();
    const modules = await prisma.course.findMany({ where: { code: { startsWith: 'MOD-' } } });

    return NextResponse.json({ runs, rooms, modules });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch' }, { status: 500 });
  }
}

// POST: Create a new Exam Run
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const { moduleId, roomId, datetime, duration } = await req.json();

  try {
    // Basic validation: Check room capacity
    const room = await prisma.examRoom.findUnique({ where: { id: roomId } });
    if (!room) return NextResponse.json({ error: 'Room not found' }, { status: 404 });

    const run = await prisma.examRun.create({
        data: {
            examModuleId: moduleId,
            roomId: roomId,
            startDatetime: new Date(datetime),
            durationMinutes: parseInt(duration),
            maxCapacity: room.capacity,
            status: 'SCHEDULED'
        }
    });

    return NextResponse.json({ success: true, run });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to create run' }, { status: 500 });
  }
}
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch single exam run details + roster
export async function GET(
  req: NextRequest, 
  { params }: { params: Promise<{ id: string }> } // Updated for Next.js 15
) {
  const session = await getServerSession(authOptions);
  
  // Verify Admin/Staff Role
  if (!session || (session.user as any).role === 'STUDENT') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  // Await params before accessing the id
  const { id } = await params;

  try {
    const run = await prisma.examRun.findUnique({
      where: { id },
      include: {
        course: true,
        room: true,
        bookings: {
          include: {
            student: { include: { user: true } }
          },
          orderBy: { seatLabel: 'asc' } 
        }
      }
    });

    if (!run) return NextResponse.json({ error: 'Not found' }, { status: 404 });

    return NextResponse.json({ run });
  } catch (error) {
    console.error("Fetch Exam Roster Error:", error);
    return NextResponse.json({ error: 'Failed to fetch roster' }, { status: 500 });
  }
}

// DELETE: Remove a student booking
export async function DELETE(
  req: NextRequest, 
  { params }: { params: Promise<{ id: string }> }
) {
  const session = await getServerSession(authOptions);
  
  if (!session || (session.user as any).role === 'STUDENT') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  // Await params even if id isn't used directly in the body, 
  // ensuring method signature matches the route
  const { id } = await params; 
  const { bookingId } = await req.json();

  try {
    await prisma.examBooking.delete({
      where: { id: bookingId }
    });
    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Delete Booking Error:", error);
    return NextResponse.json({ error: 'Delete failed' }, { status: 500 });
  }
}

// PATCH: Assign a seat label to a booking
export async function PATCH(
  req: NextRequest, 
  { params }: { params: Promise<{ id: string }> }
) {
  const session = await getServerSession(authOptions);
  
  if (!session || (session.user as any).role === 'STUDENT') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const { id } = await params;
  const { bookingId, seatLabel } = await req.json();

  try {
    // Note: id (examRunId) could be used here for additional verification 
    // to ensure the booking belongs to this specific run.
    
    await prisma.examBooking.update({
      where: { id: bookingId },
      data: { seatLabel }
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Assign Seat Error:", error);
    return NextResponse.json({ error: 'Failed to assign seat. Label might be taken.' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';
import { sendPaymentVerifiedEmail } from '@/app/lib/mail';

const prisma = new PrismaClient();

// GET: Fetch pending payments (Status: VERIFYING)
export async function GET(req: Request) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session || !session.user) {
      return NextResponse.json({ error: 'Unauthenticated' }, { status: 401 });
    }

    const role = (session.user as any).role;
    if (role === 'STUDENT') {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
    }

    const payments = await prisma.fee.findMany({
      where: { status: 'VERIFYING' },
      include: { 
        student: { 
          include: { user: true } 
        } 
      },
      orderBy: { dueDate: 'desc' }
    });

    return NextResponse.json({ payments: payments || [] });

  } catch (error) {
    console.error("Staff Finance GET Error:", error);
    return NextResponse.json({ payments: [], error: "Server Error" }, { status: 500 });
  }
}

// POST: Confirm payment amount, update Status, Wallet, and notify Student
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  
  if (!session || (session.user as any).role === 'STUDENT') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  try {
    const { feeId, amountPaid } = await req.json();

    // 1. Fetch fee details along with student and auth user info
    const fee = await prisma.fee.findUnique({ 
        where: { id: feeId },
        include: { 
            student: { 
                include: { user: true } 
            } 
        }
    });

    if (!fee) return NextResponse.json({ error: 'Fee not found' }, { status: 404 });

    const paidAmount = parseFloat(amountPaid);
    const newPaidTotal = fee.paid + paidAmount;
    
    // Determine New Status
    let newStatus = 'UNPAID';
    if (newPaidTotal >= fee.amount) newStatus = 'PAID';
    else if (newPaidTotal > 0) newStatus = 'PARTIAL';

    // Check 40% Threshold for Auto-Enrollment
    const isDepositThresholdMet = newPaidTotal >= (fee.amount * 0.40);

    // 2. Execute Database Transaction
    await prisma.$transaction(async (tx) => {
        // A. Update the Fee Record
        await tx.fee.update({
            where: { id: feeId },
            data: { 
                status: newStatus, 
                paid: newPaidTotal 
            }
        });

        // B. Handle Auto-Enrollment
        if (isDepositThresholdMet && fee.student.enrollmentStatus !== 'ENROLLED') {
             await tx.student.update({
                where: { id: fee.studentId },
                data: { enrollmentStatus: 'ENROLLED' }
            });
        }
        
        // C. Handle Bundle/Wallet Credits (Only if fully paid)
        if (newStatus === 'PAID' && fee.description && fee.description.startsWith('BUNDLE:')) {
            const match = fee.description.match(/\((\d+) Credits\)/);
            if (match && match[1]) {
                const credits = parseInt(match[1]);
                let wallet = await tx.wallet.findUnique({ where: { studentId: fee.studentId } });
                if (!wallet) {
                    wallet = await tx.wallet.create({ data: { studentId: fee.studentId, balance: 0 } });
                }
                await tx.wallet.update({
                    where: { id: wallet.id },
                    data: { balance: { increment: credits } }
                });
                await tx.walletTransaction.create({
                    data: { 
                        walletId: wallet.id, 
                        amount: credits, 
                        type: 'PURCHASE', 
                        description: `Purchased ${fee.description}` 
                    }
                });
            }
        }
    });

    // 3. TRIGGER NOTIFICATION: Send email to student
    // We use the email from the linked User account
    const studentEmail = fee.student.user.email;
    const studentName = fee.student.user.name || "Student";

    if (studentEmail) {
        try {
            await sendPaymentVerifiedEmail(studentEmail, studentName);
        } catch (emailError) {
            console.error("Notification Email Failed:", emailError);
            // We don't fail the whole request if just the email fails
        }
    }

    return NextResponse.json({ success: true });

  } catch (error) {
    console.error("Confirm Payment POST Error:", error);
    return NextResponse.json({ error: 'Confirmation failed' }, { status: 500 });
  }
}
import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch courses assigned to the current instructor
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  
  // Allow Instructors (and Admins/Staff for testing)
  if (!session || !['INSTRUCTOR', 'ADMIN', 'STAFF'].includes((session.user as any).role)) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  try {
    const courses = await prisma.course.findMany({
      where: {
        instructors: {
          some: {
            id: session.user.id
          }
        }
      },
      orderBy: { code: 'asc' }
    });

    return NextResponse.json({ courses });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch' }, { status: 500 });
  }
}
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET(
  req: NextRequest,
  { params }: { params: Promise<{ courseId: string }> } // Updated to Promise
) {
  const session = await getServerSession(authOptions);
  
  // Verify Instructor/Admin/Staff Role
  if (!session || !['ADMIN', 'STAFF', 'INSTRUCTOR'].includes((session.user as any).role)) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  // Mandatory for Next.js 15: Await the params to get courseId
  const { courseId } = await params;

  try {
    // 1. If the user is an Instructor, verify they are actually teaching this course
    if ((session.user as any).role === 'INSTRUCTOR') {
        const assignment = await prisma.course.findFirst({
            where: {
                id: courseId,
                instructors: { some: { id: session.user.id } }
            }
        });
        if (!assignment) {
          return NextResponse.json({ error: 'Access denied: You are not assigned to this course.' }, { status: 403 });
        }
    }

    // 2. Fetch Enrolled Students (Applications with APPROVED status)
    const applications = await prisma.application.findMany({
        where: {
            courseId: courseId,
            status: 'APPROVED'
        },
        include: {
            student: { 
              include: { 
                user: {
                  select: {
                    name: true,
                    email: true,
                    image: true,
                    createdAt: true
                  }
                } 
              } 
            }
        },
        orderBy: { student: { user: { name: 'asc' } } }
    });

    // Extract the student profile data
    const students = applications.map(app => app.student);

    return NextResponse.json({ students });
  } catch (error) {
    console.error("Fetch Instructor Roster Error:", error);
    return NextResponse.json({ error: 'Failed to fetch class roster' }, { status: 500 });
  }
}
import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// POST: Save Results for a batch of students
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const { examRunId, results } = await req.json(); // results: [{ studentId, score }]

  try {
    // 1. Fetch the Exam Run to get the Module Code
    const examRun = await prisma.examRun.findUnique({
      where: { id: examRunId },
      include: { course: true } // Need this for moduleCode
    });

    if (!examRun) {
        return NextResponse.json({ error: 'Exam run not found' }, { status: 404 });
    }

    const moduleCode = examRun.course.code; // e.g. "MOD-01"

    // 2. Process each result in a transaction
    await prisma.$transaction(
        results.map((res: any) => {
            const score = parseFloat(res.score);
            const isPassed = score >= 75; // EASA Standard Pass Mark

            // Update or Create the assessment
            return prisma.assessment.create({
                data: {
                    examRunId,
                    studentId: res.studentId,
                    score,
                    maxScore: 100,
                    isPassed,
                    type: 'EASA_EXAM',
                    moduleCode: moduleCode, // <--- ADDED THIS (Required field)
                    comments: "Exam Run Result"
                }
            });
        })
    );

    // Mark the exam run as COMPLETED
    await prisma.examRun.update({
        where: { id: examRunId },
        data: { status: 'COMPLETED' }
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Result Save Error:", error);
    return NextResponse.json({ error: 'Failed to save results' }, { status: 500 });
  }
}
import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// POST: Save Results for a batch of students
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const { examRunId, results } = await req.json(); // results: [{ studentId, score }]

  try {
    // 1. Fetch the Exam Run to get the Module Code
    const examRun = await prisma.examRun.findUnique({
      where: { id: examRunId },
      include: { course: true } // Need this for moduleCode
    });

    if (!examRun) {
        return NextResponse.json({ error: 'Exam run not found' }, { status: 404 });
    }

    const moduleCode = examRun.course.code; // e.g. "MOD-01"

    // 2. Process each result in a transaction
    await prisma.$transaction(
        results.map((res: any) => {
            const score = parseFloat(res.score);
            const isPassed = score >= 75; // EASA Standard Pass Mark

            // Update or Create the assessment
            return prisma.assessment.create({
                data: {
                    examRunId,
                    studentId: res.studentId,
                    score,
                    maxScore: 100,
                    isPassed,
                    type: 'EASA_EXAM',
                    moduleCode: moduleCode, // <--- ADDED THIS (Required field)
                    comments: "Exam Run Result"
                }
            });
        })
    );

    // Mark the exam run as COMPLETED
    await prisma.examRun.update({
        where: { id: examRunId },
        data: { status: 'COMPLETED' }
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Result Save Error:", error);
    return NextResponse.json({ error: 'Failed to save results' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch Rooms
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const rooms = await prisma.examRoom.findMany({ orderBy: { code: 'asc' } });
  return NextResponse.json({ rooms });
}

// POST: Create Room
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const body = await req.json();
  try {
    const room = await prisma.examRoom.create({
        data: { name: body.name, code: body.code, capacity: parseInt(body.capacity) }
    });
    return NextResponse.json({ success: true, room });
  } catch (e) { return NextResponse.json({ error: 'Failed' }, { status: 500 }); }
}

// PATCH: Update Room
export async function PATCH(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const { id, name, code, capacity } = await req.json();
  try {
    await prisma.examRoom.update({
        where: { id },
        data: { name, code, capacity: parseInt(capacity) }
    });
    return NextResponse.json({ success: true });
  } catch (e) { return NextResponse.json({ error: 'Update failed' }, { status: 500 }); }
}

// DELETE: Delete Room
export async function DELETE(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role === 'STUDENT') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const { id } = await req.json();
  try {
    await prisma.examRoom.delete({ where: { id } });
    return NextResponse.json({ success: true });
  } catch (e) { return NextResponse.json({ error: 'Delete failed' }, { status: 500 }); }
}
import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET() {
  const settings = await prisma.systemSetting.findMany();
  return NextResponse.json({ settings });
}

export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role !== 'ADMIN') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const { key, value } = await req.json();

  await prisma.systemSetting.upsert({
    where: { key },
    update: { value },
    create: { key, value }
  });

  return NextResponse.json({ success: true });
}

import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// GET: Fetch single student details
export async function GET(
  req: NextRequest, 
  { params }: { params: Promise<{ id: string }> } // Updated for Next.js 15
) {
  const session = await getServerSession(authOptions);
  
  if (!session || !['ADMIN', 'STAFF'].includes((session.user as any).role)) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const { id } = await params;

  try {
    const student = await prisma.student.findUnique({
      where: { id },
      include: {
        user: true,
        applications: { include: { course: true } },
        fees: true,
        examBookings: { include: { run: { include: { course: true } } } }
      }
    });

    if (!student) {
      return NextResponse.json({ error: 'Student not found' }, { status: 404 });
    }

    return NextResponse.json({ student });
  } catch (error) {
    console.error("Fetch Student Detail Error:", error);
    return NextResponse.json({ error: 'Failed to fetch student details' }, { status: 500 });
  }
}

// PATCH: Update Student ID OR Photo
export async function PATCH(
  req: NextRequest, 
  { params }: { params: Promise<{ id: string }> }
) {
  const session = await getServerSession(authOptions);
  
  if (!session || !['ADMIN', 'STAFF'].includes((session.user as any).role)) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const body = await req.json();
  const { id } = await params;

  const { studentId, photoUrl, enrollmentStatus, cohort } = body;

  try {
    const student = await prisma.student.update({
      where: { id },
      data: {
        studentId: studentId || undefined,
        photoUrl: photoUrl || undefined,
        enrollmentStatus: enrollmentStatus || undefined,
        cohort: cohort || undefined,
      }
    });

    return NextResponse.json({ success: true, student });
  } catch (error) {
    console.error("Update Student Error:", error);
    return NextResponse.json({ error: 'Update failed' }, { status: 500 });
  }
}

// DELETE: Delete a student and their auth user record
export async function DELETE(
  req: NextRequest, 
  { params }: { params: Promise<{ id: string }> }
) {
  const session = await getServerSession(authOptions);
  
  // Only Admin can delete accounts
  if (!session || (session.user as any).role !== 'ADMIN') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const { id } = await params;

  try {
    // 1. Find student to get the linked userId
    const student = await prisma.student.findUnique({ where: { id } });
    
    if (!student) {
      return NextResponse.json({ error: 'Student not found' }, { status: 404 });
    }

    // 2. Delete the Auth User (Student profile deletes automatically due to onDelete: Cascade)
    await prisma.user.delete({
      where: { id: student.userId }
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Delete Student Error:", error);
    return NextResponse.json({ error: 'Delete failed' }, { status: 500 });
  }
}
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';
import { hash } from 'bcryptjs';

const prisma = new PrismaClient();

export async function POST(req: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    // Security: Only Admins can perform bulk imports
    if (!session || (session.user as any).role !== 'ADMIN') {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
    }

    const { students } = await req.json();

    if (!Array.isArray(students) || students.length === 0) {
      return NextResponse.json({ error: 'No data provided' }, { status: 400 });
    }

    // Hash a default password for these imported accounts
    // They can change it later via the "Security" tab we built
    const defaultPassword = await hash("Aerojet2026!", 10);

    const results = await prisma.$transaction(
      students.map((s: any) => 
        prisma.user.upsert({
          where: { email: s.email },
          update: {
             // If user exists, ensure they are active
             isActive: true 
          }, 
          create: {
            name: s.name,
            email: s.email,
            password: defaultPassword,
            role: 'STUDENT',
            isActive: true, // Imported students bypass the payment gate
            studentProfile: {
              create: {
                phone: s.phone || null,
                studentId: s.studentId || null, // e.g. AATA0001
                enrollmentStatus: 'ENROLLED'
              }
            }
          }
        })
      )
    );

    return NextResponse.json({ success: true, count: results.length });

  } catch (error) {
    console.error("Import Error:", error);
    return NextResponse.json({ error: 'Failed to import. Check CSV formatting.' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';
import { hash } from 'bcryptjs';

const prisma = new PrismaClient();

export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !['ADMIN', 'STAFF'].includes((session.user as any).role)) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const students = await prisma.student.findMany({
    include: { user: true },
    orderBy: { createdAt: 'desc' }
  });
  return NextResponse.json({ students });
}

// NEW: POST to create a student manually
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || (session.user as any).role !== 'ADMIN') return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });

  const { name, email, password } = await req.json();

  try {
    const hashedPassword = await hash(password, 10);

    // Create User and Student Profile in one transaction
    const result = await prisma.$transaction(async (tx) => {
      const user = await tx.user.create({
        data: {
          name,
          email,
          password: hashedPassword,
          role: 'STUDENT',
        }
      });

      return await tx.student.create({
        data: {
          userId: user.id,
          enrollmentStatus: 'APPLICANT'
        }
      });
    });

    return NextResponse.json({ success: true, student: result });
  } catch (error) {
    return NextResponse.json({ error: 'User already exists or failed to create' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';
import { hash } from 'bcryptjs';

const prisma = new PrismaClient();

// GET: List all users (for admin management)
export async function GET(req: Request) {
  const session = await getServerSession(authOptions);
  
  // Only Admins and Staff can view the user list
  if (!session || !['ADMIN', 'STAFF'].includes((session.user as any).role)) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  try {
    const users = await prisma.user.findMany({
      orderBy: { createdAt: 'desc' }
    });
    return NextResponse.json({ users });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to fetch users' }, { status: 500 });
  }
}

// POST: Create a new user (Admin/Staff/Student)
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  
  // Only Admins can create new users
  if (!session || (session.user as any).role !== 'ADMIN') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const { name, email, password, role } = await req.json();

  try {
    const hashedPassword = await hash(password, 10);
    
    // Create User and potentially Student Profile in one transaction
    const user = await prisma.$transaction(async (tx) => {
      const newUser = await tx.user.create({
        data: {
          name,
          email,
          password: hashedPassword,
          role: role || 'STUDENT', // Default to student if no role is provided
          isActive: true // Admin-created accounts are active by default
        }
      });

      // If it's a student, create their linked profile
      if (newUser.role === 'STUDENT') {
        await tx.student.create({
          data: {
            userId: newUser.id,
            enrollmentStatus: 'APPLICANT' // Start as applicant
          }
        });
      }
      return newUser;
    });

    return NextResponse.json({ success: true, user });
  } catch (error) {
    // Check for unique constraint violation (email taken)
    if ((error as any).code === 'P2002') {
      return NextResponse.json({ error: 'An account with this email already exists.' }, { status: 409 });
    }
    return NextResponse.json({ error: 'Failed to create user' }, { status: 500 });
  }
}

// PATCH: Update user role OR activation status
export async function PATCH(req: Request) {
  const session = await getServerSession(authOptions);
  
  // Only Admins can change roles or activate
  if (!session || (session.user as any).role !== 'ADMIN') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  const { userId, role, isActive, image } = await req.json();

  try {
    const dataToUpdate: any = {};
    if (role) dataToUpdate.role = role;
    if (typeof isActive === 'boolean') dataToUpdate.isActive = isActive;
    if (image) dataToUpdate.image = image;

    if (Object.keys(dataToUpdate).length === 0) {
      return NextResponse.json({ error: 'No update data provided' }, { status: 400 });
    }

    const updatedUser = await prisma.user.update({
      where: { id: userId },
      data: dataToUpdate
    });

    return NextResponse.json({ success: true, user: updatedUser });
  } catch (error) {
    return NextResponse.json({ error: 'Failed to update user' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';
import { hash } from 'bcryptjs';

const prisma = new PrismaClient();

// POST: Allow a logged-in user to set or change their password
export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  const { newPassword } = await req.json();

  if (!newPassword || newPassword.length < 6) {
    return NextResponse.json({ error: 'Password must be at least 6 characters' }, { status: 400 });
  }

  try {
    const hashedPassword = await hash(newPassword, 10);

    await prisma.user.update({
      where: { id: session.user.id },
      data: { password: hashedPassword }
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Password update error:", error);
    return NextResponse.json({ error: 'Failed to update password' }, { status: 500 });
  }
}

import { NextResponse } from 'next/server';
import { cookies } from 'next/headers';

export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  const secret = searchParams.get('secret');

  // You can change this secret to anything you want
  const ADMIN_SECRET = "Aerojet2026"; 

  if (secret === ADMIN_SECRET) {
    const cookieStore = await cookies();
    
    // Set a cookie that lasts for 7 days
    cookieStore.set('portal_access', 'true', {
      maxAge: 60 * 60 * 24 * 7, 
      path: '/',
      httpOnly: true, // Security: Script cannot read this cookie
      secure: true,
      sameSite: 'lax',
    });

    // Redirect to home after setting cookie
    return NextResponse.redirect(new URL('/', req.url));
  }

  return NextResponse.json({ error: "Invalid secret key" }, { status: 403 });
}

import { createUploadthing, type FileRouter } from "uploadthing/next";
import { getServerSession } from "next-auth";
import { authOptions } from "../auth/[...nextauth]/route";

const f = createUploadthing();

export const ourFileRouter = {
  // Existing payment proof route
  paymentProof: f({ image: { maxFileSize: "4MB", maxFileCount: 1 }, pdf: { maxFileSize: "4MB", maxFileCount: 1 } })
    .middleware(async () => {
      const session = await getServerSession(authOptions);
      if (!session || !session.user) throw new Error("Unauthorized");
      return { userId: session.user.id };
    })
    .onUploadComplete(async ({ metadata, file }) => {
      console.log("Proof uploaded:", file.url);
    }),

  // --- NEW: Admin Only Photo Upload ---
  adminStudentPhoto: f({ image: { maxFileSize: "4MB", maxFileCount: 1 } })
    .middleware(async () => {
      const session = await getServerSession(authOptions);
      // STRICT CHECK: Only Admin/Staff can upload to this endpoint
      if (!session || (session.user as any).role === 'STUDENT') throw new Error("Unauthorized");
      return { userId: session.user.id };
    })
    .onUploadComplete(async ({ file }) => {
      console.log("ID Photo uploaded:", file.url);
    }),

} satisfies FileRouter;

export type OurFileRouter = typeof ourFileRouter;

import { createRouteHandler } from "uploadthing/next";
import { ourFileRouter } from "./core";

// Export routes for Next App Router
export const { GET, POST } = createRouteHandler({
  router: ourFileRouter,
});
import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';
import { hash } from 'bcryptjs';

const prisma = new PrismaClient();

export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  try {
    const { newPassword } = await req.json();

    if (!newPassword || newPassword.length < 6) {
      return NextResponse.json({ error: 'Password must be at least 6 characters' }, { status: 400 });
    }

    // Hash the password
    const hashedPassword = await hash(newPassword, 10);

    // Update the USER record (not student)
    const updatedUser = await prisma.user.update({
      where: { id: session.user.id }, // Ensure this ID is correct from session
      data: { password: hashedPassword }
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Password update error:", error);
    return NextResponse.json({ error: 'Failed to update password' }, { status: 500 });
  }
}

"use client";
import React from 'react';

type ConfirmationModalProps = {
  isOpen: boolean;
  onClose: () => void;
  onConfirm: () => void;
  title: string;
  message: string;
};

export default function ConfirmationModal({ 
  isOpen, 
  onClose, 
  onConfirm,
  title,
  message
}: ConfirmationModalProps) {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full">
        <h2 className="text-2xl font-bold text-aerojet-blue mb-4">{title}</h2>
        <p className="text-gray-600 mb-8">{message}</p>
        <div className="flex justify-end gap-4">
          <button 
            onClick={onClose}
            className="px-6 py-2 rounded-lg font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 transition"
          >
            Cancel
          </button>
          <button 
            onClick={onConfirm}
            className="px-6 py-2 rounded-lg font-semibold text-white bg-red-600 hover:bg-red-700 transition"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>
  );
}

"use client";
import React, { useState, useEffect } from 'react';

type InputModalProps = {
  isOpen: boolean;
  onClose: () => void;
  onConfirm: (value: string) => void;
  title: string;
  message: string;
  defaultValue?: string;
  placeholder?: string;
};

export default function InputModal({ 
  isOpen, 
  onClose, 
  onConfirm,
  title,
  message,
  defaultValue = "",
  placeholder = ""
}: InputModalProps) {
  const [value, setValue] = useState(defaultValue);

  // Reset value when modal opens
  useEffect(() => {
    if (isOpen) setValue(defaultValue || "");
  }, [isOpen, defaultValue]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full animate-in fade-in zoom-in-95 duration-200">
        <h2 className="text-xl font-bold text-slate-800 mb-2">{title}</h2>
        <p className="text-sm text-slate-600 mb-6">{message}</p>
        
        <input 
            type="text" 
            value={value}
            onChange={(e) => setValue(e.target.value)}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none mb-6 font-mono text-lg"
            placeholder={placeholder}
            autoFocus
        />

        <div className="flex justify-end gap-3">
          <button 
            onClick={onClose}
            className="px-4 py-2 rounded-lg font-bold text-sm text-gray-600 bg-gray-100 hover:bg-gray-200 transition"
          >
            Cancel
          </button>
          <button 
            onClick={() => { onConfirm(value); onClose(); }}
            className="px-6 py-2 rounded-lg font-bold text-sm text-white bg-blue-600 hover:bg-blue-700 transition"
          >
            Save
          </button>
        </div>
      </div>
    </div>
  );
}

"use client";
import Link from 'next/link';
import Image from 'next/image';
import { useState } from 'react';
import { signIn } from 'next-auth/react';
import { useRouter } from 'next/navigation';

export default function LoginForm() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();

  const handleLogin = async (provider: 'google' | 'credentials') => {
    setIsLoading(true);
    setError(null);
    
    let result;
    if (provider === 'credentials') {
      result = await signIn(provider, { redirect: false, email, password });
    } else {
      result = await signIn(provider, { callbackUrl: '/portal' });
    }

    if (result?.error) {
      setError("Invalid email or password. Please try again.");
      setIsLoading(false);
    } else if (result?.ok && provider === 'credentials') {
      router.push('/portal/dashboard');
    }
  };

  return (
    <main className="min-h-screen flex items-center justify-center bg-gray-50 p-4">
      <div className="absolute top-0 left-0 w-full h-1/2 bg-aerojet-blue z-0"></div>
      <div className="relative z-10 w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden">
        <div className="bg-white p-8 text-center border-b border-gray-100">
          <Link href="/"><Image src="/logo-navbar.png" alt="Aerojet Academy" width={180} height={50} className="mx-auto object-contain"/></Link>
          <h2 className="mt-4 text-2xl font-bold text-gray-800">Student Portal</h2>
          <p className="text-sm text-gray-500 mt-1">Sign in to continue</p>
        </div>
        <div className="p-8">
          <div className="space-y-3">
            <button onClick={() => handleLogin('google')} disabled={isLoading} className="w-full flex items-center justify-center gap-3 py-3 px-4 rounded-lg font-semibold text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 transition-all">
              <Image src="/google-logo.svg" alt="Google" width={20} height={20} />
              Sign in with Google
            </button>
          </div>
          <div className="my-6 flex items-center"><div className="grow border-t border-gray-200"></div><span className="shrink mx-4 text-xs text-gray-400 uppercase">Or</span><div className="grow border-t border-gray-200"></div></div>
          <form onSubmit={(e) => { e.preventDefault(); handleLogin('credentials'); }} className="space-y-4">
            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700">Email Address</label>
              <input id="email" type="email" required value={email} onChange={(e) => setEmail(e.target.value)} className="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-aerojet-sky"/>
            </div>
            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700">Password</label>
              <input id="password" type="password" required value={password} onChange={(e) => setPassword(e.target.value)} className="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-aerojet-sky"/>
            </div>
            {error && <p className="text-xs text-red-600">{error}</p>}
            <button type="submit" disabled={isLoading} className={`w-full py-3 rounded-lg text-white font-bold transition-all ${isLoading ? "bg-gray-400" : "bg-aerojet-blue hover:bg-aerojet-sky"}`}>
              {isLoading ? "Signing in..." : "Sign In with Email"}
            </button>
          </form>
          <div className="mt-6 text-center text-sm"><Link href="#" className="font-semibold text-aerojet-sky hover:text-aerojet-blue">Forgot Password?</Link></div>
        </div>
      </div>
    </main>
  );
}

"use client";
import { useSession } from "next-auth/react";

type PortalHeaderProps = {
  onMenuClick: () => void;
};

export default function PortalHeader({ onMenuClick }: PortalHeaderProps) {
  const { data: session } = useSession();
  const role = (session?.user as any)?.role;

  // Determine title based on role
  let title = "Student Portal";
  if (role === 'ADMIN') title = "Admin Console";
  else if (role === 'STAFF') title = "Staff Portal";
  else if (role === 'INSTRUCTOR') title = "Instructor Portal";

  return (
    <header className={`p-4 shadow-md flex items-center ${role === 'ADMIN' ? 'bg-slate-900 text-white' : 'bg-aerojet-blue text-white'}`}>
      <button onClick={onMenuClick} className="p-1">
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16"></path></svg>
      </button>
      <h1 className="ml-4 font-semibold text-lg">{title}</h1>
    </header>
  );
}
"use client";
import Link from 'next/link';
import Image from 'next/image';
import { usePathname } from 'next/navigation';
import { signOut } from "next-auth/react";
import { User } from 'next-auth';
import { toast } from 'sonner';
import { useState } from 'react';
import ConfirmationModal from '@/components/modal/ConfirmationModal';

// --- Icons ---
const Icons = {
  Dashboard: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>,
  Courses: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>,
  Exams: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>,
  Results: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
  Finance: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
  Wallet: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>,
  Profile: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
  SignOut: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
  Collapse: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 19l-7-7 7-7m8 14l-7-7 7-7" /></svg>,
  Expand: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 5l7 7-7 7M5 5l7 7-7 7" /></svg>,
};

// --- Menu Items ---
const menuItems = [
  { title: "Dashboard", href: "/portal/dashboard", icon: Icons.Dashboard },
  { title: "My Courses", href: "/portal/courses", icon: Icons.Courses },
  { title: "Exam Bookings", href: "/portal/exams", icon: Icons.Exams },
  { title: "Results", href: "/portal/results", icon: Icons.Results },
  { title: "Finance & Ledger", href: "/portal/finance", icon: Icons.Finance }, // Distinct Icon
  { title: "Exam Wallet", href: "/portal/wallet", icon: Icons.Wallet }, // Distinct Icon
  { title: "My Profile", href: "/portal/profile", icon: Icons.Profile },
];

export default function PortalSidebar({ 
  user, 
  collapsed = false, 
  setCollapsed 
}: { 
  user: User; 
  collapsed?: boolean; 
  setCollapsed?: (val: boolean) => void;
}) {
  const [isSignOutModalOpen, setIsSignOutModalOpen] = useState(false);
  const pathname = usePathname();

  const handleSignOut = () => {
    toast.promise(signOut({ callbackUrl: '/portal/login' }), {
      loading: 'Signing out...',
      success: 'You have been signed out.',
      error: 'Failed to sign out.',
    });
  };

  return (
    <>
      <aside 
        className={`bg-aerojet-blue text-white flex flex-col h-full shadow-xl transition-[width] duration-300 ease-in-out relative ${
          collapsed ? 'w-20' : 'w-64'
      }`}
    >
        
        {/* Desktop Toggle Button */}
        {setCollapsed && (
          <button 
            onClick={() => setCollapsed(!collapsed)}
            className="hidden lg:flex absolute -right-3 top-20 bg-aerojet-sky text-white p-1.5 rounded-full shadow-md z-50 items-center justify-center border-2 border-white hover:bg-aerojet-soft-blue transition-colors"
          >
            {collapsed ? <Icons.Expand /> : <Icons.Collapse />}
          </button>
        )}

        {/* Logo */}
        <div className="h-16 flex items-center justify-center border-b border-white/10 mx-4 shrink-0">
          <Link href="/">
            {collapsed ? (
              <Image src="/android-chrome-512x512.png" alt="AA" width={32} height={32} className="object-contain" />
            ) : (
              <Image src="/ATA_logo_hor_onDark.png" alt="Aerojet Academy" width={140} height={35} className="object-contain" />
            )}
          </Link>
        </div>
        
        {/* User Profile */}
        <div className={`py-6 flex flex-col items-center justify-center shrink-0 transition-all duration-300 ${collapsed ? 'px-2' : 'px-4'}`}>
          {user.image && (
            <Image 
              src={user.image} 
              alt="Profile" 
              width={collapsed ? 40 : 64} 
              height={collapsed ? 40 : 64} 
              className="rounded-full border-2 border-aerojet-sky shadow-sm transition-all duration-300"
            />
          )}
          {!collapsed && (
            <div className="mt-3 text-center w-full animate-in fade-in duration-300">
              <p className="font-semibold text-sm truncate w-full">{user.name}</p>
              <p className="text-xs text-gray-400 truncate w-full">{user.email}</p>
            </div>
          )}
        </div>

        {/* Navigation Links (Scrollable area) */}
        <nav className="flex-1 overflow-y-auto px-3 mt-2 space-y-1 no-scrollbar">
          {menuItems.map((item) => {
            const isActive = pathname === item.href;
            return (
              <Link 
                key={item.title} 
                href={item.href} 
                className={`flex items-center px-3 py-3 rounded-lg transition-all group ${
                  isActive ? "bg-aerojet-sky text-white shadow-md font-medium" : "text-gray-300 hover:bg-white/10 hover:text-white"
                } ${collapsed ? 'justify-center' : ''}`}
                title={collapsed ? item.title : ''}
              >
                <item.icon />
                {!collapsed && <span className="ml-3 text-sm truncate">{item.title}</span>}
              </Link>
            );
          })}
        </nav>

        {/* Sign Out Button (Fixed at bottom) */}
        <div className="p-4 border-t border-white/10 shrink-0">
          <button 
            onClick={() => setIsSignOutModalOpen(true)} 
            className={`flex items-center w-full p-2 rounded-lg text-red-300 hover:bg-red-500/10 hover:text-red-200 transition-colors ${
              collapsed ? 'justify-center' : ''
            }`} 
            title="Sign Out"
          >
            <Icons.SignOut />
            {!collapsed && <span className="ml-3 text-sm font-medium">Sign Out</span>}
          </button>
        </div>
      </aside>

      <ConfirmationModal 
        isOpen={isSignOutModalOpen} 
        onClose={() => setIsSignOutModalOpen(false)} 
        onConfirm={handleSignOut} 
        title="Confirm Sign Out" 
        message="Are you sure you want to sign out?"
      />
    </>
  );
}
"use client";

type Props = {
  src?: string | null;
  alt: string;
  fallbackInitial?: string;
};

export default function ProtectedImage({ src, alt, fallbackInitial }: Props) {
  // If no source is provided, show the initials fallback
  if (!src || src === "") {
    return (
      <div className="w-full h-full bg-slate-200 flex items-center justify-center font-bold text-slate-500 text-2xl uppercase">
        {fallbackInitial || "?"}
      </div>
    );
  }

  return (
    <div 
      className="relative w-full h-full bg-slate-100 flex items-center justify-center overflow-hidden"
      onContextMenu={(e) => e.preventDefault()} // Block Right Click
    >
      <img 
          src={src} 
          alt={alt} 
          className="w-full h-full object-cover pointer-events-none select-none"
          onError={(e) => {
            // If the image fails to load, hide the broken icon and show the fallback
            const target = e.target as HTMLImageElement;
            target.style.display = 'none';
            target.parentElement!.innerHTML = `<div class="flex items-center justify-center w-full h-full font-bold text-slate-400">${fallbackInitial || '?'}</div>`;
          }}
      />
    </div>
  );
}

"use client";
import Link from "next/link";

export default function InstructorDashboard({ session }: { session: any }) {
  return (
    <div className="space-y-8">
      <div className="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
        <h1 className="text-3xl font-bold text-aerojet-blue">Instructor Console</h1>
        <p className="text-slate-500 mt-2">Welcome back, {session.user.name}. Manage your classes and attendance here.</p>
      </div>

      <div className="grid md:grid-cols-3 gap-6">
        <Link href="/staff/materials" className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:border-aerojet-sky transition group">
            <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-lg flex items-center justify-center mb-4 text-2xl group-hover:bg-blue-600 group-hover:text-white transition">📚</div>
            <h3 className="font-bold text-slate-800 text-lg">My Courses</h3>
            <p className="text-sm text-gray-500 mt-2">View assigned modules and materials.</p>
        </Link>

        <Link href="/staff/attendance" className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:border-aerojet-sky transition group">
            <div className="w-12 h-12 bg-purple-50 text-purple-600 rounded-lg flex items-center justify-center mb-4 text-2xl group-hover:bg-purple-600 group-hover:text-white transition">📝</div>
            <h3 className="font-bold text-slate-800 text-lg">Mark Attendance</h3>
            <p className="text-sm text-gray-500 mt-2">Daily register for your active classes.</p>
        </Link>

        <Link href="/staff/results" className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:border-aerojet-sky transition group">
            <div className="w-12 h-12 bg-green-50 text-green-600 rounded-lg flex items-center justify-center mb-4 text-2xl group-hover:bg-green-600 group-hover:text-white transition">📊</div>
            <h3 className="font-bold text-slate-800 text-lg">Publish Results</h3>
            <p className="text-sm text-gray-500 mt-2">Input exam scores for your students.</p>
        </Link>
      </div>
    </div>
  );
}

"use client";
import Link from 'next/link';
import Image from 'next/image';
import { usePathname } from 'next/navigation';
import { signOut } from "next-auth/react";
import { toast } from 'sonner';
import { useState, useEffect } from 'react';
import ConfirmationModal from '@/components/modal/ConfirmationModal';

// --- Robust Icons ---
const Icons = {
  Dashboard: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
  Applications: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>,
  Courses: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>,
  Exams: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
  Results: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
  Finance: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
  Students: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 14l9-5-9-5-9 5 9 5z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.083 0 01.665-6.479L12 14z" /></svg>,
  Users: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>,
  Settings: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
  SignOut: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
  Collapse: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 19l-7-7 7-7m8 14l-7-7 7-7" /></svg>,
  Expand: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 5l7 7-7 7M5 5l7 7-7 7" /></svg>,
};

// --- Menu Data ---
const allMenuItems = [
  { title: "Dashboard", href: "/staff/dashboard", icon: Icons.Dashboard, roles: ['ADMIN', 'STAFF', 'INSTRUCTOR'] },
  { title: "Applications", href: "/staff/applications", icon: Icons.Applications, roles: ['ADMIN', 'STAFF'] },
  { title: "Courses", href: "/staff/courses", icon: Icons.Courses, roles: ['ADMIN', 'STAFF'] },
  { title: "Exam Management", href: "/staff/exams", icon: Icons.Exams, roles: ['ADMIN', 'STAFF'] },
  { title: "Results Publishing", href: "/staff/results", icon: Icons.Results, roles: ['ADMIN', 'STAFF', 'INSTRUCTOR'] }, 
  { title: "Teaching Materials", href: "/staff/materials", icon: Icons.Courses, roles: ['INSTRUCTOR'] }, 
  { title: "Attendance", href: "/staff/attendance", icon: Icons.Students, roles: ['ADMIN', 'STAFF', 'INSTRUCTOR'] }, 
  { title: "Finance & Verify", href: "/staff/finance", icon: Icons.Finance, roles: ['ADMIN', 'STAFF'] },
  { title: "Student Directory", href: "/staff/students", icon: Icons.Students, roles: ['ADMIN', 'STAFF'] },
  { title: "User Roles", href: "/staff/users", icon: Icons.Users, roles: ['ADMIN'] }, 
  { title: "System Settings", href: "/staff/settings", icon: Icons.Settings, roles: ['ADMIN', 'STAFF'] },
];

export default function StaffSidebar({ user, collapsed = false, setCollapsed }: { user: any, collapsed?: boolean, setCollapsed?: (v: boolean) => void }) {
  const [isSignOutModalOpen, setIsSignOutModalOpen] = useState(false);
  const pathname = usePathname();

  // Normalize role to uppercase for matching
  const userRole = (user?.role || 'STUDENT').toUpperCase();
  
  // Filter items
  const visibleItems = allMenuItems.filter(item => item.roles.includes(userRole));

  const handleSignOut = () => {
    toast.promise(signOut({ callbackUrl: '/portal/login' }), {
      loading: 'Signing out...', success: 'Signed out.', error: 'Failed.'
    });
  };

  return (
    <>
      <aside className={`bg-slate-900 text-white flex flex-col h-full shadow-xl transition-all duration-300 relative ${collapsed ? 'w-20' : 'w-64'}`}>
        
        {/* Toggle Button for Desktop */}
        {setCollapsed && (
          <button onClick={() => setCollapsed(!collapsed)} className="hidden lg:flex absolute -right-3 top-20 bg-slate-700 text-white p-1.5 rounded-full shadow-md z-50 border-2 border-slate-500 hover:bg-slate-600 transition-colors">
            {collapsed ? <Icons.Expand /> : <Icons.Collapse />}
          </button>
        )}

        <div className="h-16 flex items-center justify-center border-b border-white/10 mx-4 shrink-0">
          <Link href="/">
            {collapsed ? <span className="font-bold text-xl text-blue-400">AA</span> : <Image src="/ATA_logo_hor_onDark.png" alt="Aerojet Academy" width={140} height={35} className="object-contain" />}
          </Link>
        </div>
        
        <div className={`py-6 flex flex-col items-center justify-center shrink-0 transition-all duration-300 ${collapsed ? 'px-2' : 'px-4'}`}>
          <div className={`rounded-full bg-slate-700 flex items-center justify-center font-bold text-white transition-all mx-auto overflow-hidden relative ${collapsed ? 'w-10 h-10 text-sm' : 'w-16 h-16 text-xl'}`}>
            {user.image ? <Image src={user.image} alt="User" fill className="object-cover" /> : <span>{user.name?.[0]}</span>}
          </div>
          {!collapsed && (
            <div className="mt-3 text-center w-full animate-in fade-in duration-300">
              <p className="font-semibold text-sm truncate w-full">{user.name}</p>
              <span className={`text-[10px] px-2 py-0.5 rounded text-white font-bold uppercase tracking-wider ${userRole === 'ADMIN' ? 'bg-red-600' : 'bg-blue-600'}`}>{userRole}</span>
            </div>
          )}
        </div>

        {/* Navigation area - ensures it takes remaining space */}
        <nav className="flex-1 overflow-y-auto px-3 mt-2 space-y-1 no-scrollbar min-h-0">
          {visibleItems.length > 0 ? visibleItems.map((item) => {
            const isActive = pathname.startsWith(item.href);
            return (
              <Link key={item.title} href={item.href} className={`flex items-center px-3 py-3 rounded-lg transition-all group ${isActive ? "bg-blue-600 text-white font-bold shadow-lg" : "text-slate-400 hover:bg-white/5 hover:text-white"} ${collapsed ? 'justify-center' : ''}`} title={collapsed ? item.title : ''}>
                <item.icon />
                {!collapsed && <span className="ml-3 text-sm truncate">{item.title}</span>}
              </Link>
            );
          }) : (
            <p className="text-[10px] text-slate-500 text-center p-4">No access authorized for role: {userRole}</p>
          )}
        </nav>

        <div className="p-4 border-t border-white/10 shrink-0">
          <button onClick={() => setIsSignOutModalOpen(true)} className={`flex items-center w-full p-2 rounded-lg text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-colors ${collapsed ? 'justify-center' : ''}`} title="Sign Out">
            <Icons.SignOut />
            {!collapsed && <span className="ml-3 text-sm font-medium">Sign Out</span>}
          </button>
        </div>
      </aside>

      <ConfirmationModal isOpen={isSignOutModalOpen} onClose={() => setIsSignOutModalOpen(false)} onConfirm={handleSignOut} title="Sign Out" message="Exit management portal?"/>
    </>
  );
}

"use client";
import Link from 'next/link';

export default function AdmissionsProcess() {
  const steps = [
    {
      step: "01",
      title: "Registration Invoice",
      desc: "We will first issue an invoice for the GHS 350 registration fee. Payment of the registration fee is required before you can complete the online application."
    },
    {
      step: "02",
      title: "Online Application Form",
      desc: "Once payment is received and you send us confirmation, we will provide a link to complete the online application form for Academy review and approval."
    },
    {
      step: "03",
      title: "Confirmation Invoice",
      desc: "Upon approval, we will issue an invoice for the Confirmation payment applicable to your selected training programme. Once paid, your seat is secured."
    },
    {
      step: "04",
      title: "Onboarding & Access",
      desc: "After confirmation, you will be onboarded onto our student portal. You will receive your start date or receive a link to access your learning materials."
    }
  ];

  return (
    <section className="py-24 bg-white">
      <div className="container mx-auto px-6">
        <div className="text-center mb-20">
          <h2 className="text-3xl md:text-5xl font-black text-aerojet-blue uppercase tracking-tight mb-4">
            How to Enroll
          </h2>
          <p className="text-slate-500 max-w-2xl mx-auto font-medium">
            Follow our structured enrollment pathway to secure your place at the academy.
          </p>
        </div>

        <div className="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          {steps.map((item, index) => (
            <div key={index} className="relative p-8 rounded-3xl bg-slate-50 border border-slate-100 group hover:border-aerojet-sky transition-all duration-500 shadow-sm hover:shadow-xl">
              <div className="w-12 h-12 rounded-2xl bg-aerojet-sky text-white flex items-center justify-center font-black text-xl mb-6 shadow-lg shadow-blue-100 group-hover:scale-110 transition-transform">
                {item.step}
              </div>
              <h3 className="text-lg font-black text-aerojet-blue mb-3 uppercase tracking-tight">
                {item.title}
              </h3>
              <p className="text-sm text-slate-500 leading-relaxed font-medium">
                {item.desc}
              </p>
            </div>
          ))}
        </div>

        <div className="mt-16 text-center">
          <Link href="/register" className="bg-aerojet-blue text-white px-10 py-4 rounded-xl font-black uppercase tracking-widest text-sm hover:bg-aerojet-sky shadow-xl transition-all active:scale-95 inline-block">
            Start Your Registration →
          </Link>
        </div>
      </div>
    </section>
  );
}

"use client";
import { useState } from "react";
import { toast } from "sonner";

export default function ContactForm() {
  const [formData, setFormData] = useState({ name: "", email: "", message: "" });
  const [isSending, setIsSending] = useState(false);

  const inputClasses = "mt-1 block w-full px-4 py-3 border border-slate-300 rounded-xl bg-white text-slate-900 shadow-sm focus:outline-none focus:border-aerojet-sky focus:ring-1 focus:ring-aerojet-sky transition-all placeholder:text-slate-400";

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSending(true);

    try {
      const res = await fetch("/api/contact", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (res.ok) {
        toast.success("Message sent! Our team will contact you shortly.");
        setFormData({ name: "", email: "", message: "" });
      } else {
        toast.error("Failed to send message.");
      }
    } catch (error) {
      toast.error("An unexpected error occurred.");
    } finally {
      setIsSending(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <div>
        <label htmlFor="name" className="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1">Full Name</label>
        <input 
          type="text" id="name" required className={inputClasses} placeholder="John Doe"
          value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})}
        />
      </div>

      <div>
        <label htmlFor="email" className="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1">Email Address</label>
        <input 
          type="email" id="email" required className={inputClasses} placeholder="john@example.com"
          value={formData.email} onChange={(e) => setFormData({...formData, email: e.target.value})}
        />
      </div>

      <div>
        <label htmlFor="message" className="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1">Your Enquiry</label>
        <textarea 
          id="message" rows={5} required className={inputClasses} placeholder="How can we help you today?"
          value={formData.message} onChange={(e) => setFormData({...formData, message: e.target.value})}
        ></textarea>
      </div>

      <div className="pt-4">
        <button 
          type="submit" disabled={isSending}
          className="w-full bg-aerojet-sky text-white font-black uppercase tracking-widest text-sm py-4 rounded-xl shadow-lg hover:bg-aerojet-blue transition-all disabled:opacity-50 active:scale-95"
        >
          {isSending ? "Processing..." : "Send Message →"}
        </button>
      </div>
    </form>
  );
}

import Image from 'next/image';

const partners = [
  { name: 'EASA', src: '/easa-logo.png', width: 120, height: 40 },
  { name: 'USTDA', src: '/ustda.jpg', width: 120, height: 40 },
  { name: 'Ghana Air Force', src: '/Airforce-logo.png', width: 120, height: 40 },
  { name: 'Joramco', src: '/Joramco-Logo-AI.png', width: 120, height: 35 },
  { name: 'Gaptek', src: '/Logotip-GAPTEK.jpg', width: 120, height: 40 },
  { name: 'Aerojet Foundation', src: '/foundation-logo.png', width: 130, height: 40 },
];

export default function Credibility() {
  return (
    <section className="bg-slate-50 py-16">
      <div className="container mx-auto px-6 text-center">
        <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-12">
          Partners & Certification Standards
        </h3>
        <div className="flex flex-wrap justify-center items-center gap-x-12 gap-y-8 md:gap-x-20">
          {partners.map((partner) => (
            <div key={partner.name} className="grayscale hover:grayscale-0 transition-all duration-500 opacity-60 hover:opacity-100 transform hover:scale-105">
              <Image
                src={partner.src}
                alt={partner.name}
                width={partner.width}
                height={partner.height}
                className="object-contain"
              />
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}
import Link from 'next/link';
import Image from 'next/image';

export default function Footer() {
  return (
    <footer className="bg-aerojet-blue text-white">
      <div className="container mx-auto px-6 py-10">
        <div className="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-5 gap-12">
          {/* Column 1: Logo */}
          <div className="col-span-1 lg:col-span-1">
            <Image
              src="/logo-footer.png"
              alt="Aerojet Academy Footer Logo"
              width={160}
              height={40}
              className="mb-4"
            />
            <p className="text-gray-400 text-sm leading-relaxed">
              The future of aviation training starts here. EASA-aligned technical excellence in the heart of Accra.
            </p>
          </div>

          {/* Column 2: Quick Links */}
          <div>
            <h3 className="font-bold text-sm uppercase tracking-widest mb-4 text-aerojet-sky">Quick Links</h3>
            <ul className="space-y-2 text-gray-300 text-sm">
              <li><Link href="/" className="hover:text-white transition">Home</Link></li>
              <li><Link href="/about" className="hover:text-white transition">About Us</Link></li>
              <li><Link href="/news" className="hover:text-white transition">Newsroom</Link></li>
              <li><Link href="/legal/terms" className="hover:text-white transition">Application Terms</Link></li>
            </ul>
          </div>

          {/* Column 3: Training */}
          <div>
  <h3 className="font-bold text-sm uppercase tracking-widest mb-4 text-aerojet-sky">Programmes</h3>
  <ul className="space-y-2 text-gray-300 text-sm">
    <li><Link href="/courses/easa-full-time" className="hover:text-white transition">Full-Time B1/B2</Link></li>
    <li><Link href="/courses/easa-modular" className="hover:text-white transition">Modular Training</Link></li>
    <li><Link href="/courses/examination-only" className="hover:text-white transition">Examination-Only</Link></li> {/* Added */}
    <li><span className="text-gray-500 italic">Pilot Training (Soon)</span></li>
    <li><span className="text-gray-500 italic">Cabin Crew (Soon)</span></li>
  </ul>
</div>

          {/* Column 4: Admissions */}
          <div>
            <h3 className="font-bold text-sm uppercase tracking-widest mb-4 text-aerojet-sky">Admissions</h3>
            <ul className="space-y-2 text-gray-300 text-sm">
              <li><Link href="/admissions" className="hover:text-white transition">How to Enroll</Link></li>
              <li><Link href="/admissions/fees" className="hover:text-white transition">Fees & Rules</Link></li>
              <li><Link href="/portal/login" className="hover:text-white transition">Student Portal</Link></li>
            </ul>
          </div>
          
          {/* Column 5: Contact - WITH ICONS */}
          <div className="col-span-1">
            <h3 className="font-bold text-sm uppercase tracking-widest mb-4 text-aerojet-sky">Contact Us</h3>
            <ul className="space-y-4 text-sm text-gray-300">
              <li className="flex items-start gap-3">
                <svg className="w-5 h-5 text-aerojet-sky shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                <span>ATTC Small Engines Department, Kokomlemle, Accra, Ghana</span>
              </li>
              <li className="flex items-center gap-3">
                <svg className="w-5 h-5 text-aerojet-sky shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 004.516 4.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                <a href="tel:+233209848423" className="hover:text-white transition">+233-20-984-8423</a>
              </li>
              <li className="flex items-center gap-3">
                <svg className="w-5 h-5 text-aerojet-sky shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                <a href="mailto:trainingprograms@aerojet-academy.com" className="hover:text-white transition break-all">trainingprograms@aerojet-academy.com</a>
              </li>
            </ul>
          </div>
        </div>
        
        <div className="mt-12 pt-8 border-t border-white/5 flex flex-col items-center gap-6 text-center">
    
    {/* Social Icons - Centered */}
    <div className="flex gap-6">
        <a href="https://facebook.com" target="_blank" className="text-gray-400 hover:text-aerojet-sky transition-colors">
            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1V12h3v3h-3v6.8c4.56-.93 8-4.96 8-9.8z"/></svg>
        </a>
        <a href="https://x.com" target="_blank" className="text-gray-400 hover:text-aerojet-sky transition-colors">
            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932 6.064-6.932zm-1.292 19.49h2.039L6.486 3.24H4.298l13.311 17.403z"/></svg>
        </a>
        <a href="https://instagram.com" target="_blank" className="text-gray-400 hover:text-aerojet-sky transition-colors">
            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.774 4.919 4.851.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.075-1.664 4.704-4.919 4.851-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.775-4.919-4.851-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.075 1.664-4.704 4.919-4.851 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-5.838 2.435-5.838 5.838s2.435 5.838 5.838 5.838 5.838-2.435 5.838-5.838-2.435-5.838-5.838-5.838zm0 9.674c-2.119 0-3.836-1.717-3.836-3.836s1.717-3.836 3.836-3.836 3.836 1.717 3.836 3.836-1.717 3.836-3.836 3.836zm5.272-11.369c0 .763-.619 1.384-1.383 1.384-.764 0-1.383-.621-1.383-1.384 0-.764.619-1.384 1.383-1.384.764 0 1.383.62 1.383 1.384z"/></svg>
        </a>
        <a href="https://linkedin.com" target="_blank" className="text-gray-400 hover:text-aerojet-sky transition-colors">
            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
        </a>
    </div>

    {/* Copyright Text - Centered */}
    <p className="text-[10px] text-gray-500 uppercase tracking-[0.2em] font-bold">
        &copy; {new Date().getFullYear()} Aerojet Aviation Training Academy. All Rights Reserved.
    </p>
</div>
  </div>
  </footer>
  );
}

import Link from "next/link";

export default function Hero() {
  return (
    <section className="relative h-screen w-full flex items-center justify-start bg-black overflow-hidden">
      {/* High-quality Video or Image Background */}
      <div 
        className="absolute inset-0 z-0 scale-105"
        style={{ 
          backgroundImage: "url('https://images.unsplash.com/photo-1517976487492-5750f3195933?q=80&w=2070&auto=format&fit=crop')",
          backgroundSize: 'cover',
          backgroundPosition: 'center'
        }}
      />
      
      {/* Palo Alto Style Dark Gradient Overlay */}
      <div className="absolute inset-0 bg-linear-to-r from-black via-black/60 to-transparent z-10" />

      {/* Content Area */}
      <div className="container mx-auto px-8 relative z-20 mt-20">
        <div className="max-w-2xl">
          <div className="w-20 h-1 bg-aerojet-gold mb-6" />
          <h1 className="text-6xl md:text-8xl font-black text-white mb-6 leading-[0.9] tracking-tighter">
            THE FUTURE <br/> OF <span className="text-aerojet-gold">FLIGHT.</span>
          </h1>
          <p className="text-lg text-gray-300 mb-8 max-w-lg font-light leading-relaxed">
            Elevate your potential with the region's premier aviation academy. Professional certifications in Engineering, Piloting, and Safety.
          </p>
          
          <div className="flex space-x-6">
            <Link href="/courses" className="group flex items-center bg-white text-black px-8 py-4 font-bold uppercase text-sm tracking-widest hover:bg-aerojet-gold transition">
              Explore Programs
              <span className="ml-2 transform group-hover:translate-x-2 transition">→</span>
            </Link>
          </div>
        </div>
      </div>

      {/* Floating Scroll Indicator */}
      <div className="absolute bottom-10 left-1/2 -translate-x-1/2 z-20 animate-bounce">
        <div className="w-6 h-10 border-2 border-white/30 rounded-full flex justify-center pt-2">
          <div className="w-1 h-2 bg-white rounded-full" />
        </div>
      </div>
    </section>
  );
}
"use client";
import Link from "next/link";
import Image from "next/image";
import { useState, useEffect } from "react";

const slides = [
  {
    src: "/hero-slide1.jpg",
    headline: "Your Journey to Becoming a Certified Aircraft Technician Starts Here.",
    subhead: "World-class aviation technical training in Accra — structured pathways to EASA Part-66 B1/B2 standards."
  },
  {
    src: "/hero-slide2.jpg",
    headline: "Discipline, Structure, and Excellence in Aviation.",
    subhead: "Join a cohort of dedicated professionals training for a global career."
  },
  {
    src: "/hero-slide3.jpg",
    headline: "State-of-the-Art Training for a High-Tech Industry.",
    subhead: "Learn with modern tools and a curriculum designed for real-world MRO environments."
  },
];

export default function HeroSlider() {
  const [currentSlide, setCurrentSlide] = useState(0);
  const isPortalLive = process.env.NEXT_PUBLIC_PORTAL_LIVE === 'true';

  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentSlide((prev) => (prev === slides.length - 1 ? 0 : prev + 1));
    }, 7000); 
    return () => clearInterval(timer);
  }, []);

  return (
    <section className="relative h-screen w-full flex items-center justify-center bg-black overflow-hidden">
      {/* Background Images */}
      {slides.map((slide, index) => (
        <Image
          key={index}
          src={slide.src}
          alt="Aerojet Academy background"
          layout="fill"
          objectFit="cover"
          className={`transition-opacity duration-1000 ${index === currentSlide ? 'opacity-100' : 'opacity-0'}`}
          priority={index === 0}
        />
      ))}
      
      {/* Dark Overlay */}
      <div className="absolute inset-0 bg-black/60 z-10" />

      {/* Content Area - Centered */}
      <div className="container mx-auto px-6 relative z-20 text-center">
        <div className="max-w-4xl mx-auto">
          <h1 className="text-4xl md:text-6xl font-black text-white mb-6 leading-tight">
            {slides[currentSlide].headline}
          </h1>
          <p className="text-lg text-gray-200 mb-10 max-w-2xl mx-auto">
            {slides[currentSlide].subhead}
          </p>
          
          <div className="flex flex-wrap gap-4 justify-center">
            {isPortalLive ? (
                <Link href="/register" className="bg-aerojet-sky text-white px-8 py-4 rounded-md font-bold hover:bg-aerojet-soft-blue transition shadow-lg">
                  Start Registration
                </Link>
            ) : (
                <Link href="/contact" className="bg-aerojet-sky text-white px-8 py-4 rounded-md font-bold hover:bg-aerojet-soft-blue transition shadow-lg">
                  Contact Admissions
                </Link>
            )}
            <Link href="/courses" className="border-2 border-white/80 text-white px-8 py-4 rounded-md font-bold hover:bg-white hover:text-aerojet-blue transition">
              Explore Courses
            </Link>
          </div>
        </div>
      </div>
    </section>
  );
}

import Link from 'next/link';

export default function HomeContact() {
  return (
    <section className="bg-slate-900 py-24 px-6">
      <div className="max-w-5xl mx-auto rounded-[3rem] bg-aerojet-sky p-8 md:p-16 text-white shadow-2xl relative overflow-hidden flex flex-col lg:flex-row justify-between items-center gap-10">
        
        {/* Decorative Background Icon */}
        <div className="absolute -bottom-10 -right-10 opacity-10">
            <svg className="w-64 h-64" fill="currentColor" viewBox="0 0 24 24"><path d="M21 16.5C21 16.88 20.79 17.21 20.47 17.38L12.57 21.82C12.41 21.94 12.21 22 12 22C11.79 22 11.59 21.94 11.43 21.82L3.53 17.38C3.21 17.21 3 16.88 3 16.5V7.5C3 7.12 3.21 6.79 3.53 6.62L11.43 2.18C11.59 2.06 11.79 2 12 2C12.21 2 12.41 2.06 12.57 2.18L20.47 6.62C20.79 6.79 21 7.12 21 7.5V16.5Z" /></svg>
        </div>

        <div className="relative z-10 text-center lg:text-left">
          <h2 className="text-3xl md:text-5xl font-black uppercase tracking-tight mb-4">
            Ready to Begin?
          </h2>
          <p className="text-blue-100 text-lg font-medium max-w-lg leading-relaxed">
            Contact our admissions team today to request your registration invoice or to ask any questions about our 2026/2027 schedule.
          </p>
          <div className="mt-8 flex flex-col md:flex-row gap-6 text-sm font-bold uppercase tracking-widest">
            <a href="tel:+233209848423" className="flex items-center gap-2 hover:text-aerojet-blue transition"><span>📞</span> +233-20-984-8423</a>
            <a href="mailto:trainingprograms@aerojet-academy.com" className="flex items-center gap-2 hover:text-aerojet-blue transition"><span>✉️</span> Email Admissions</a>
          </div>
        </div>

        <div className="relative z-10 shrink-0 flex flex-col gap-4 w-full md:w-auto">
          <Link href="/register" className="bg-white text-aerojet-blue px-10 py-5 rounded-2xl font-black uppercase tracking-[0.2em] text-xs text-center shadow-xl hover:bg-slate-900 hover:text-white transition-all">
            Start Registration
          </Link>
          <Link href="/contact" className="bg-white/10 backdrop-blur-md border border-white/20 text-white px-10 py-5 rounded-2xl font-black uppercase tracking-[0.2em] text-xs text-center hover:bg-white/20 transition-all">
            General Enquiry
          </Link>
        </div>
      </div>
    </section>
  );
}

"use client";
import Link from "next/link";
import { usePathname } from "next/navigation";

export default function MobileStickyBar() {
  const pathname = usePathname();
  const isPortalLive = process.env.NEXT_PUBLIC_PORTAL_LIVE === 'true';

  // List of paths where the sticky bar should be HIDDEN
  const hiddenPaths = ["/portal", "/staff", "/register", "/contact", "/studio"];

  // Check if the current path starts with any of the hidden paths
  const shouldHide = hiddenPaths.some((path) => pathname.startsWith(path));

  if (shouldHide) {
    return null;
  }

  return (
    <div className="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4 z-40 md:hidden flex gap-3 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
      <Link 
        href="/contact" 
        className="flex-1 border-2 border-aerojet-blue text-aerojet-blue font-bold py-3 rounded text-center text-sm uppercase tracking-wide"
      >
        Enquire
      </Link>
      
      {isPortalLive ? (
          <Link 
            href="/register" 
            className="flex-1 bg-aerojet-sky text-white font-bold py-3 rounded text-center text-sm uppercase tracking-wide shadow-md"
          >
            Apply Now
          </Link>
      ) : (
          <Link 
            href="/courses" 
            className="flex-1 bg-aerojet-sky text-white font-bold py-3 rounded text-center text-sm uppercase tracking-wide shadow-md"
          >
            View Courses
          </Link>
      )}
    </div>
  );
}

"use client";
import Link from "next/link";
import Image from "next/image";
import { useState, useEffect } from "react";
import { useSession } from "next-auth/react"; // Added to detect login state

// --- Data for navigation links ---
const navLinks = {
  courses: [
    { title: "EASA Part-66 (Full-Time)", href: "/courses/easa-full-time" },
    { title: "EASA Part-66 (Modular)", href: "/courses/easa-modular" },
    { title: "Examination-Only", href: "/courses/examination-only" },
    { title: "Revision Support", href: "/courses/revision-support" }, // Added this
    { title: "Module List (M1–M17)", href: "/courses/modules" },
    { title: "Cabin Crew (Soon)", href: "/courses/cabin-crew" },
    { title: "Pilot Training (Soon)", href: "/courses/pilot-training" },
    { title: "Exam Schedule (2026/27)", href: "/courses/exam-schedule" }
  ],
  admissions: [
    { title: "How to Apply", href: "/admissions" },
    { title: "Entry Requirements", href: "/admissions/entry-requirements" },
    { title: "Fees & Payment Milestones", href: "/admissions/fees" },
  ],
};


function MobileAccordion({ title, links, onLinkClick }: { title: string, links: { title: string, href: string }[], onLinkClick: () => void }) {
  const [isOpen, setIsOpen] = useState(false);
  return (
    <div className="border-b border-gray-100 py-2">
      <button onClick={() => setIsOpen(!isOpen)} className="flex justify-between items-center w-full text-left py-2 text-aerojet-blue">
        <span className="text-xl font-bold">{title}</span>
        <span className={`text-sm transform transition-transform ${isOpen ? 'rotate-180' : ''}`}>▼</span>
      </button>
      <div className={`overflow-hidden transition-all duration-300 ease-in-out ${isOpen ? 'max-h-500px opacity-100 mt-2' : 'max-h-0 opacity-0'}`}>
        <div className="flex flex-col space-y-3 pl-4 border-l-2 border-gray-100 ml-1">
          {links.map(link => (
            <Link key={link.title} href={link.href} onClick={onLinkClick} className="block text-sm text-gray-600 hover:text-aerojet-sky font-medium py-1">
              {link.title}
            </Link>
          ))}
        </div>
      </div>
    </div>
  );
}

export default function Navbar({ theme = 'dark' }: { theme?: 'light' | 'dark' }) {
  // Check the environment variable
  const isPortalLive = process.env.NEXT_PUBLIC_PORTAL_LIVE === 'true';
  const { data: session, status } = useSession();
  const [scrolled, setScrolled] = useState(false);
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const isLightPage = theme === 'light';

  useEffect(() => {
    if (isLightPage) { setScrolled(true); return; }
    const handleScroll = () => setScrolled(window.scrollY > 50);
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, [isLightPage]);

  useEffect(() => {
    document.body.style.overflow = mobileMenuOpen ? 'hidden' : 'unset';
  }, [mobileMenuOpen]);

  const displayAsLight = scrolled || isLightPage; 
  const headerIsLight = displayAsLight || mobileMenuOpen;

  // Determine where the "Dashboard" link should go based on role
  const userRole = (session?.user as any)?.role;
  const dashboardHref = (userRole === 'ADMIN' || userRole === 'STAFF' || userRole === 'INSTRUCTOR') 
    ? '/staff/dashboard' 
    : '/portal/dashboard';

  return (
    <>
      <header className={`fixed top-0 w-full z-50 transition-all duration-300 ${headerIsLight ? "bg-white/95 backdrop-blur-md shadow-sm py-3" : "bg-transparent py-4"}`}>
        <div className="w-full px-4 sm:px-6 flex justify-between items-center">
          <Link href="/" onClick={() => setMobileMenuOpen(false)} className="relative z-50">
            <Image
              src={headerIsLight ? "/AATA_logo_hor_onWhite.png" : "/ATA_logo_hor_onDark.png"}
              alt="Aerojet Academy Logo" width={160} height={40} priority className="object-contain"
            />
          </Link>

          <nav className={`hidden md:flex space-x-8 text-sm font-bold items-center transition-colors duration-300 ${displayAsLight ? "text-aerojet-blue" : "text-white"}`}>
            <div className="group relative">
                <Link href="/courses" className="hover:text-aerojet-sky transition flex items-center h-full py-2">Courses <span className="ml-1 text-xs">▼</span></Link>
                <div className="absolute top-full left-1/2 -translate-x-1/2 pt-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none group-hover:pointer-events-auto">
                    <div className="bg-white rounded-md shadow-lg w-64 p-2 border border-gray-100">
                        {navLinks.courses.map(link => (<Link key={link.title} href={link.href} className="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-aerojet-blue rounded-md">{link.title}</Link>))}
                    </div>
                </div>
            </div>
            <div className="group relative">
                <Link href="/admissions" className="hover:text-aerojet-sky transition flex items-center h-full py-2">Admissions <span className="ml-1 text-xs">▼</span></Link>
                <div className="absolute top-full left-1/2 -translate-x-1/2 pt-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none group-hover:pointer-events-auto">
                    <div className="bg-white rounded-md shadow-lg w-64 p-2 border border-gray-100">
                        {navLinks.admissions.map(link => (<Link key={link.title} href={link.href} className="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-aerojet-blue rounded-md">{link.title}</Link>))}
                    </div>
                </div>
            </div>
            <Link href="/about" className="hover:text-aerojet-sky transition">About Us</Link>
            <Link href="/news" className="hover:text-aerojet-sky transition">News</Link>
          </nav>
          
          {/* Desktop CTA - ONLY SHOW IF LIVE */}
          <div className="hidden md:flex items-center space-x-3">
            {isPortalLive ? (
              <>
                <Link 
                    href={status === 'authenticated' ? dashboardHref : '/portal/login'} 
                    className={`text-xs font-bold transition-colors ${displayAsLight ? 'text-gray-600 hover:text-aerojet-blue' : 'text-white hover:text-gray-200'}`}
                >
                  {status === 'authenticated' ? 'GO TO DASHBOARD' : 'PORTAL LOGIN'}
                </Link>
                <Link href="/register" className="bg-aerojet-sky text-white px-4 py-2 rounded-md font-bold text-xs hover:bg-aerojet-soft-blue transition shadow-lg uppercase">
                    {status === 'authenticated' ? 'Apply Now' : 'Register'}
                </Link>
              </>
            ) : (
              // Optional: Show a "Coming Soon" or "Contact Us" button instead
              <Link href="/contact" className="bg-aerojet-sky text-white px-4 py-2 rounded-md font-bold text-xs hover:bg-aerojet-soft-blue transition shadow-lg uppercase">
                Contact Us
              </Link>
            )}
          </div>

          <button className="md:hidden p-2 focus:outline-none relative z-50" onClick={() => setMobileMenuOpen(!mobileMenuOpen)} aria-label="Toggle menu">
            <div className={`w-6 h-0.5 mb-1.5 transition-all duration-300 ${mobileMenuOpen ? "rotate-45 translate-y-2 bg-aerojet-blue" : (headerIsLight ? "bg-aerojet-blue" : "bg-white")}`}></div>
            <div className={`w-6 h-0.5 mb-1.5 transition-all duration-300 ${mobileMenuOpen ? "opacity-0" : (headerIsLight ? "bg-aerojet-blue" : "bg-white")}`}></div>
            <div className={`w-6 h-0.5 transition-all duration-300 ${mobileMenuOpen ? "-rotate-45 -translate-y-2 bg-aerojet-blue" : (headerIsLight ? "bg-aerojet-blue" : "bg-white")}`}></div>
          </button>
        </div>
      </header>

      {/* Mobile Menu Overlay */}
      <div className={`fixed inset-0 bg-white z-40 pt-24 px-6 overflow-y-auto transform transition-transform duration-300 ease-in-out md:hidden ${mobileMenuOpen ? "translate-x-0" : "translate-x-full"}`}>
        <div className="flex flex-col space-y-2 pb-20">
          <MobileAccordion title="Courses" links={navLinks.courses} onLinkClick={() => setMobileMenuOpen(false)} />
          <MobileAccordion title="Admissions" links={navLinks.admissions} onLinkClick={() => setMobileMenuOpen(false)} />
          <Link href="/about" onClick={() => setMobileMenuOpen(false)} className="block border-b border-gray-100 py-4 text-xl font-bold text-aerojet-blue">About Us</Link>
          <Link href="/news" onClick={() => setMobileMenuOpen(false)} className="block border-b border-gray-100 py-4 text-xl font-bold text-aerojet-blue">News</Link>
          <Link href="/contact" onClick={() => setMobileMenuOpen(false)} className="block border-b border-gray-100 py-4 text-xl font-bold text-aerojet-blue">Contact</Link>
          
          <div className="pt-8 space-y-4">
            {isPortalLive ? (
              <>
                <Link href="/portal/login" onClick={() => setMobileMenuOpen(false)} className="block text-center text-aerojet-sky font-semibold border border-aerojet-sky py-3 rounded-md">
                  {status === 'authenticated' ? 'Go to Dashboard' : 'Student Portal Login'}
                </Link>
                <Link href="/register" onClick={() => setMobileMenuOpen(false)} className="block bg-aerojet-sky text-white text-center py-4 rounded-md shadow-md font-bold uppercase tracking-wider">
                  Start Registration
                </Link>
              </>
            ) : (
               <Link href="/contact" onClick={() => setMobileMenuOpen(false)} className="block bg-aerojet-sky text-white text-center py-4 rounded-md shadow-md font-bold uppercase tracking-wider">
                  Contact Admissions
               </Link>
            )}
          </div>
        </div>
      </div>
    </>
  );
}

import Link from 'next/link';
import Image from 'next/image';
import { client } from '@/sanity/lib/client'; 
import { urlFor } from '@/sanity/lib/image'; 

interface ArticleTeaser {
  _id: string;
  title: string;
  slug: { current: string };
  mainImage: any;
  category: string;
}

async function getLatestArticles() {
  const query = `*[_type == "article"] | order(publishedAt desc)[0...3] {
    _id,
    title,
    slug,
    mainImage,
    category
  }`;
  const articles = await client.fetch(query);
  return articles;
}

export default async function NewsroomTeaser() {
  const articles: ArticleTeaser[] = await getLatestArticles();

  return (
    <section className="py-20 md:py-28 bg-white">
      <div className="container mx-auto px-6">
        <div className="text-center mb-16">
          <h2 className="text-3xl md:text-4xl font-bold text-aerojet-blue mb-4">
            Latest News & Updates
          </h2>
          <p className="text-gray-600 max-w-2xl mx-auto">
            Stay informed about our progress, partnerships, and program announcements.
          </p>
        </div>

        <div className="grid md:grid-cols-3 gap-8">
          {articles.map((article) => (
            <Link href={`/news/${article.slug.current}`} key={article._id} className="group block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden">
              <div className="relative h-56 w-full bg-gray-200">
                <Image
                  src={urlFor(article.mainImage).url()}
                  alt={`Image for ${article.title}`}
                  layout="fill"
                  objectFit="contain"
                  className="p-2"
                />
              </div>
              <div className="p-6">
                <p className="text-xs font-bold text-aerojet-sky uppercase mb-2">{article.category}</p>
                <h3 className="text-lg font-bold text-aerojet-blue mb-3 leading-snug">
                  {article.title}
                </h3>
                <span className="font-semibold text-sm text-aerojet-sky group-hover:text-aerojet-blue transition">Read More →</span>
              </div>
            </Link>
          ))}
        </div>

        <div className="text-center mt-16">
          <Link href="/news" className="border-2 border-aerojet-blue text-aerojet-blue px-10 py-3 rounded-md font-bold hover:bg-aerojet-blue hover:text-white transition">
            View All News
          </Link>
        </div>
      </div>
    </section>
  );
}

"use client";
import Link from 'next/link';

export default function NextSteps() {
  const steps = [
    {
      title: "Step 1: Registration Invoice",
      desc: "Submit enquiry via the Register page. We will review and issue your GHS 350 registration invoice."
    },
    {
      title: "Step 2: Online Application Form",
      desc: "Once payment is received and you send us confirmation, we will provide a link to complete the online application form for Academy review and approval."
    },
    {
      title: "Step 3: Confirmation Invoice",
      desc: "Upon approval, we will issue an invoice for the Confirmation payment applicable to your selected training program. Once paid, your seat is secured."
    },
    {
      title: "Step 4: Student Portal Onboarding",
      desc: "Once your payment is verified, we create your official account and you receive login credentials."
    }
  ];

  return (
    <section className="bg-slate-900 text-white rounded-3xl overflow-hidden shadow-2xl my-16">
      <div className="p-8 md:p-12">
        <h2 className="text-2xl md:text-3xl font-black uppercase tracking-tight mb-8 text-center">
          How to Enroll: <span className="text-aerojet-sky">Your Path to the Skies</span>
        </h2>
        
        <div className="grid md:grid-cols-2 gap-8 md:gap-12">
          {steps.map((step, index) => (
            <div key={index} className="flex gap-4 group">
              <div className="shrink-0 w-10 h-10 rounded-lg bg-aerojet-sky text-white flex items-center justify-center font-black text-lg group-hover:scale-110 transition-transform">
                {index + 1}
              </div>
              <div>
                <h3 className="font-bold text-lg mb-2 text-white">{step.title}</h3>
                <p className="text-sm text-slate-400 leading-relaxed">{step.desc}</p>
              </div>
            </div>
          ))}
        </div>

        <div className="mt-12 text-center border-t border-white/10 pt-8">
          <p className="text-slate-400 text-sm mb-6">Ready to begin? Start your registration to receive your first invoice.</p>
          <Link href="/register" className="bg-white text-slate-900 px-10 py-4 rounded-xl font-black uppercase tracking-widest text-sm hover:bg-aerojet-sky hover:text-white transition-all">
            Start Registration Now
          </Link>
        </div>
      </div>
    </section>
  );
}

import Image from "next/image";

type PageHeroProps = {
  title: string;
  subtitle: string;
  backgroundImage: string;
};

export default function PageHero({ title, subtitle, backgroundImage }: PageHeroProps) {
  return (
    // 1. INCREASED HEIGHT: Changed h-[70vh] to h-[85vh] to "zoom out" the image
    <section className="relative w-full h-[60vh] md:h-[60vh] flex items-center justify-center bg-slate-950 overflow-hidden">
      
      <Image
        src={backgroundImage}
        alt={title}
        fill
        priority
        // 2. POSITION ADJUSTMENT: Added 'object-top' to prioritize the top of the photo (heads/faces)
        className="object-cover object-center opacity-50"
        quality={100} 
      />

      {/* GRADIENT OVERLAYS */}
      <div className="absolute inset-0 bg-linear-to-t from-slate-950 via-slate-950/20 to-transparent z-10" />
      <div className="absolute inset-0 bg-black/10 z-10" />

      {/* TEXT CONTENT */}
      <div className="relative container mx-auto px-6 text-center text-white z-20 mt-20">
        <div className="max-w-5xl mx-auto">
            <h1 className="text-4xl md:text-8xl font-black uppercase tracking-tighter leading-[0.85] mb-8 drop-shadow-2xl">
                {title}
            </h1>
            <div className="w-24 h-2 bg-aerojet-sky mx-auto mb-8 rounded-full shadow-lg" />
            <p className="text-lg md:text-2xl text-slate-200 max-w-3xl mx-auto font-medium leading-relaxed drop-shadow-md">
                {subtitle}
            </p>
        </div>
      </div>
    </section>
  );
}

import Image from "next/image";

type PageHeroProps = {
  title: string;
  subtitle: string;
  backgroundImage: string;
};

export default function PageHero({ title, subtitle, backgroundImage }: PageHeroProps) {
  return (
    // 1. INCREASED HEIGHT: Changed h-[70vh] to h-[85vh] to "zoom out" the image
    <section className="relative w-full h-[60vh] md:h-[60vh] flex items-center justify-center bg-slate-950 overflow-hidden">
      
      <Image
        src={backgroundImage}
        alt={title}
        fill
        priority
        // 2. POSITION ADJUSTMENT: Added 'object-top' to prioritize the top of the photo (heads/faces)
        className="object-cover object-center opacity-50"
        quality={100} 
      />

      {/* GRADIENT OVERLAYS */}
      <div className="absolute inset-0 bg-linear-to-t from-slate-950 via-slate-950/20 to-transparent z-10" />
      <div className="absolute inset-0 bg-black/10 z-10" />

      {/* TEXT CONTENT */}
      <div className="relative container mx-auto px-6 text-center text-white z-20 mt-20">
        <div className="max-w-5xl mx-auto">
            <h1 className="text-4xl md:text-8xl font-black uppercase tracking-tighter leading-[0.85] mb-8 drop-shadow-2xl">
                {title}
            </h1>
            <div className="w-24 h-2 bg-aerojet-sky mx-auto mb-8 rounded-full shadow-lg" />
            <p className="text-lg md:text-2xl text-slate-200 max-w-3xl mx-auto font-medium leading-relaxed drop-shadow-md">
                {subtitle}
            </p>
        </div>
      </div>
    </section>
  );
}

import Link from 'next/link';
import Image from 'next/image';

const programs = [
  {
    title: "Full-Time Licence Programmes",
    description: "Comprehensive 2 or 4-year pathways to B1.1/B2 licensure. Includes theory, hand-skills, and work experience.",
    image: "/fulltime.jpg", // Updated Hero Image
    link: "/courses/easa-full-time",
    badge: "Most Popular",
    ratio: "aspect-video" 
  },
  {
    title: "12-Month Crash Course",
    description: "Accelerated B1.1 certification for industry professionals. Theory & exams only.",
    image: "/12month.jpg",
    link: "/courses/easa-full-time",
    badge: "Industry",
    ratio: "aspect-video"
  },
  {
    title: "Modular Training",
    description: "Individual tuition + exam per module. Book tuition and exams for specific modules at your own pace.",
    image: "/modular1.jpg", // New High-Res Image
    link: "/courses/easa-modular",
    badge: "Individual",
    ratio: "aspect-video" // Standard Video Ratio
  },
  {
    title: "Exam-Only & Revision",
    description: "Self-study candidates can book exam sittings or join 8-week group revision blocks.",
    image: "/examonly1.jpg", // New High-Res Image
    link: "/courses/examination-only",
    badge: "Self-Study",
    ratio: "aspect-video" // Standard Video Ratio
  }
];

export default function ProgramsSnapshot() {
  return (
    <section className="py-24 md:py-32 bg-slate-50">
      <div className="container mx-auto px-6">
        <div className="text-center mb-20">
          <h2 className="text-3xl md:text-5xl font-black text-aerojet-blue uppercase tracking-tight mb-4">
            Find Your Path in Aviation
          </h2>
          <p className="text-slate-500 max-w-2xl mx-auto font-medium">
            From complete beginners to experienced technicians, we have a certified pathway for you.
          </p>
        </div>

        {/* Use a 2-column grid on small screens, 2-column on medium, and 4-column on large */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          {programs.map((program) => (
            <Link 
                href={program.link} 
                key={program.title} 
                className="group block bg-white rounded-4xl shadow-sm hover:shadow-2xl transition-all duration-500 overflow-hidden transform hover:-translate-y-2 border border-slate-100"
            >
              {/* Dynamic Aspect Ratio Container */}
              <div className={`relative w-full ${program.ratio} bg-slate-200`}>
                <Image
                  src={program.image}
                  alt={program.title}
                  fill
                  className="object-cover transition-transform duration-700 group-hover:scale-110"
                />
                <div className="absolute top-4 right-4 bg-aerojet-sky/90 backdrop-blur-sm text-white text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full shadow-sm">
                    {program.badge}
                </div>
              </div>
              
              <div className="p-8">
                <h3 className="text-lg font-black text-aerojet-blue mb-3 uppercase tracking-tight leading-tight group-hover:text-aerojet-sky transition-colors">
                  {program.title}
                </h3>
                <p className="text-sm text-slate-500 leading-relaxed font-medium mb-6">
                  {program.description}
                </p>
                <div className="flex items-center text-aerojet-sky font-black uppercase text-[10px] tracking-widest">
                    Learn More
                    <span className="ml-2 transform group-hover:translate-x-2 transition-transform">→</span>
                </div>
              </div>
            </Link>
          ))}
        </div>
      </div>
    </section>
  );
}

"use client";
import { useState } from 'react';
import { toast } from 'sonner';

export default function RegisterForm() {
  const [formData, setFormData] = useState({ name: '', email: '', programme: 'Full-Time B1.1/B2' });
  const [isSending, setIsSending] = useState(false);

  const inputClasses = "mt-1 block w-full px-4 py-3 border border-slate-300 rounded-xl bg-white text-slate-900 shadow-sm focus:outline-none focus:border-aerojet-sky focus:ring-1 focus:ring-aerojet-sky transition-all";

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSending(true);
    try {
      const res = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: formData.name, email: formData.email,
          message: `REGISTRATION REQUEST: Interested in ${formData.programme}.`
        }),
      });
      if (res.ok) {
        toast.success("Request sent! We will email the invoice shortly.");
        setFormData({ name: '', email: '', programme: 'Full-Time B1.1/B2' });
      }
    } catch (error) { toast.error("An error occurred."); }
    finally { setIsSending(false); }
  };

  return (
    <form onSubmit={handleSubmit} className="mt-8 space-y-5">
      <input type="text" required className={inputClasses} placeholder="Full Name" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} />
      <input type="email" required className={inputClasses} placeholder="Email Address" value={formData.email} onChange={(e) => setFormData({...formData, email: e.target.value})} />
      <select className={inputClasses} value={formData.programme} onChange={(e) => setFormData({...formData, programme: e.target.value})}>
        <option>Full-Time EASA B1.1/B2</option>
        <option>Modular Training (Part-66)</option>
        <option>Examination-Only (Self-Study)</option>
      </select>
      <button type="submit" disabled={isSending} className="w-full bg-aerojet-sky text-white font-black uppercase py-4 rounded-xl shadow-lg transition-all active:scale-95">
        {isSending ? 'Sending Request...' : 'Request Registration Invoice'}
      </button>
    </form>
  );
}

"use client";
import { useEffect, useRef, useState } from "react";

type RevealProps = {
  children: React.ReactNode;
  delay?: number; // Optional delay in milliseconds
};

export default function Reveal({ children, delay = 0 }: RevealProps) {
  const [isVisible, setIsVisible] = useState(false);
  const ref = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.unobserve(entry.target); // Only animate once
        }
      },
      { threshold: 0.1 } // Trigger when 10% of element is visible
    );

    if (ref.current) {
      observer.observe(ref.current);
    }

    return () => {
      if (ref.current) observer.unobserve(ref.current);
    };
  }, []);

  return (
    <div
      ref={ref}
      className={`transition-all duration-1000 ease-out transform ${
        isVisible ? "opacity-100 translate-y-0" : "opacity-0 translate-y-10"
      }`}
      style={{ transitionDelay: `${delay}ms` }}
    >
      {children}
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";

export default function ScrollToTop() {
  const [isVisible, setIsVisible] = useState(false);

  const toggleVisibility = () => {
    if (window.scrollY > 300) {
      setIsVisible(true);
    } else {
      setIsVisible(false);
    }
  };

  const scrollToTop = () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth",
    });
  };

  useEffect(() => {
    window.addEventListener("scroll", toggleVisibility);
    return () => window.removeEventListener("scroll", toggleVisibility);
  }, []);

  return (
    <div className="fixed bottom-20 md:bottom-8 right-6 z-40">
      {isVisible && (
        <button
          onClick={scrollToTop}
          className="bg-aerojet-blue text-white p-3 rounded-full shadow-lg hover:bg-aerojet-sky transition-all duration-300 border-2 border-white/20"
          aria-label="Back to top"
        >
          {/* Arrow Up Icon */}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M5 10l7-7m0 0l7 7m-7-7v18"
            />
          </svg>
        </button>
      )}
    </div>
  );
}

import Link from "next/link";

const services = [
  {
    title: "Pilot Training",
    description: "From PPL to ATPL. Train in modern glass-cockpit aircraft with experienced instructors.",
    icon: "✈️",
    link: "/courses/pilot"
  },
  {
    title: "Engineering",
    description: "EASA Part-66 certified training. Master airframe, powerplant, and avionics systems.",
    icon: "⚙️",
    link: "/courses/engineering"
  },
  {
    title: "Cabin Crew",
    description: "World-class safety and service training to launch your career with top airlines.",
    icon: "👔",
    link: "/courses/cabin-crew"
  }
];

export default function Services() {
  return (
    <section className="py-20 bg-white">
      <div className="container mx-auto px-6">
        <div className="text-center mb-16">
          <h2 className="text-3xl md:text-4xl font-bold text-aerojet-blue mb-4">
            Our Training Programs
          </h2>
          <div className="w-20 h-1 bg-aerojet-sky mx-auto rounded-full"></div> {/* Uses new color */}
        </div>

        <div className="grid md:grid-cols-3 gap-8">
          {services.map((service, index) => (
            <div key={index} className="group p-8 border border-gray-100 rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 hover:-translate-y-1 bg-white">
              <div className="text-4xl mb-6 bg-blue-50 w-16 h-16 flex items-center justify-center rounded-xl group-hover:bg-aerojet-sky group-hover:text-white transition-colors duration-300">
                {service.icon}
              </div>
              <h3 className="text-xl font-bold text-aerojet-blue mb-3 group-hover:text-aerojet-sky transition-colors">
                {service.title}
              </h3>
              <p className="text-gray-600 mb-6 leading-relaxed">
                {service.description}
              </p>
              <Link href={service.link} className="inline-flex items-center text-aerojet-sky font-semibold hover:text-aerojet-blue transition-colors">
                Learn more <span className="ml-2">→</span>
              </Link>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

"use client";
import { signOut } from "next-auth/react";

export default function SignOutButton() {
  return (
    <button
      onClick={() => signOut({ callbackUrl: '/' })} // Redirect to home page after sign out
      className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md transition"
    >
      Sign Out
    </button>
  );
}

import Image from 'next/image';

export default function WhoWeAre() {
  return (
    <section className="bg-white py-20 md:py-28">
      <div className="container mx-auto px-6">
        <div className="grid md:grid-cols-2 gap-12 md:gap-16 items-center">
          {/* Text Content */}
          <div className="text-left">
            <h2 className="text-3xl md:text-4xl font-bold text-aerojet-blue mb-6">
              We Stand for Excellence
            </h2>
            <p className="text-gray-700 leading-relaxed mb-4">
              Aerojet Aviation Training Academy was developed as part of Aerojet’s flagship Accra MRO Project.
            </p>
            <p className="text-gray-600 leading-relaxed">
              Our mission is to provide world-class, EASA-standard technical training and create career opportunities for aspiring aviation professionals who otherwise may not have the chance to pursue these highly skilled roles.
            </p>
          </div>

          {/* Image */}
          <div className="relative w-full h-80 md:h-96 rounded-lg overflow-hidden shadow-xl">
            <Image 
              src="/excellence.jpg"
              alt="People standing on a hill"
              layout="fill"
              objectFit="cover"
              className="object-center"
            />
             <div className="absolute inset-0 bg-aerojet-blue/20"></div>
          </div>
        </div>
      </div>
    </section>
  );
}
import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';
import ContactForm from '@/components/ContactForm'; // Import the client form

export const metadata: Metadata = {
  title: 'Contact',
};

export default function ContactPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50">
      <Navbar theme="dark" />
      
      <div className="grow">
        <PageHero 
          title="Contact Us"
          subtitle="Reach out to our admissions team for enquiries about EASA programmes."
          backgroundImage="/airport.jpg"
        />

        <div className="container mx-auto px-6 py-16 -mt-24 relative z-20">
          <div className="bg-white rounded-[2.5rem] shadow-2xl overflow-hidden grid lg:grid-cols-5 border border-slate-100">
            
            {/* LEFT: Info & Map */}
            <div className="lg:col-span-2 bg-aerojet-blue p-8 md:p-12 text-white">
                <h2 className="text-2xl font-black uppercase tracking-widest mb-8 border-b border-white/10 pb-4">Get in Touch</h2>
                
                <div className="space-y-8">
                    <div className="flex items-start gap-4">
                        <div className="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center shrink-0">📍</div>
                        <div>
                            <h3 className="font-bold text-aerojet-sky text-xs uppercase tracking-widest mb-1">Campus Location</h3>
                            <p className="text-sm text-slate-300 leading-relaxed font-medium">
                                ATTC Small Engines Department,<br/> 
                                Kokomlemle, Accra, Ghana
                            </p>
                        </div>
                    </div>

                    <div className="flex items-start gap-4">
                        <div className="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center shrink-0">📞</div>
                        <div>
                            <h3 className="font-bold text-aerojet-sky text-xs uppercase tracking-widest mb-1">Admissions Line</h3>
                            <p className="text-sm text-slate-300 font-medium">+233-20-984-8423</p>
                        </div>
                    </div>

                    <div className="flex items-start gap-4">
                        <div className="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center shrink-0">✉️</div>
                        <div>
                            <h3 className="font-bold text-aerojet-sky text-xs uppercase tracking-widest mb-1">Official Email</h3>
                            <p className="text-sm text-slate-300 font-medium">trainingprograms@aerojet-academy.com</p>
                        </div>
                    </div>
                </div>

                <div className="mt-12 h-60 rounded-3xl overflow-hidden border border-white/10 grayscale opacity-70">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3970.786377777076!2d-0.2085864241476562!3d5.598254333214875!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xfdf90a079636901%3A0x8772a4667556553a!2sAccra%20Technical%20Training%20Centre!5e0!3m2!1sen!2sgh!4v1709220000000!5m2!1sen!2sgh" 
                        width="100%" height="100%" style={{border:0}} allowFullScreen={true} loading="lazy" 
                    ></iframe>
                </div>
            </div>

            {/* RIGHT: Form */}
            <div className="lg:col-span-3 p-8 md:p-12 bg-white">
                 <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-2">Send us a Message</h2>
                 <p className="text-slate-500 mb-10">Fill out the form below and we will get back to you via email.</p>
                 <ContactForm />
            </div>
          </div>
        </div>
      </div>

      <Footer />
    </main>
  );
}

import Link from 'next/link';
import Navbar from '../../components/Navbar';
import Footer from '../../components/Footer';
import PageHero from '../../components/PageHero';

export default function CabinCrewPage() {
  return (
    <main className="min-h-screen flex flex-col bg-white">
      <Navbar />
      <div className="grow">
        <PageHero 
          title="Cabin Crew Training"
          subtitle="Excellence in safety and service. Prepare for a career with top global airlines."
          backgroundImage="/air-hoster.jpg"
        />

        <div className="container mx-auto px-6 py-20 text-center">
          <div className="max-w-3xl mx-auto bg-gray-50 p-10 rounded-2xl border border-gray-200 shadow-sm">
            <span className="bg-aerojet-sky text-white px-4 py-1 rounded-full text-sm font-bold uppercase tracking-wider mb-6 inline-block">
              Coming Soon
            </span>
            <h2 className="text-3xl font-bold text-aerojet-blue mb-4">
              Become the Face of the Airline
            </h2>
            <p className="text-gray-600 mb-8 leading-relaxed">
              Our upcoming Cabin Crew training module is designed to meet international safety and service standards. You will learn emergency procedures, first aid, customer service excellence, and aviation regulations.
            </p>
            <p className="text-gray-600 mb-10">
              Join the waitlist to receive the syllabus and fee structure as soon as it is released.
            </p>

            <Link 
              href="/contact?interest=Cabin%20Crew" 
              className="bg-aerojet-gold text-aerojet-blue px-10 py-4 rounded-md font-bold text-lg hover:bg-opacity-90 transition inline-block"
            >
              Join the Waitlist
            </Link>
          </div>
        </div>
      </div>
      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'Full-Time Programmes',
};

const programs = [
  {
    id: "A",
    title: "4-Year B1.1 & B2 Licence Programme",
    who: "School leavers seeking the highest global standard in dual-category certification.",
    includes: ["Comprehensive Theory", "Advanced Hand-Skills", "Structured Work Experience", "Exam fees + 2 free re-sits", "Logbook, PPE & Materials"]
  },
  {
    id: "B",
    title: "2-Year B1.1 Licence Programme",
    who: "Fast-track candidates focusing on Mechanical (Turbine) certification.",
    includes: ["Intensive Theory", "Practical Hand-Skills", "PPE & Materials", "Exam fees + 2 free re-sits", "Optional B2 top-up blocks"]
  },
  {
    id: "C",
    title: "12-Month Engineer Certification",
    who: "Industry or Military professionals needing EASA B1.1 theory & exams only.",
    includes: ["B1.1 Theory Modules", "All EASA Examinations", "Evening & Saturday classes", "No hand-skills training", "Designed for working pros"]
  }
];

export default function FullTimeCoursesPage() {
  return (
    <main className="min-h-screen flex flex-col bg-white">
      <Navbar />
      
      <div className="grow">
        <PageHero 
          title="Full-Time Programmes"
          subtitle="Immersive, EASA-standard training pathways designed to produce elite Aircraft Maintenance Engineers."
          backgroundImage="/full-time.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="max-w-6xl mx-auto space-y-24">
            
            {/* 1. The Three Pathways */}
            <section>
                <div className="text-center mb-16">
                    <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight">Choose Your Category</h2>
                    <p className="text-slate-500 mt-2 font-medium">We offer three distinct full-time routes depending on your experience and goals.</p>
                </div>

                <div className="grid lg:grid-cols-3 gap-8">
                    {programs.map((prog) => (
                        <div key={prog.id} className="bg-slate-50 rounded-4xl p-8 border border-slate-100 flex flex-col hover:shadow-xl transition-all duration-500 group">
                            <div className="w-12 h-12 bg-aerojet-blue text-white rounded-xl flex items-center justify-center font-black mb-6 group-hover:bg-aerojet-sky transition-colors">
                                {prog.id}
                            </div>
                            <h3 className="text-xl font-black text-aerojet-blue leading-tight mb-4">{prog.title}</h3>
                            
                            <div className="mb-6">
                                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Target Audience</p>
                                <p className="text-sm text-slate-600 leading-relaxed">{prog.who}</p>
                            </div>

                            <div className="grow">
                                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Programme Includes</p>
                                <ul className="space-y-2">
                                    {prog.includes.map(item => (
                                        <li key={item} className="flex items-start text-xs font-bold text-slate-500">
                                            <span className="text-aerojet-sky mr-2 text-lg">✓</span> {item}
                                        </li>
                                    ))}
                                </ul>
                            </div>

                            <div className="mt-8 pt-6 border-t border-slate-200">
                                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Pricing Structure</p>
                                <p className="text-sm font-bold text-aerojet-sky mt-1">Pricing visible in Student Portal</p>
                            </div>
                        </div>
                    ))}
                </div>
            </section>

            {/* 2. Payment Milestones Section remains mostly same but uses generic phrasing */}
            <section className="bg-aerojet-blue rounded-[3rem] p-8 md:p-16 text-white shadow-2xl relative overflow-hidden">
                <div className="absolute top-0 right-0 p-10 opacity-10">
                    <svg className="w-40 h-40" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                </div>
                
                <div className="relative z-10 grid lg:grid-cols-2 gap-12 items-center">
                    <div>
                        <h2 className="text-3xl font-black uppercase tracking-tight mb-6">Payment Milestones</h2>
                        <p className="text-blue-100 leading-relaxed mb-8 font-medium">
                            Aerojet Academy utilizes a milestone-based payment structure to help students and sponsors manage the investment across the academic year.
                        </p>
                        <div className="space-y-4 text-sm font-bold uppercase tracking-widest">
                            <div className="flex items-center gap-4 bg-white/10 p-4 rounded-2xl border border-white/10">
                                <span className="text-aerojet-sky">Step 1</span>
                                <p>GHS 350 Registration Fee</p>
                            </div>
                            <div className="flex items-center gap-4 bg-white/10 p-4 rounded-2xl border border-white/10">
                                <span className="text-aerojet-sky">Step 2</span>
                                <p>40% Seat Confirmation Deposit</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-4xl p-8 text-slate-900 shadow-xl">
                        <h3 className="font-black text-aerojet-blue uppercase text-sm tracking-widest mb-6">Annual Balance Schedule</h3>
                        <div className="space-y-6">
                            <div className="border-l-4 border-aerojet-sky pl-4">
                                <p className="font-black text-lg">Semester 1</p>
                                <p className="text-sm text-slate-500">Remaining balance split into predictable installments.</p>
                            </div>
                            <div className="border-l-4 border-slate-200 pl-4">
                                <p className="font-black text-lg">Portal Access</p>
                                <p className="text-sm text-slate-500 font-medium">Log in to view your personalized payment plan and due dates.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            {/* 3. Next Steps Verbatim */}
            <section className="text-center py-10">
                <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-12">How to Enroll</h2>
                <div className="grid md:grid-cols-4 gap-6 text-left">
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <span className="text-aerojet-sky font-black text-xl mb-2 block">01</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-2">Registration Invoice</h4>
                        <p className="text-[11px] text-slate-500 leading-relaxed">We will first issue an invoice for the GHS 350 registration fee. Payment is required before you can complete the online application.</p>
                    </div>
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <span className="text-aerojet-sky font-black text-xl mb-2 block">02</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-2">Online Application</h4>
                        <p className="text-[11px] text-slate-500 leading-relaxed">Once payment is received and confirmed, we will provide a link to complete the online application form for review.</p>
                    </div>
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <span className="text-aerojet-sky font-black text-xl mb-2 block">03</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-2">Confirmation Invoice</h4>
                        <p className="text-[11px] text-slate-500 leading-relaxed">Upon approval, we will issue an invoice for the Confirmation payment (40%). Once paid, your seat is secured.</p>
                    </div>
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <span className="text-aerojet-sky font-black text-xl mb-2 block">04</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-2">Start Training</h4>
                        <p className="text-[11px] text-slate-500 leading-relaxed">After confirmation, you will be onboarded to the student portal and receive confirmation of your start date.</p>
                    </div>
                </div>
                
                <div className="mt-16">
                    <Link href="/register" className="bg-aerojet-sky text-white px-12 py-4 rounded-xl font-black uppercase tracking-widest text-sm hover:bg-aerojet-blue shadow-lg transition-all active:scale-95">
                        Begin Registration Now
                    </Link>
                </div>
            </section>

          </div>
        </div>
      </div>

      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'Modular Training',
};

export default function ModularProgrammePage() {
  return (
    <main className="min-h-screen flex flex-col bg-white">
      <Navbar />
      
      <div className="grow">
        <PageHero 
          title="Modular Training Programme"
          subtitle="Self-paced, flexible certification paths for EASA Part-66 B1 and B2 licences."
          backgroundImage="/modular.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="max-w-5xl mx-auto space-y-20">
            
            {/* 1. Programme Overview */}
            <div className="grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <div className="w-16 h-1.5 bg-aerojet-sky mb-6 rounded-full" />
                    <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-6">Individual Tuition & Exam</h2>
                    <p className="text-slate-600 leading-relaxed mb-4 font-medium">
                        The Modular Training Programme is our primary route for **individuals** who want expert instruction without committing to a full-time schedule. 
                    </p>
                    <p className="text-slate-500 leading-relaxed text-sm">
                        Unlike "Exam-Only", this option includes **full classroom tuition** for your chosen module, plus the examination sitting fee. You join a scheduled class and receive structured learning support.
                    </p>
                </div>
                <div className="bg-slate-900 text-white p-10 rounded-[2.5rem] shadow-2xl relative overflow-hidden border-t-4 border-aerojet-sky">
                    <h3 className="text-xl font-bold mb-6">Modular Rules</h3>
                    <ul className="space-y-5">
                        <li className="flex items-start gap-4">
                            <span className="text-aerojet-sky font-black text-lg">✓</span>
                            <p className="text-sm text-slate-300 font-medium leading-relaxed">Book modules at your own pace through the secure student portal.</p>
                        </li>
                        <li className="flex items-start gap-4">
                            <span className="text-aerojet-sky font-black text-lg">✓</span>
                            <p className="text-sm text-slate-300 font-medium leading-relaxed"><b>100% Upfront Payment:</b> Required per booked module to activate access.</p>
                        </li>
                        <li className="flex items-start gap-4">
                            <span className="text-red-500 font-black text-lg">!</span>
                            <p className="text-sm text-slate-300 font-medium leading-relaxed"><b>The 24-Month Rule:</b> All exams must be passed within 24 months of the first module pass.</p>
                        </li>
                    </ul>
                </div>
            </div>

            {/* 2. Pricing & Access Information */}
            <section className="bg-slate-50 rounded-[3rem] p-8 md:p-16 border border-slate-100 text-center shadow-inner">
                <h2 className="text-2xl font-black text-aerojet-blue uppercase tracking-widest mb-4">Pricing & Availability</h2>
                <p className="text-slate-500 max-w-2xl mx-auto mb-10 font-medium">
                    To maintain strict cohort standards and up-to-date scheduling, detailed pricing and available dates for modular tuition are visible exclusively within the <b>Student Portal</b> after successful registration.
                </p>
                <div className="flex flex-col md:flex-row justify-center gap-4">
                    <Link href="/register" className="bg-aerojet-sky text-white px-10 py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-aerojet-blue transition-all shadow-lg">
                        Register to View Pricing
                    </Link>
                    <Link href="/courses/modules" className="bg-white border-2 border-slate-200 text-slate-600 px-10 py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-slate-100 transition-all">
                        View Module List (M1–M17)
                    </Link>
                </div>
            </section>

            {/* 3. Next Steps Verbatim from Master Pack */}
            <section className="pt-10">
                <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-12 text-center">How to Enroll</h2>
                <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div className="p-6 bg-white rounded-2xl border border-slate-100 shadow-sm group hover:border-aerojet-sky transition-all">
                        <span className="text-slate-300 font-black text-xl mb-4 block group-hover:text-aerojet-sky">01</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-2">Registration Invoice</h4>
                        <p className="text-[11px] text-slate-500 leading-relaxed">We will first issue an invoice for the GHS 350 registration fee. Payment is required before you can complete the online application.</p>
                    </div>
                    <div className="p-6 bg-white rounded-2xl border border-slate-100 shadow-sm group hover:border-aerojet-sky transition-all">
                        <span className="text-slate-300 font-black text-xl mb-4 block group-hover:text-aerojet-sky">02</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-2">Online Application</h4>
                        <p className="text-[11px] text-slate-500 leading-relaxed">Once payment is received and confirmed, we will provide a link to complete the online application form for review.</p>
                    </div>
                    <div className="p-6 bg-white rounded-2xl border border-slate-100 shadow-sm group hover:border-aerojet-sky transition-all">
                        <span className="text-slate-300 font-black text-xl mb-4 block group-hover:text-aerojet-sky">03</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-2">Confirmation Invoice</h4>
                        <p className="text-[11px] text-slate-500 leading-relaxed">Upon approval, we will issue an invoice for the Confirmation payment. Once paid, your seat is secured.</p>
                    </div>
                    <div className="p-6 bg-white rounded-2xl border border-slate-100 shadow-sm group hover:border-aerojet-sky transition-all">
                        <span className="text-slate-300 font-black text-xl mb-4 block group-hover:text-aerojet-sky">04</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-2">Portal Access</h4>
                        <p className="text-[11px] text-slate-500 leading-relaxed">After confirmation, you will be onboarded to the student portal to access your materials and book your exams.</p>
                    </div>
                </div>
            </section>

          </div>
        </div>
      </div>

      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'Exam Schedule',
};

export default function ExamSchedulePage() {
  const schedule2026 = [
    { window: "Jun 2026", dates: "23–24 Jun 2026", deadline: "15 Mar 2026" },
    { window: "Sep 2026", dates: "14–15 Sep 2026", deadline: "06 Jun 2026" },
    { window: "Dec 2026", dates: "21–22 Dec 2026", deadline: "12 Sep 2026" },
  ];

  const schedule2027 = [
    { window: "Mar 2027", dates: "18–20 Mar 2027", deadline: "08 Dec 2026" },
    { window: "Jun 2027", dates: "28–30 Jun 2027", deadline: "20 Mar 2027" },
    { window: "Sep/Oct 2027", dates: "29 Sep–01 Oct 2027", deadline: "21 Jun 2027" },
    { window: "Dec 2027", dates: "15–17 Dec 2027", deadline: "06 Sep 2027" },
  ];

  return (
    <main className="min-h-screen flex flex-col bg-white">
      <Navbar />
      <div className="grow">
        <PageHero 
          title="Exam Schedule 2026–2027"
          subtitle="Official examination windows for EASA Part-66 modular candidates."
          backgroundImage="/examsschedule.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="max-w-4xl mx-auto space-y-16">
            
            <div className="bg-slate-900 text-white p-8 rounded-3xl shadow-lg border-l-8 border-aerojet-sky">
                <h2 className="text-xl font-black uppercase tracking-tight mb-4 text-aerojet-sky">Important Booking Policy</h2>
                <ul className="space-y-2 text-sm text-slate-300">
                    <li>• Exam seats must be <b>paid in full</b> by the Payment Deadline (T-21).</li>
                    <li>• Windows are confirmed only if minimum numbers (60 seats) are met by the deadline.</li>
                    <li>• Unconfirmed windows roll forward to the next date at no extra cost.</li>
                </ul>
            </div>

            {/* 2026 Table */}
            <section>
                <h3 className="text-2xl font-black text-aerojet-blue uppercase tracking-tight mb-6">2026 Schedule</h3>
                <div className="bg-white border border-slate-200 rounded-2xl overflow-hidden shadow-sm">
                    <table className="w-full text-left text-sm">
                        <thead className="bg-slate-50 text-slate-500 font-bold uppercase text-xs border-b border-slate-200">
                            <tr>
                                <th className="p-4">Window</th>
                                <th className="p-4">Exam Dates</th>
                                <th className="p-4 text-red-600">Payment Deadline</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-slate-100">
                            {schedule2026.map((row, i) => (
                                <tr key={i} className="hover:bg-slate-50">
                                    <td className="p-4 font-bold text-slate-800">{row.window}</td>
                                    <td className="p-4">{row.dates}</td>
                                    <td className="p-4 font-bold text-red-600">{row.deadline}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </section>

            {/* 2027 Table */}
            <section>
                <h3 className="text-2xl font-black text-aerojet-blue uppercase tracking-tight mb-6">2027 Schedule</h3>
                <div className="bg-white border border-slate-200 rounded-2xl overflow-hidden shadow-sm">
                    <table className="w-full text-left text-sm">
                        <thead className="bg-slate-50 text-slate-500 font-bold uppercase text-xs border-b border-slate-200">
                            <tr>
                                <th className="p-4">Window</th>
                                <th className="p-4">Exam Dates</th>
                                <th className="p-4 text-red-600">Payment Deadline</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-slate-100">
                            {schedule2027.map((row, i) => (
                                <tr key={i} className="hover:bg-slate-50">
                                    <td className="p-4 font-bold text-slate-800">{row.window}</td>
                                    <td className="p-4">{row.dates}</td>
                                    <td className="p-4 font-bold text-red-600">{row.deadline}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </section>

            <div className="text-center pt-8">
                <Link href="/portal/login" className="bg-aerojet-sky text-white px-10 py-4 rounded-xl font-black uppercase tracking-widest text-sm hover:bg-aerojet-blue transition-all shadow-lg">
                    Book Exam Seats in Portal
                </Link>
            </div>

          </div>
        </div>
      </div>
      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';
import NextSteps from '@/components/NextSteps';

export const metadata: Metadata = {
  title: 'Examination-Only',
};

export default function ExamOnlyPage() {
  return (
    <main className="min-h-screen flex flex-col bg-white">
      <Navbar />
      <div className="grow">
        <PageHero 
          title="Examination-Only"
          subtitle="Certified EASA Part-66 module sittings for self-study candidates and industry professionals."
          backgroundImage="/examonly.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="max-w-6xl mx-auto space-y-24">
            
            <div className="grid md:grid-cols-2 gap-16 items-center">
                <div>
                    <div className="w-16 h-1.5 bg-aerojet-sky mb-6 rounded-full" />
                    <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-6">Professional Testing Environment</h2>
                    <p className="text-slate-600 leading-relaxed mb-4 font-medium text-lg">
                        Aerojet Academy provides a high-standard facility for sitting official EASA Part-66 module exams. 
                    </p>
                    <p className="text-slate-500 leading-relaxed">
                        Seats are limited to a maximum of 28 per sitting to ensure strict invigilation and a focused atmosphere. All bookings, seat assignments, and results are managed via our secure student portal.
                    </p>
                </div>
                
                <div className="bg-slate-900 text-white p-10 rounded-[2.5rem] shadow-2xl relative border-t-4 border-aerojet-sky">
                    <h3 className="font-black uppercase tracking-widest text-xs text-aerojet-sky mb-6">Booking Conditions</h3>
                    <ul className="space-y-5">
                        <li className="flex gap-4">
                            <span className="text-aerojet-sky font-bold">●</span>
                            <p className="text-sm text-slate-300"><b>T-21 Confirmation:</b> Windows are confirmed only if minimum numbers are met 21 days prior.</p>
                        </li>
                        <li className="flex gap-4">
                            <span className="text-aerojet-sky font-bold">●</span>
                            <p className="text-sm text-slate-300"><b>Late Surcharge:</b> Bookings within T-14 incur a €50 admin surcharge if space remains.</p>
                        </li>
                        <li className="flex gap-4">
                            <span className="text-red-500 font-bold">●</span>
                            <p className="text-sm text-slate-300"><b>No-Shows:</b> Seats are forfeited once schedules are locked. Fees roll only if window is cancelled.</p>
                        </li>
                    </ul>
                </div>
            </div>

            {/* Pricing CTA */}
            <section className="bg-slate-50 rounded-[3rem] p-10 md:p-16 border border-slate-100 text-center shadow-inner">
                <h2 className="text-2xl font-black text-aerojet-blue uppercase tracking-widest mb-4">Pricing & Seat Availability</h2>
                <p className="text-slate-500 max-w-2xl mx-auto mb-10 font-medium">
                    Detailed pricing for individual module seats, 2-seat and 4-seat bundles, and Group Charters is visible exclusively within the <b>Student Portal</b>.
                </p>
                <Link href="/register" className="bg-aerojet-sky text-white px-12 py-4 rounded-xl font-black uppercase tracking-widest text-sm hover:bg-aerojet-blue transition-all shadow-lg active:scale-95">
                    Register to View Pricing
                </Link>
            </section>

            <NextSteps />
          </div>
        </div>
      </div>
      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'Module Requirements',
};

const modules = [
  { id: "M1", title: "Mathematics", cat: "Core" },
  { id: "M2", title: "Physics", cat: "Core" },
  { id: "M3", title: "Electrical Fundamentals", cat: "Core" },
  { id: "M4", title: "Electronic Fundamentals", cat: "Core" },
  { id: "M5", title: "Digital Techniques / Electronic Instrument Systems", cat: "Core" },
  { id: "M6", title: "Materials & Hardware", cat: "Core" },
  { id: "M7", title: "Maintenance Practices", cat: "Core" },
  { id: "M8", title: "Basic Aerodynamics", cat: "Core" },
  { id: "M9", title: "Human Factors", cat: "Core" },
  { id: "M10", title: "Aviation Legislation", cat: "Core" },
  { id: "M11", title: "Turbine Aeroplane Aerodynamics, Structures & Systems", cat: "B1 Specialist" },
  { id: "M12", title: "Helicopter Aerodynamics, Structures & Systems", cat: "B1 Specialist" },
  { id: "M13", title: "Aircraft Aerodynamics, Structures & Systems", cat: "B2 Specialist" },
  { id: "M14", title: "Propulsion", cat: "B2 Specialist" },
  { id: "M15", title: "Gas Turbine Engine", cat: "B1 Specialist" },
  { id: "M16", title: "Piston Engine", cat: "B1 Specialist" },
  { id: "M17", title: "Propeller", cat: "B1 Specialist" },
];

const pathways = [
    { name: "B1.1", title: "Aeroplanes Turbine", required: "M1–M10 + M11, M15 & M17" },
    { name: "B1.2", title: "Aeroplanes Piston", required: "M1–M10 + M11, M16 & M17" },
    { name: "B1.3", title: "Helicopters Turbine", required: "M1–M10 + M12 & M15" },
    { name: "B1.4", title: "Helicopters Piston", required: "M1–M10 + M12 & M16" },
    { name: "B2", title: "Avionics", required: "M1–M10 + M13 & M14" },
];

export default function ModulesPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50">
      <Navbar />
      
      <div className="grow">
        <PageHero 
          title="Module Requirements"
          subtitle="The EASA Part-66 knowledge syllabus for B1 and B2 certification."
          backgroundImage="/courselist.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="max-w-6xl mx-auto space-y-24">

            {/* 1. Pathway Mapping */}
            <section>
                <div className="text-center mb-16">
                    <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-4">Licence Pathways</h2>
                    <p className="text-slate-500 max-w-2xl mx-auto font-medium">Identify which modules you need based on your target license category.</p>
                </div>
                <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    {pathways.map(path => (
                        <div key={path.name} className="bg-white border border-slate-200 p-8 rounded-3xl shadow-sm hover:border-aerojet-sky transition-all group">
                            <h3 className="text-2xl font-black text-aerojet-blue group-hover:text-aerojet-sky transition-colors">{path.name}</h3>
                            <p className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">{path.title}</p>
                            <div className="pt-4 border-t border-slate-50">
                                <p className="text-[10px] font-black text-slate-400 uppercase mb-2">Required Modules:</p>
                                <p className="font-mono text-sm text-slate-700 font-bold leading-relaxed">{path.required}</p>
                            </div>
                        </div>
                    ))}
                </div>
            </section>
            
            {/* 2. Full Syllabus Table */}
            <section>
                <div className="text-center mb-16">
                    <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-4">Complete Syllabus</h2>
                    <p className="text-slate-500 max-w-2xl mx-auto font-medium">A total of 17 modules covering the full spectrum of aircraft maintenance knowledge.</p>
                </div>
                
                <div className="bg-white rounded-[2.5rem] shadow-xl border border-slate-100 overflow-hidden flex flex-col">
                    <div className="overflow-x-auto no-scrollbar">
                        <table className="w-full text-left text-sm min-w-175">
                            <thead className="bg-slate-900 text-white font-black uppercase text-[10px] tracking-[0.2em] border-b border-slate-800">
                                <tr>
                                    <th className="px-8 py-6">Code</th>
                                    <th className="px-8 py-6">Subject Matter</th>
                                    <th className="px-8 py-6 text-right">Category</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-50">
                                {modules.map(mod => (
                                    <tr key={mod.id} className="hover:bg-slate-50/50 transition-colors">
                                        <td className="px-8 py-5 font-black text-aerojet-sky text-lg">{mod.id}</td>
                                        <td className="px-8 py-5 font-bold text-slate-700">{mod.title}</td>
                                        <td className="px-8 py-5 text-right">
                                            <span className={`text-[9px] font-black uppercase px-2.5 py-1 rounded-full border ${
                                                mod.cat === 'Core' ? 'text-slate-400 border-slate-200' : 'text-aerojet-blue border-blue-100 bg-blue-50'
                                            }`}>
                                                {mod.cat}
                                            </span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

             {/* Final CTA */}
            <section className="bg-slate-900 rounded-[3rem] p-12 text-center text-white shadow-2xl relative overflow-hidden">
                <div className="relative z-10">
                    <h2 className="text-3xl font-black uppercase tracking-tight mb-4">Ready to Begin Your Modules?</h2>
                    <p className="text-slate-400 mb-10 max-w-xl mx-auto font-medium">Register today to view the modular schedule, access learning materials, and book your exam seats.</p>
                    <Link href="/register" className="bg-aerojet-sky text-white px-12 py-4 rounded-xl font-black uppercase tracking-widest text-sm hover:bg-white hover:text-aerojet-blue transition-all shadow-lg active:scale-95 inline-block">
                        Start Registration Now
                    </Link>
                </div>
            </section>
          </div>
        </div>
      </div>

      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';
import NextSteps from '@/components/NextSteps';

export const metadata: Metadata = {
  title: 'Pilot Training',
};

export default function PilotTrainingPage() {
  return (
    <main className="min-h-screen flex flex-col bg-white">
      <Navbar />
      <div className="grow">
        <PageHero 
          title="Pilot Training"
          subtitle="Take to the skies. Our world-class flight training programme is currently in development."
          backgroundImage="/pilot.jpg"
        />

        <div className="container mx-auto px-6 py-20 text-center">
          <div className="max-w-4xl mx-auto bg-slate-50 p-10 md:p-16 rounded-[3rem] border border-slate-100 shadow-sm relative overflow-hidden">
            <div className="relative z-10">
                <span className="bg-aerojet-sky text-white px-5 py-1.5 rounded-full text-[10px] font-black uppercase tracking-[0.2em] mb-8 inline-block">
                Programme Launching Soon
                </span>
                <h2 className="text-3xl md:text-5xl font-black text-aerojet-blue uppercase tracking-tight mb-6">
                Launch Your Career as a Pilot
                </h2>
                <p className="text-slate-600 text-lg mb-8 leading-relaxed font-medium">
                Aerojet Academy is finalizing the curriculum for a comprehensive Pilot Training programme, designed to take students from PPL (Private Pilot Licence) through to CPL (Commercial Pilot Licence) standards. 
                </p>
                <p className="text-slate-500 mb-12 max-w-2xl mx-auto">
                Training will include rigorous ground school and flight hours on modern training aircraft. Be the first to receive the syllabus and intake dates by registering your interest today.
                </p>

                <Link 
                href="/contact?interest=Pilot%20Training" 
                className="bg-aerojet-sky text-white px-12 py-4 rounded-xl font-black uppercase tracking-widest text-sm hover:bg-aerojet-blue transition-all shadow-lg shadow-blue-100 active:scale-95 inline-block"
                >
                Register Your Interest
                </Link>
            </div>
          </div>
        </div>

        <div className="container mx-auto px-6 pb-20">
            <NextSteps />
        </div>
      </div>
      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'Revision Support',
};

export default function RevisionSupportPage() {
  return (
    <main className="min-h-screen flex flex-col bg-white">
      <Navbar />
      <div className="grow">
        <PageHero 
          title="Revision Support"
          subtitle="Intensive 8-week tuition blocks designed for organizations and large cohorts."
          backgroundImage="/lecture.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="max-w-5xl mx-auto space-y-20">
            
            {/* 1. Programme Concept */}
            <div className="grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <div className="w-16 h-1.5 bg-aerojet-sky mb-6 rounded-full" />
                    <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-6">Group Learning Solution</h2>
                    <p className="text-slate-600 leading-relaxed mb-4 font-medium">
                        Our Revision Support clinics are designed for **organizations, airlines, or pre-formed groups** requiring focused preparation for their candidates before EASA examinations.
                    </p>
                    <p className="text-slate-500 leading-relaxed text-sm">
                        This 8-week intensive series provides deep-dive tuition and mock exams. It is not available for individual booking.
                    </p>
                    <div className="mt-6 p-4 bg-orange-50 border-l-4 border-orange-400 rounded-r-lg">
                        <p className="text-xs font-bold text-orange-800 uppercase tracking-widest mb-1">Individual Student?</p>
                        <p className="text-xs text-orange-700">Please view our <Link href="/courses/easa-modular" className="underline font-bold">Modular Training Programme</Link> which allows individuals to book tuition per module.</p>
                    </div>
                </div>
                <div className="bg-slate-900 text-white p-10 rounded-[2.5rem] shadow-2xl relative overflow-hidden border-t-4 border-aerojet-sky">
                    <h3 className="text-xl font-black uppercase tracking-tight mb-6 text-aerojet-sky">Booking Requirements</h3>
                    <ul className="space-y-6">
                        <li className="flex gap-4">
                            <span className="shrink-0 w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center font-bold text-sm">20+</span>
                            <div>
                                <p className="font-bold text-sm">Minimum Group Size</p>
                                <p className="text-xs text-slate-400 leading-relaxed">Bookings are only accepted for cohorts of 20 or more candidates.</p>
                            </div>
                        </li>
                        <li className="flex gap-4">
                            <span className="shrink-0 w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center font-bold text-sm">8W</span>
                            <div>
                                <p className="font-bold text-sm">Block Duration</p>
                                <p className="text-xs text-slate-400 leading-relaxed">The curriculum is fixed to an 8-week intensive schedule per module.</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            {/* 2. Format Details */}
            <section className="bg-slate-50 rounded-[3rem] p-10 border border-slate-200">
                <h2 className="text-2xl font-black text-aerojet-blue uppercase tracking-tight mb-8 text-center">The 8-Week Structure</h2>
                <div className="grid md:grid-cols-3 gap-6">
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <span className="text-aerojet-sky font-black text-4xl block mb-2">01</span>
                        <h4 className="font-bold text-slate-800 text-sm uppercase mb-2">Tuition Clinics</h4>
                        <p className="text-[11px] text-slate-500">Weekly classroom sessions focusing on core syllabus topics.</p>
                    </div>
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <span className="text-aerojet-sky font-black text-4xl block mb-2">02</span>
                        <h4 className="font-bold text-slate-800 text-sm uppercase mb-2">Mid-Point Mock</h4>
                        <p className="text-[11px] text-slate-500">A full mock examination at Week 4 to assess progress.</p>
                    </div>
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <span className="text-aerojet-sky font-black text-4xl block mb-2">03</span>
                        <h4 className="font-bold text-slate-800 text-sm uppercase mb-2">Final Mock</h4>
                        <p className="text-[11px] text-slate-500">Exam-condition simulation at Week 8 before the official sitting.</p>
                    </div>
                </div>
            </section>

            {/* 3. CTA for Groups */}
            <div className="text-center pt-8">
                <h2 className="text-2xl font-black text-aerojet-blue uppercase tracking-tight mb-4">Corporate & Group Enquiry</h2>
                <p className="text-slate-500 mb-8 max-w-lg mx-auto text-sm">
                    Representing an organization? Contact us to discuss scheduling a dedicated revision block for your team.
                </p>
                <Link href="/contact" className="bg-aerojet-blue text-white px-10 py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-aerojet-sky transition-all shadow-lg">
                    Contact Corporate Admissions
                </Link>
            </div>

          </div>
        </div>
      </div>
      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Image from 'next/image';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';

export const metadata: Metadata = {
  title: 'Programmes',
};

const courseList = [
    {
        id: "A",
        title: "Four-Year Full-Time (B1.1 & B2)",
        desc: "Comprehensive theory, advanced hand-skills, and structured work-experience.",
        features: ["Exam fees included", "2 free re-sits", "Logbook & PPE included"],
        link: "/courses/easa-full-time"
    },
    {
        id: "B",
        title: "Two-Year Full-Time (B1.1)",
        desc: "Theory + hand-skills training. The fastest route for school leavers.",
        features: ["Exam fees included", "2 free re-sits", "Optional B2 top-up"],
        link: "/courses/easa-full-time"
    },
    {
        id: "C",
        title: "12-Month Crash Course",
        desc: "Accelerated B1.1 certification for Industry/Military professionals.",
        features: ["Theory & Exams only", "No hand-skills", "Evening/Weekend classes"],
        link: "/courses/easa-full-time"
    },
    {
        id: "D",
        title: "Modular Training",
        desc: "Individual tuition + exam per module. Book your preferred modules and join a scheduled class.",
        features: ["Includes classroom tuition", "One exam sitting included", "Flexible scheduling"],
        link: "/courses/easa-modular"
    },
    {
        id: "E",
        title: "Examination-Only",
        desc: "Self-study candidates booking exam seats directly. Strict deadline policies apply.",
        features: ["Exam seat only", "No tuition provided", "Strict T-21 deadline"],
        link: "/courses/examination-only"
    },
    {
        id: "F",
        title: "Revision Support",
        desc: "Intensive 8-week block tuition designed for groups and organizations (Min 20 students).",
        features: ["Group bookings only", "2 Mock Exams included", "Custom scheduling"],
        link: "/courses/revision-support"
    }
];

export default function CoursesPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50">
      <Navbar />
      
      <div className="grow">
        <PageHero 
          title="Our Training Programmes"
          subtitle="From full-time licensure to flexible modular exams, choose the path that fits your career goals."
          backgroundImage="/coursespage.jpg"
        />

        {/* Main Content */}
        <section className="py-20">
          <div className="container mx-auto px-6">
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                {courseList.map((course) => (
                    <div key={course.id} className="bg-white rounded-2xl shadow-md overflow-hidden border border-slate-100 hover:shadow-xl transition-all duration-300 flex flex-col group hover:border-aerojet-sky">
                        <div className="bg-aerojet-blue p-4 text-white flex justify-between items-center">
                            <span className="font-black text-sm uppercase tracking-widest opacity-70">Option {course.id}</span>
                            <span className="bg-white/10 px-2 py-1 rounded text-[10px] font-bold uppercase tracking-tighter">Pricing in Portal</span>
                        </div>
                        <div className="p-8 grow flex flex-col">
                            <h3 className="text-xl font-black text-aerojet-blue mb-3 leading-tight group-hover:text-aerojet-sky transition-colors">{course.title}</h3>
                            <p className="text-slate-500 text-sm mb-6 grow leading-relaxed">{course.desc}</p>
                            
                            <ul className="space-y-2 mb-8 border-t border-slate-50 pt-6">
                                {course.features.map(f => (
                                    <li key={f} className="flex items-center text-xs font-bold text-slate-400">
                                        <span className="text-aerojet-sky mr-2 text-lg">✓</span> {f}
                                    </li>
                                ))}
                            </ul>

                            <Link href={course.link} className="block w-full text-center bg-slate-50 hover:bg-aerojet-sky hover:text-white border border-slate-100 text-slate-600 font-black uppercase text-[10px] tracking-widest py-4 rounded-xl transition-all">
                                View Details
                            </Link>
                        </div>
                    </div>
                ))}
            </div>
          </div>
        </section>

        {/* Next Steps CTA - Updated with Verbatim Text */}
        <section className="py-20 bg-white border-t border-slate-100">
            <div className="container mx-auto px-6 text-center">
                <h2 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight mb-4">Ready to Enroll?</h2>
                <p className="text-slate-500 mb-12 max-w-2xl mx-auto">Follow our 4-step process to secure your seat at the academy.</p>
                
                <div className="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 text-left mb-12">
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <span className="text-aerojet-sky font-black text-xl mb-2 block">01</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-1">Registration Invoice</h4>
                        <p className="text-[11px] text-slate-500 leading-tight">Pay the GHS 350 fee to initiate your application.</p>
                    </div>
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <span className="text-aerojet-sky font-black text-xl mb-2 block">02</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-1">Online Application</h4>
                        <p className="text-[11px] text-slate-500 leading-tight">Submit your docs via the secure portal for review.</p>
                    </div>
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <span className="text-aerojet-sky font-black text-xl mb-2 block">03</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-1">Confirmation Invoice</h4>
                        <p className="text-[11px] text-slate-500 leading-tight">Upon approval, pay your seat deposit or exam fee.</p>
                    </div>
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <span className="text-aerojet-sky font-black text-xl mb-2 block">04</span>
                        <h4 className="font-bold text-aerojet-blue text-sm mb-1">Start Training</h4>
                        <p className="text-[11px] text-slate-500 leading-tight">Access your materials and receive your start date.</p>
                    </div>
                </div>

                <Link href="/register" className="bg-aerojet-sky text-white px-12 py-4 rounded-xl font-black uppercase tracking-[0.2em] text-sm hover:bg-aerojet-blue transition-all shadow-lg shadow-blue-100 active:scale-95 inline-block">
                    Start Registration Now
                </Link>
            </div>
        </section>

      </div>
      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';

export const metadata: Metadata = {
  title: 'Application Terms',
};

export default function TermsPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50 pt-20">
      <Navbar theme="light" />
      
      <div className="grow container mx-auto px-6 py-12 max-w-4xl">
        <div className="bg-white p-8 md:p-16 rounded-[2.5rem] shadow-xl border border-slate-100 relative overflow-hidden">
          
          {/* Header */}
          <div className="mb-12 border-b border-slate-100 pb-8">
            <span className="bg-blue-50 text-aerojet-sky px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-widest mb-4 inline-block">
                Legal Policy
            </span>
            <h1 className="text-3xl md:text-5xl font-black text-aerojet-blue uppercase tracking-tight leading-tight">
              Online Application <br/>Terms & Conditions
            </h1>
            <p className="text-slate-400 mt-4 font-medium text-sm italic">
              Last Updated: February 2026
            </p>
          </div>

          <div className="prose prose-slate max-w-none 
            prose-headings:text-aerojet-blue prose-headings:font-black prose-headings:uppercase prose-headings:tracking-tight
            prose-p:text-slate-600 prose-p:leading-relaxed
            prose-strong:text-slate-900 prose-strong:font-bold
            prose-li:text-slate-600">
            
            <p className="text-lg font-medium text-slate-700">
              By initiating the registration process or submitting an application to Aerojet Aviation Training Academy, you acknowledge that you have read, understood, and agree to the following terms.
            </p>

            <h3>1. Registration Gating & Fees</h3>
            <ul>
              <li><strong>Initial Payment:</strong> A one-time Registration Fee of <strong>GHS 350.00</strong> is mandatory for all programmes.</li>
              <li><strong>Non-Refundable:</strong> The Registration Fee is strictly non-refundable and covers administrative processing, background checks, and verification.</li>
              <li><strong>Access:</strong> Payment of this fee is required before the secure Online Application Form link is released to the candidate.</li>
            </ul>

            <h3>2. Enrollment & Seat Confirmation</h3>
            <ul>
              <li><strong>Full-Time Programmes:</strong> Approved applicants must pay a <strong>40% Seat Confirmation Deposit</strong> of the first year's tuition to secure their place in the cohort.</li>
              <li><strong>Modular/Exam Programmes:</strong> Enrollment is confirmed only upon 100% upfront payment of the booked module or exam seat.</li>
              <li><strong>Deadlines:</strong> Failure to settle confirmation invoices by the specified deadline may result in the seat being offered to the next candidate on the waitlist.</li>
            </ul>

            <h3>3. Examination Policies (Exam-Only)</h3>
            <ul>
              <li><strong>Go/No-Go Decision (T-21):</strong> Exam windows are confirmed 21 days prior to the start date. Sittings proceed only if the minimum threshold (60 paid seats or 3 Group Charters) is met.</li>
              <li><strong>Roll-over Rule:</strong> If a window is cancelled due to low numbers, all confirmed bookings will roll to the next available window at no extra cost.</li>
              <li><strong>Late Booking:</strong> Bookings made within 14 days (T-14) of an exam incur a <strong>€50 surcharge</strong>, subject to seat availability.</li>
              <li><strong>No-Shows:</strong> Candidates who fail to attend a scheduled and locked exam sitting forfeit their fees.</li>
            </ul>

            <h3>4. The 24-Month Rule (Modular)</h3>
            <p>
              In accordance with EASA standards, candidates pursuing a full category certification via the modular route must successfully complete all required examinations within a <strong>24-month window</strong>, starting from the date of the first passed module.
            </p>

            <h3>5. Cohort Minimums & Start Dates</h3>
            <ul>
              <li>Course start dates are indicative. Actual commencement is subject to meeting minimum cohort sizes.</li>
              <li>Aerojet Academy reserves the right to adjust schedules or defer intakes if minimum numbers are not reached. Enrolled students will be notified via the Student Portal.</li>
            </ul>

            <h3>6. Documentation & Conduct</h3>
            <p>
              All documents uploaded to the portal (Passport, Certificates, Transcripts) must be authentic. Submission of forged documents will result in immediate disqualification, forfeiture of fees, and a permanent ban from the Academy.
            </p>

            <div className="mt-16 pt-10 border-t border-slate-100 flex flex-col md:flex-row justify-between items-center gap-6">
                <div>
                    <p className="font-black text-aerojet-blue uppercase text-sm">Have Questions?</p>
                    <p className="text-xs text-slate-500">Our admissions team is available to clarify these terms.</p>
                </div>
                <div className="flex gap-4">
                    <Link href="/contact" className="text-aerojet-sky font-bold text-xs uppercase tracking-widest hover:underline">
                        Contact Us
                    </Link>
                    <Link href="/register" className="bg-aerojet-sky text-white px-6 py-3 rounded-xl font-black uppercase text-[10px] tracking-widest hover:bg-aerojet-blue transition-all shadow-md">
                        Start Registration
                    </Link>
                </div>
            </div>

          </div>
        </div>
      </div>

      <Footer />
    </main>
  );
}

import { Resend } from 'resend';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();
const resend = new Resend(process.env.RESEND_API_KEY);

// --- CONFIGURATION ---
const FROM_EMAIL = 'Aerojet Academy <trainingprograms@aerojet-academy.com>';

/**
 * Helper to fetch a dynamic email recipient from the SystemSettings table.
 * If not set in the Admin Portal, it falls back to your default gmail.
 */
async function getEmailRecipient(key: string) {
  try {
    const setting = await prisma.systemSetting.findUnique({
      where: { key },
    });
    // Fallback to the new trainingprograms email
    return setting?.value || 'trainingprograms@aerojet-academy.com';
  } catch (error) {
    return 'trainingprograms@aerojet-academy.com';
  }
}

// --- 1. STUDENT: AUTO-REPLY TO ENQUIRY ---
export const sendEnquiryEmail = async (email: string, name: string) => {
  await resend.emails.send({
    from: FROM_EMAIL,
    to: email,
    subject: 'Aerojet Academy - Enquiry Received',
    html: `
      <div style="font-family: sans-serif; color: #333;">
        <h1>Hello ${name},</h1>
        <p>Thank you for reaching out to Aerojet Aviation Training Academy.</p>
        <p>We have received your enquiry. Our admissions team will review your interest and contact you shortly.</p>
        <p><strong>Next Step:</strong> We will first issue an invoice for the GHS 350 registration fee. Payment of the registration fee is required before you can complete the online application.</p>
        <p>Regards,<br/><b>Admissions Team</b></p>
      </div>
    `,
  });
};

// --- 2. STAFF: INTERNAL NOTIFICATION OF NEW LEAD ---
export const sendStaffNotification = async (name: string, email: string, message: string) => {
  // Dynamically fetch who should receive "Contact Form" enquiries
  const recipient = await getEmailRecipient('CONTACT_FORM_RECIPIENT');

  await resend.emails.send({
    from: 'Website System <system@aerojet-academy.com>',
    to: recipient,
    subject: `New Website Enquiry: ${name}`,
    html: `
      <div style="font-family: sans-serif; color: #333;">
        <h2 style="color: #002a5c;">New Lead Captured</h2>
        <p>A new enquiry has been submitted via the website contact form.</p>
        <div style="background: #f9f9f9; padding: 20px; border-radius: 10px; border: 1px solid #eee;">
          <p><strong>Name:</strong> ${name}</p>
          <p><strong>Email:</strong> ${email}</p>
          <p><strong>Message:</strong></p>
          <p style="white-space: pre-wrap;">${message}</p>
        </div>
        <p style="font-size: 12px; color: #999; margin-top: 20px;">
            Notification sent to: ${recipient}<br/>
            Change this recipient in the Staff Portal > Settings > Email Routing.
        </p>
      </div>
    `,
  });
};

// --- 3. STUDENT: REGISTRATION INVOICE ---
export const sendRegistrationInvoiceEmail = async (email: string, name: string) => {
  await resend.emails.send({
    from: FROM_EMAIL,
    to: email,
    subject: 'Your Registration Fee Invoice - Aerojet Academy',
    html: `
      <div style="font-family: sans-serif; color: #333;">
        <h1>Welcome ${name},</h1>
        <p>To begin your journey at Aerojet Academy, please complete the mandatory one-time registration fee.</p>
        
        <div style="background: #eef6ff; padding: 20px; border-radius: 12px; border-left: 6px solid #2880b9;">
            <h3 style="margin-top: 0; color: #002a5c;">OFFICIAL BANKING DETAILS</h3>
            <p style="margin: 5px 0;"><strong>Bank:</strong> FNB Bank</p>
            <p style="margin: 5px 0;"><strong>Account Name:</strong> AEROJET FOUNDATION</p>
            <p style="margin: 5px 0;"><strong>Account No:</strong> 1020003980687</p>
            <p style="margin: 5px 0;"><strong>Branch Code:</strong> 330102</p>
            <p style="margin: 5px 0;"><strong>SWIFT CODE:</strong> FIRNGHACXXX</p>
            <p style="margin: 10px 0 0 0; font-size: 18px; font-weight: bold;">Amount Due: GHS 350.00</p>
        </div>

        <p style="margin-top: 20px;">Once payment is made, please reply to this email with your proof of payment or upload it to your portal profile (once activated).</p>
        <p>Regards,<br/><b>Aerojet Finance Team</b></p>
      </div>
    `,
  });
};

// --- 4. STUDENT: PAYMENT VERIFIED / APP UNLOCKED ---
export const sendPaymentVerifiedEmail = async (email: string, name: string) => {
  await resend.emails.send({
    from: FROM_EMAIL,
    to: email,
    subject: 'Payment Verified - Application Unlocked',
    html: `
      <div style="font-family: sans-serif; color: #333;">
        <h1>Good news, ${name}!</h1>
        <p>Your payment has been verified by our finance team.</p>
        <p>The <strong>Online Application Form</strong> is now unlocked in your student portal. Please log in to provide your academic details and upload your documents.</p>
        <div style="margin-top: 30px;">
            <a href="https://aerojet-academy.com/portal/login" style="background: #2880b9; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold;">Log in to Portal</a>
        </div>
        <p style="margin-top: 30px;">Regards,<br/><b>Aerojet Academy Admissions</b></p>
      </div>
    `,
  });
};
import { Metadata } from 'next';
import { PortableText } from '@portabletext/react';
import Image from 'next/image';
import { notFound } from 'next/navigation';
import Link from 'next/link'; // <--- ADD THIS LINE
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import { client } from '@/sanity/lib/client';
import { urlFor } from '@/sanity/lib/image';

type Props = {
  params: Promise<{ slug: string }>;
};
// --- DYNAMIC METADATA ---
export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { slug } = await params;
  const article = await client.fetch(`*[_type == "article" && slug.current == $slug][0]{title, summary}`, { slug });
  
  if (!article) return { title: "Article Not Found" };

  return {
    title: article.title,
    description: article.summary,
  };
}

async function getArticle(slug: string) {
  const query = `*[_type == "article" && slug.current == $slug][0] {
    title, 
    mainImage, 
    category, 
    publishedAt, 
    body
  }`;
  return await client.fetch(query, { slug });
}

export default async function ArticlePage({ params }: Props) {
  // Await params for Next.js 15
  const { slug } = await params;
  const article = await getArticle(slug);

  if (!article) return notFound();

  return (
    <main className="min-h-screen flex flex-col bg-white">
      <Navbar theme="light" />
      
      <div className="grow pt-24">
        {/* Article Header */}
        <header className="container mx-auto px-6 py-12 text-center border-b border-slate-50 mb-12">
          <div className="inline-block bg-blue-50 text-aerojet-sky px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-[0.2em] mb-6">
            {article.category}
          </div>
          <h1 className="text-4xl md:text-6xl font-black text-aerojet-blue max-w-4xl mx-auto tracking-tighter leading-[1.1]">
            {article.title}
          </h1>
          <div className="mt-8 flex items-center justify-center gap-4 text-slate-400 font-bold text-xs uppercase tracking-widest">
            <span>By Aerojet Admissions</span>
            <span className="w-1 h-1 rounded-full bg-slate-300"></span>
            <span>{new Date(article.publishedAt).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
          </div>
        </header>

        {/* Hero Image */}
        <div className="container mx-auto px-6 max-w-6xl mb-16">
            <div className="relative aspect-video rounded-[2.5rem] overflow-hidden shadow-2xl border-8 border-white">
                <Image
                    src={urlFor(article.mainImage).url()}
                    alt={article.title}
                    fill
                    className="object-cover"
                    priority
                />
            </div>
        </div>

        {/* Article Body */}
        <article className="container mx-auto px-6 pb-32 max-w-3xl">
          <div className="prose prose-slate prose-lg lg:prose-xl max-w-none 
            prose-headings:text-aerojet-blue prose-headings:font-black prose-headings:tracking-tight
            prose-p:text-slate-600 prose-p:leading-relaxed
            prose-strong:text-aerojet-blue prose-strong:font-black
            prose-a:text-aerojet-sky prose-a:font-bold prose-a:no-underline hover:prose-a:underline">
            <PortableText value={article.body} />
          </div>
          
          <div className="mt-20 pt-10 border-t border-slate-100 text-center">
            <p className="text-slate-400 font-bold text-xs uppercase tracking-widest mb-6">Interested in our programmes?</p>
            <Link href="/register" className="bg-aerojet-sky text-white px-10 py-4 rounded-xl font-black uppercase tracking-widest text-sm hover:bg-aerojet-blue transition-all shadow-lg">
                Begin Your Application
            </Link>
          </div>
        </article>
      </div>

      <Footer />
    </main>
  );
}

import { Metadata } from 'next';
import Link from 'next/link';
import Image from 'next/image';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import PageHero from '@/components/PageHero';
import { client } from '@/sanity/lib/client';
import { urlFor } from '@/sanity/lib/image';

export const metadata: Metadata = {
  title: 'Newsroom',
};

async function getArticles() {
  const query = `*[_type == "article" && defined(slug.current)] | order(publishedAt desc) {
    _id,
    title,
    slug,
    mainImage,
    category,
    publishedAt
  }`;
  return await client.fetch(query);
}

export default async function NewsroomPage() {
  const articles = await getArticles();

  return (
    <main className="min-h-screen flex flex-col bg-slate-50">
      <Navbar />
      
      <div className="grow">
        <PageHero 
          title="News & Updates"
          subtitle="Stay informed about our latest intakes, partnerships, and facility milestones."
          backgroundImage="/news.jpg"
        />

        <div className="container mx-auto px-6 py-20">
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
            {articles.map((article: any) => (
              <Link 
                href={`/news/${article.slug.current}`} 
                key={article._id} 
                className="group bg-white rounded-3xl shadow-sm hover:shadow-2xl transition-all duration-500 overflow-hidden border border-slate-100 flex flex-col"
              >
                <div className="relative h-60 w-full bg-slate-100 overflow-hidden">
                  <Image 
                    src={urlFor(article.mainImage).url()} 
                    alt={article.title} 
                    fill
                    className="object-cover transition-transform duration-700 group-hover:scale-110" 
                  />
                  <div className="absolute top-4 left-4 bg-white/90 backdrop-blur-md px-3 py-1 rounded-full shadow-sm">
                    <p className="text-[10px] font-black text-aerojet-sky uppercase tracking-widest">{article.category}</p>
                  </div>
                </div>
                
                <div className="p-8 grow flex flex-col">
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3">
                    {new Date(article.publishedAt).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}
                  </p>
                  <h3 className="text-xl font-black text-aerojet-blue leading-tight mb-4 group-hover:text-aerojet-sky transition-colors line-clamp-2">
                    {article.title}
                  </h3>
                  <div className="mt-auto pt-4 flex items-center text-aerojet-sky font-black uppercase text-[10px] tracking-[0.2em]">
                    Read Full Story
                    <span className="ml-2 transform group-hover:translate-x-2 transition-transform">→</span>
                  </div>
                </div>
              </Link>
            ))}
          </div>
        </div>
      </div>

      <Footer />
    </main>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import { useParams, useRouter } from "next/navigation";
import { UploadButton } from "@/app/utils/uploadthing";

export default function CompleteApplicationPage() {
  const params = useParams();
  const router = useRouter();
  const [app, setApp] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  
  const [formData, setFormData] = useState({
    educationLevel: '',
    institutionName: '',
    graduationYear: '',
    idDocumentUrl: '',
    certificateUrl: '',
    transcriptUrl: ''
  });

  useEffect(() => {
    fetch(`/api/portal/applications/${params.id}`)
      .then(res => res.json())
      .then(data => {
        setApp(data.application);
        if (data.application) {
            setFormData({
                educationLevel: data.application.educationLevel || '',
                institutionName: data.application.institutionName || '',
                graduationYear: data.application.graduationYear || '',
                idDocumentUrl: data.application.idDocumentUrl || '',
                certificateUrl: data.application.certificateUrl || '',
                transcriptUrl: data.application.transcriptUrl || ''
            });
        }
        setLoading(false);
      });
  }, [params.id]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    const res = await fetch(`/api/portal/applications/${params.id}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
    });

    if (res.ok) {
        toast.success("Application submitted for review!");
        router.push('/portal/courses');
    } else {
        const err = await res.json();
        toast.error(err.error || "Submission failed.");
    }
  };

  if (loading) return <div className="p-8 text-center text-slate-500">Loading application form...</div>;

  return (
    <div className="max-w-4xl mx-auto space-y-8 pb-20">
      <div>
        <h1 className="text-3xl font-black text-aerojet-blue tracking-tight uppercase">Complete Your Application</h1>
        <p className="text-slate-500">Course: <span className="font-bold">{app?.course?.title}</span></p>
      </div>

      <form onSubmit={handleSubmit} className="space-y-8">
        
        {/* Academic Details */}
        <section className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
            <h2 className="text-sm font-black uppercase tracking-widest text-slate-400 mb-6 border-b pb-2">Academic Background</h2>
            <div className="grid md:grid-cols-2 gap-6">
                <div>
                    <label className="block text-xs font-bold text-slate-700 uppercase mb-1">Education Level</label>
                    <select className="w-full border border-slate-300 rounded-lg p-2 bg-white" value={formData.educationLevel} onChange={e => setFormData({...formData, educationLevel: e.target.value})} required>
                        <option value="">Select Level...</option>
                        <option value="High School">High School / WASSCE</option>
                        <option value="Diploma">Diploma</option>
                        <option value="Degree">Bachelor's Degree</option>
                    </select>
                </div>
                <div>
                    <label className="block text-xs font-bold text-slate-700 uppercase mb-1">Institution Name</label>
                    <input type="text" className="w-full border border-slate-300 rounded-lg p-2" value={formData.institutionName} onChange={e => setFormData({...formData, institutionName: e.target.value})} required />
                </div>
            </div>
        </section>

        {/* Document Uploads */}
        <section className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
            <h2 className="text-sm font-black uppercase tracking-widest text-slate-400 mb-6 border-b pb-2">Required Documents (PDF or Image)</h2>
            <div className="space-y-6">
                
                {/* ID Upload */}
                <div className="flex flex-col md:flex-row items-center justify-between p-4 bg-slate-50 rounded-xl gap-4">
                    <div>
                        <p className="font-bold text-slate-800">Passport or National ID</p>
                        <p className="text-xs text-slate-500">{formData.idDocumentUrl ? '✅ File Uploaded' : '❌ Missing'}</p>
                    </div>
                    <UploadButton 
                        endpoint="paymentProof"
                        onClientUploadComplete={(res) => setFormData({...formData, idDocumentUrl: res[0].url})}
                        // FIX: Wrapped in braces to return void
                        onUploadError={(e) => { toast.error(e.message); }}
                    />
                </div>

                {/* Certificate Upload */}
                <div className="flex flex-col md:flex-row items-center justify-between p-4 bg-slate-50 rounded-xl gap-4">
                    <div>
                        <p className="font-bold text-slate-800">High School Certificate</p>
                        <p className="text-xs text-slate-500">{formData.certificateUrl ? '✅ File Uploaded' : '❌ Missing'}</p>
                    </div>
                    <UploadButton 
                        endpoint="paymentProof"
                        onClientUploadComplete={(res) => setFormData({...formData, certificateUrl: res[0].url})}
                        // FIX: Wrapped in braces to return void
                        onUploadError={(e) => { toast.error(e.message); }}
                    />
                </div>

            </div>
        </section>

        <div className="flex justify-end pt-4">
            <button type="submit" className="bg-aerojet-sky text-white px-12 py-4 rounded-xl font-black uppercase tracking-widest hover:bg-aerojet-blue shadow-lg transition-all">
                Submit Full Application
            </button>
        </div>
      </form>
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function AttendanceHistoryPage() {
  const [records, setRecords] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch('/api/portal/attendance')
      .then(res => res.json())
      .then(data => { setRecords(data.records || []); setLoading(false); })
      .catch(() => toast.error("Failed to load"));
  }, []);

  if (loading) return <div className="p-8 text-center text-gray-500">Loading Attendance...</div>;

  return (
    <div className="max-w-5xl mx-auto">
      <h1 className="text-3xl font-bold text-aerojet-blue mb-6">Attendance History</h1>
      
      <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div className="overflow-x-auto no-scrollbar">
            <table className="w-full text-left text-sm text-gray-600 min-w-150">
                <thead className="bg-slate-50 border-b font-bold text-slate-800">
                    <tr>
                        <th className="px-6 py-4">Date</th>
                        <th className="px-6 py-4">Course</th>
                        <th className="px-6 py-4">Hours Scheduled</th>
                        <th className="px-6 py-4">Hours Attended</th>
                        <th className="px-6 py-4">Lateness</th>
                        <th className="px-6 py-4 text-center">Status</th>
                    </tr>
                </thead>
                <tbody className="divide-y">
                    {records.length === 0 ? (
                        <tr><td colSpan={6} className="p-8 text-center italic">No records found.</td></tr>
                    ) : (
                        records.map(rec => {
                            const isPresent = rec.attendedHours === rec.scheduledHours;
                            const isAbsent = rec.attendedHours === 0;
                            return (
                                <tr key={rec.id} className="hover:bg-slate-50">
                                    <td className="px-6 py-4">{new Date(rec.date).toLocaleDateString()}</td>
                                    <td className="px-6 py-4 font-bold text-slate-700">{rec.course.code}</td>
                                    <td className="px-6 py-4">{rec.scheduledHours}</td>
                                    <td className="px-6 py-4">{rec.attendedHours}</td>
                                    <td className="px-6 py-4">{rec.lateMinutes > 0 ? <span className="text-red-600 font-bold">{rec.lateMinutes}m</span> : "-"}</td>
                                    <td className="px-6 py-4 text-center">
                                        {isAbsent ? <span className="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-bold">ABSENT</span> : 
                                         isPresent ? <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-bold">PRESENT</span> :
                                         <span className="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs font-bold">PARTIAL</span>}
                                    </td>
                                </tr>
                            );
                        })
                    )}
                </tbody>
            </table>
        </div>
      </div>
    </div>
  );
}
"use client";
import { useSession } from "next-auth/react";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import Link from "next/link"; // Ensure Link is imported

type Course = {
  id: string;
  title: string;
  code: string;
  description: string;
  duration: string;
  price: number;
};

type Application = {
  id: string;
  courseId: string;
  status: string;
  appliedAt: string;
  course: Course & { materialLink?: string };
};

export default function CoursesPage() {
  const { status } = useSession();
  const [activeTab, setActiveTab] = useState<'my-courses' | 'browse'>('my-courses');
  const [courses, setCourses] = useState<Course[]>([]);
  const [applications, setApplications] = useState<Application[]>([]);
  const [loading, setLoading] = useState(true);
  const [applyingId, setApplyingId] = useState<string | null>(null);

  // Fetch Data
  async function fetchData() {
    try {
      const res = await fetch('/api/portal/courses');
      const data = await res.json();
      if (res.ok) {
        setCourses(data.courses || []);
        const apps = (data.applications || []).map((app: any) => ({
            ...app,
            course: data.courses.find((c: any) => c.id === app.courseId)
        }));
        setApplications(apps);
        if (apps.length === 0) setActiveTab('browse');
      }
    } catch (error) {
      toast.error("Failed to load courses.");
    } finally {
      setLoading(false);
    }
  }

  useEffect(() => {
    if (status === 'authenticated') fetchData();
  }, [status]);

  const handleApply = async (courseId: string) => {
    setApplyingId(courseId);
    try {
      const res = await fetch('/api/portal/courses', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ courseId }),
      });
      
      if (res.ok) {
        toast.success("Initial application sent. Now complete the full form.");
        fetchData(); 
      } else {
        const err = await res.json();
        toast.error(err.error || "Failed to apply.");
      }
    } catch (error) {
      toast.error("An error occurred.");
    } finally {
      setApplyingId(null);
    }
  };

  const myCourseIds = new Set(applications.map(app => app.courseId));
  const availableCourses = courses.filter(c => !myCourseIds.has(c.id));
  const fullTimePrograms = availableCourses.filter(c => c.code.startsWith('PROG-'));
  const examModules = availableCourses.filter(c => c.code.startsWith('MOD-'));

  if (loading) return <div className="p-8 text-center text-gray-500">Loading Courses...</div>;

  return (
    <div className="max-w-6xl mx-auto pb-20">
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <div>
          <h1 className="text-3xl font-black text-aerojet-blue uppercase tracking-tight">Courses & Exams</h1>
          <p className="text-slate-500 mt-1">Manage your active enrollments and browse available programs.</p>
        </div>
        
        <div className="bg-white p-1 rounded-xl border border-slate-200 flex shadow-sm">
          <button onClick={() => setActiveTab('my-courses')} className={`px-6 py-2 rounded-lg text-xs font-black uppercase tracking-widest transition-all ${activeTab === 'my-courses' ? "bg-aerojet-sky text-white shadow-md" : "text-slate-400 hover:text-aerojet-blue"}`}>
            My Enrollments
          </button>
          <button onClick={() => setActiveTab('browse')} className={`px-6 py-2 rounded-lg text-xs font-black uppercase tracking-widest transition-all ${activeTab === 'browse' ? "bg-aerojet-sky text-white shadow-md" : "text-slate-400 hover:text-aerojet-blue"}`}>
            Browse Catalog
          </button>
        </div>
      </div>

      {/* --- TAB: MY ENROLLMENTS --- */}
      {activeTab === 'my-courses' && (
        <div className="space-y-6">
          {applications.length === 0 ? (
            <div className="text-center py-20 bg-white rounded-2xl border-2 border-dashed border-slate-200">
              <p className="text-slate-400 font-medium mb-4">You have not applied for any courses yet.</p>
              <button onClick={() => setActiveTab('browse')} className="bg-aerojet-sky text-white px-8 py-3 rounded-xl font-bold text-sm hover:shadow-lg transition-all">Browse Catalog &rarr;</button>
            </div>
          ) : (
            <div className="grid md:grid-cols-2 gap-6">
              {applications.map((app) => (
                <div key={app.id} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col justify-between hover:shadow-md transition-all">
                  <div>
                    <div className="flex justify-between items-start mb-4">
                        <span className={`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter ${
                            app.status === 'APPROVED' ? 'bg-green-100 text-green-700' : 
                            app.status === 'REJECTED' ? 'bg-red-100 text-red-700' : 
                            'bg-orange-100 text-orange-700'
                        }`}>
                            {app.status}
                        </span>
                        <span className="text-[10px] font-bold text-slate-400 uppercase">Applied: {new Date(app.appliedAt).toLocaleDateString()}</span>
                    </div>
                    <h3 className="text-xl font-black text-aerojet-blue leading-tight mb-1">{app.course?.title}</h3>
                    <p className="text-xs font-bold text-aerojet-sky font-mono uppercase">{app.course?.code}</p>
                  </div>

                  <div className="mt-8 pt-4 border-t border-slate-50">
                    {app.status === 'APPROVED' ? (
                      app.course?.materialLink ? (
                        <a 
                          href={app.course.materialLink} 
                          target="_blank" 
                          rel="noopener noreferrer"  
                          className="block w-full py-3 rounded-xl bg-aerojet-blue text-white font-black text-center text-xs uppercase tracking-widest hover:bg-aerojet-sky transition-all shadow-md"
                        >
                          Access Course Materials ↗
                        </a>
                      ) : (
                        <button disabled className="w-full py-3 rounded-xl bg-slate-100 text-slate-400 font-bold text-xs uppercase cursor-not-allowed">Materials Not Yet Linked</button>
                      )
                    ) : (
                      <div className="space-y-3">
                        <Link 
                          href={`/portal/applications/${app.id}`}
                          className="block w-full py-3 rounded-xl bg-orange-500 text-white font-black text-center text-xs uppercase tracking-widest hover:bg-orange-600 transition-all shadow-md"
                        >
                          Complete Application Form &rarr;
                        </Link>
                        <p className="text-[10px] text-center text-slate-400 font-medium">
                          Note: Enrollment is confirmed after fee verification.
                        </p>
                      </div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      )}

      {/* --- TAB: BROWSE CATALOG --- */}
      {activeTab === 'browse' && (
        <div className="space-y-16">
          
          {/* Section: Full-Time Programs */}
          <section>
            <h2 className="text-xs font-black uppercase tracking-[0.2em] text-slate-400 mb-6 flex items-center">
              <span className="w-8 h-px bg-slate-200 mr-4"></span>
              A. Full-Time & Revision Programmes
            </h2>
            <div className="grid md:grid-cols-2 gap-8">
              {fullTimePrograms.map((course) => (
                <div key={course.id} className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 flex flex-col group hover:border-aerojet-sky transition-all">
                  <div className="grow">
                    <h3 className="text-xl font-black text-aerojet-blue mb-2 group-hover:text-aerojet-sky transition-colors">{course.title}</h3>
                    <p className="text-sm text-slate-500 leading-relaxed mb-6">{course.description}</p>
                    <div className="flex justify-between items-center text-xs font-black text-slate-400 uppercase tracking-widest mb-6 bg-slate-50 p-3 rounded-xl">
                        <span>⏱ {course.duration}</span>
                        <span className="text-aerojet-blue text-sm">€{course.price.toLocaleString()}</span>
                    </div>
                  </div>
                  <button onClick={() => handleApply(course.id)} disabled={!!applyingId} className="w-full py-4 rounded-xl border-2 border-aerojet-sky text-aerojet-sky font-black uppercase text-xs tracking-widest hover:bg-aerojet-sky hover:text-white transition-all disabled:opacity-50">
                    {applyingId === course.id ? 'Processing...' : 'Start Application'}
                  </button>
                </div>
              ))}
            </div>
          </section>

          {/* Section: Modular Exams */}
          <section>
            <h2 className="text-xs font-black uppercase tracking-[0.2em] text-slate-400 mb-6 flex items-center">
              <span className="w-8 h-px bg-slate-200 mr-4"></span>
              B. Modular Exam Seats (First Attempt)
            </h2>
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col">
                <div className="overflow-x-auto no-scrollbar">
                    <table className="w-full text-left text-sm text-slate-600 min-w-175">
                        <thead className="bg-slate-50 text-slate-400 font-black uppercase text-[10px] tracking-widest border-b border-slate-100">
                            <tr>
                                <th className="px-6 py-5 whitespace-nowrap">Code</th>
                                <th className="px-6 py-5 whitespace-nowrap">Module Title</th>
                                <th className="px-6 py-5 text-right whitespace-nowrap">Price</th>
                                <th className="px-6 py-5 text-center whitespace-nowrap">Action</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-slate-50">
                            {examModules.map((course) => (
                                <tr key={course.id} className="hover:bg-slate-50/50 transition">
                                    <td className="px-6 py-4 font-mono text-aerojet-sky whitespace-nowrap font-black">{course.code}</td>
                                    <td className="px-6 py-4 font-bold text-slate-800 whitespace-nowrap">{course.title}</td>
                                    <td className="px-6 py-4 text-right font-black text-slate-900 whitespace-nowrap">€{course.price}</td>
                                    <td className="px-6 py-4 text-center whitespace-nowrap">
                                        <button 
                                            onClick={() => handleApply(course.id)}
                                            disabled={!!applyingId}
                                            className="text-aerojet-sky hover:text-aerojet-blue font-black uppercase text-[10px] tracking-tighter border border-aerojet-sky px-5 py-2 rounded-lg disabled:opacity-50 transition-all hover:bg-blue-50 active:scale-95"
                                        >
                                            {applyingId === course.id ? '...' : 'Select Seat'}
                                        </button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
          </section>

        </div>
      )}
    </div>
  );
}

import { getServerSession } from "next-auth/next";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import { redirect } from "next/navigation";
import Link from "next/link";
import { PrismaClient } from "@prisma/client";
import ProtectedImage from "@/components/portal/ProtectedImage"; 

const prisma = new PrismaClient();

const EASA_MODULES = [
  "M01", "M02", "M03", "M04", "M05", "M06", "M07", "M08", 
  "M09", "M10", "M11", "M12", "M13", "M14", "M15", "M16", "M17"
];

export default async function DashboardPage() {
  const session = await getServerSession(authOptions);

  if (!session || !session.user) redirect('/portal/login');
  if (session.user.role !== 'STUDENT') redirect('/staff/dashboard');

  const student = await prisma.student.findUnique({
    where: { userId: session.user.id },
    include: {
      fees: true,
      applications: { include: { course: true }, orderBy: { appliedAt: 'desc' } },
      attendance: true,
      assessments: true,
      examBookings: {
        include: { run: { include: { course: true } } },
        where: { run: { startDatetime: { gt: new Date() } } },
        orderBy: { run: { startDatetime: 'asc' } },
        take: 3 
      },
    }
  });

  // --- LOGIC ---
  const passedModules = new Set(
    student?.assessments
      .filter(a => a.isPassed && a.type === "EASA_FINAL")
      .map(a => a.moduleCode)
  );

  const totalModules = 17;
  const progressPct = ((passedModules.size / totalModules) * 100).toFixed(0);
  const studentId = student?.studentId || "PENDING";
  
  const outstandingBalance = student?.fees
    .filter(f => f.status !== 'PAID' && f.status !== 'CLEARED')
    .reduce((acc, curr) => acc + curr.amount, 0) || 0;

  // FIX: Properly define appStatus
  const latestApp = student?.applications[0];
  const appStatus = latestApp?.status || "NOT STARTED";

  const isProfileComplete = !!(student?.phone && student?.address && student?.emergencyName);

  return (
    <div className="space-y-8 pb-20">
      
      {/* Welcome Header */}
      <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 flex flex-col md:flex-row justify-between items-center gap-6">
        <div className="flex items-center gap-6">
            <div className="w-20 h-20 rounded-full border-2 border-aerojet-sky shadow-md overflow-hidden shrink-0">
                <ProtectedImage src={student?.photoUrl} alt="ID" fallbackInitial={session.user.name?.[0]} />
            </div>
            <div>
                <h1 className="text-2xl md:text-3xl font-black text-aerojet-blue tracking-tight">Welcome, {session.user.name?.split(' ')[0]}!</h1>
                <p className="text-slate-500 font-mono text-sm">ID: <span className="text-aerojet-sky font-bold">{studentId}</span></p>
            </div>
        </div>
        <div className="bg-blue-50 px-6 py-3 rounded-2xl border border-blue-100 text-center md:text-right">
          <p className="text-[10px] text-aerojet-blue uppercase font-black tracking-widest mb-1">Current Intake</p>
          <p className="text-lg font-black text-aerojet-sky">{student?.cohort || "SEPT 2026"}</p>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div className="lg:col-span-2 space-y-8">
            {/* Progress Tracker */}
            <div className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                <div className="flex justify-between items-end mb-8">
                    <div>
                        <h3 className="font-black text-slate-900 uppercase text-xs tracking-widest mb-2">Certification Progress</h3>
                        <p className="text-4xl font-black text-aerojet-blue">{passedModules.size} <span className="text-lg text-slate-300">/ 17 Modules</span></p>
                    </div>
                    <div className="text-right">
                        <span className="text-2xl font-black text-aerojet-sky">{progressPct}%</span>
                    </div>
                </div>
                <div className="w-full h-4 bg-slate-100 rounded-full overflow-hidden mb-10">
                    <div className="h-full bg-aerojet-sky transition-all duration-1000" style={{ width: `${progressPct}%` }} />
                </div>
                <div className="grid grid-cols-6 sm:grid-cols-9 gap-3">
                    {EASA_MODULES.map(mod => (
                        <div key={mod} className={`aspect-square rounded-lg flex items-center justify-center text-[10px] font-black ${passedModules.has(mod) ? "bg-green-500 text-white shadow-md shadow-green-100" : "bg-slate-50 text-slate-300 border border-slate-100"}`}>
                            {mod.replace('M0', 'M').replace('M', '')}
                        </div>
                    ))}
                </div>
            </div>

            {/* Exam Sittings */}
            <div className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                <h3 className="font-black text-slate-900 uppercase text-xs tracking-widest mb-6">Upcoming Exam Sittings</h3>
                <div className="space-y-4">
                    {student?.examBookings.length === 0 ? (
                        <p className="text-sm text-slate-400 italic">No exams currently booked.</p>
                    ) : (
                        student?.examBookings.map(b => (
                            <div key={b.id} className="flex justify-between items-center p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                <div>
                                    <p className="font-black text-aerojet-blue text-sm uppercase">{b.run.course.code}</p>
                                    <p className="text-[10px] text-slate-500 font-bold uppercase">{b.run.course.title}</p>
                                </div>
                                <div className="text-right">
                                    <p className="text-xs font-black text-slate-700">{new Date(b.run.startDatetime).toLocaleDateString()}</p>
                                    <p className="text-[10px] text-aerojet-sky font-bold uppercase">Seat: {b.seatLabel || "TBA"}</p>
                                </div>
                            </div>
                        ))
                    )}
                </div>
            </div>
        </div>

        <div className="space-y-8">
            {/* Finance Card */}
            <div className={`p-8 rounded-[2.5rem] shadow-lg border-t-8 ${outstandingBalance > 0 ? 'bg-red-50 border-red-500' : 'bg-green-50 border-green-500'}`}>
                <h3 className="font-black text-slate-900 uppercase text-[10px] tracking-widest mb-4">Financial Overview</h3>
                <p className="text-3xl font-black ${outstandingBalance > 0 ? 'text-red-600' : 'text-green-600'}">
                    €{outstandingBalance.toFixed(2)}
                </p>
                <Link href="/portal/finance" className="mt-6 block text-center bg-white border border-slate-200 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-slate-900 hover:text-white transition-all shadow-sm">
                    View Ledger
                </Link>
            </div>

            {/* Application Status Card - RE-ADDED LOGIC */}
            <div className="bg-slate-900 text-white p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden">
                <div className="relative z-10">
                    <h3 className="font-black text-aerojet-sky uppercase text-[10px] tracking-widest mb-4">Application Status</h3>
                    <p className="text-2xl font-black uppercase tracking-tight">{appStatus}</p>
                    <p className="text-xs text-slate-400 mt-2 leading-relaxed">
                        {appStatus === 'PENDING' ? 'Your application is currently under review.' : 'Your record is active.'}
                    </p>
                </div>
            </div>

            {/* Action Required */}
            {!isProfileComplete && (
                <div className="bg-white rounded-2xl shadow-lg border-l-8 border-l-red-600 p-6 animate-pulse">
                    <h4 className="font-black text-slate-900 uppercase text-xs mb-2">Profile Incomplete</h4>
                    <Link href="/portal/profile" className="text-red-600 font-bold text-xs hover:underline">Complete Now &rarr;</Link>
                </div>
            )}
        </div>

      </div>
    </div>
  );
}
"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

type ExamRun = {
  id: string;
  course: { title: string; code: string };
  startDatetime: string;
  maxCapacity: number;
  bookings: any[];
  room: { name: string };
};

type MyBooking = {
  id: string;
  status: string;
  seatLabel: string | null;
  run: ExamRun;
};

export default function ExamsPage() {
  const [exams, setExams] = useState<ExamRun[]>([]);
  const [myBookings, setMyBookings] = useState<MyBooking[]>([]);
  const [loading, setLoading] = useState(true);
  const [bookingId, setBookingId] = useState<string | null>(null);

  async function fetchData() {
    try {
      // 1. Fetch available exams
      const resExams = await fetch('/api/portal/exams');
      const dataExams = await resExams.json();
      setExams(dataExams.examRuns || []);

      // 2. Fetch MY bookings
      const resMy = await fetch('/api/portal/exams/my-bookings');
      const dataMy = await resMy.json();
      setMyBookings(dataMy.bookings || []);

    } catch (error) {
      toast.error("Failed to load data.");
    } finally {
      setLoading(false);
    }
  }

  useEffect(() => {
    fetchData();
  }, []);

  const handleBook = async (runId: string) => {
    setBookingId(runId);
    try {
      const res = await fetch('/api/portal/exams', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ runId }),
      });
      
      if (res.ok) {
        toast.success("Exam seat booked successfully!");
        fetchData();
      } else {
        const err = await res.json();
        toast.error(err.error || "Booking failed.");
      }
    } catch (error) {
      toast.error("An error occurred.");
    } finally {
      setBookingId(null);
    }
  };

  // Helper to check if I already booked a run
  const isBooked = (runId: string) => myBookings.some(b => b.run.id === runId);

  if (loading) return <div className="p-8 text-center text-gray-500">Loading Exam Schedule...</div>;

  return (
    <div className="max-w-6xl mx-auto space-y-12">
      
      {/* SECTION 1: MY SCHEDULED EXAMS */}
      {myBookings.length > 0 && (
        <div className="space-y-4">
            <h2 className="text-xl font-bold text-aerojet-blue border-b border-gray-200 pb-2">My Confirmed Schedule</h2>
            <div className="grid md:grid-cols-2 gap-4">
                {myBookings.map(booking => (
                    <div key={booking.id} className="bg-white p-5 rounded-lg shadow-sm border-l-4 border-l-green-500 border border-gray-200">
                        <div className="flex justify-between items-start">
                            <div>
                                <h3 className="font-bold text-lg text-aerojet-blue">{booking.run.course.code}</h3>
                                <p className="text-sm text-gray-600">{booking.run.course.title}</p>
                            </div>
                            <div className="text-right">
                                <span className="block text-2xl font-bold text-aerojet-blue">
                                    {booking.seatLabel || "--"}
                                </span>
                                <span className="text-xs uppercase font-bold text-gray-400">Seat No.</span>
                            </div>
                        </div>
                        <div className="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center text-sm">
                            <div className="flex items-center text-gray-700">
                                <span className="mr-2">📅</span>
                                {new Date(booking.run.startDatetime).toLocaleString()}
                            </div>
                            <div className="flex items-center text-gray-700">
                                <span className="mr-2">📍</span>
                                {booking.run.room.name}
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </div>
      )}

      {/* SECTION 2: BOOK NEW EXAM */}
      <div>
        <div className="mb-6">
            <h1 className="text-3xl font-bold text-aerojet-blue">Book Exams</h1>
            <p className="text-gray-600 mt-1">Reserve your seat for upcoming sessions.</p>
        </div>

        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col">
            <div className="overflow-x-auto no-scrollbar">
                <table className="w-full text-left text-sm text-gray-600 min-w-150">
                    <thead className="bg-gray-50 text-gray-800 font-bold uppercase text-xs border-b border-gray-200">
                        <tr>
                            <th className="px-6 py-4 whitespace-nowrap">Module</th>
                            <th className="px-6 py-4 whitespace-nowrap">Date & Time</th>
                            <th className="px-6 py-4 whitespace-nowrap">Venue</th>
                            <th className="px-6 py-4 whitespace-nowrap">Availability</th>
                            <th className="px-6 py-4 text-center whitespace-nowrap">Action</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {exams.map((exam) => {
                            const seatsLeft = exam.maxCapacity - exam.bookings.length;
                            const alreadyBooked = isBooked(exam.id);
                            const isClickable = !alreadyBooked && seatsLeft > 0 && !bookingId;

                            return (
                                <tr key={exam.id} className="hover:bg-gray-50 transition">
                                    <td className="px-6 py-4 whitespace-nowrap">
                                        <p className="font-bold text-aerojet-blue">{exam.course.code}</p>
                                        <p className="text-xs text-gray-500">{exam.course.title}</p>
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap">
                                        <p className="font-medium text-gray-800">{new Date(exam.startDatetime).toLocaleDateString()}</p>
                                        <p className="text-xs text-gray-500">{new Date(exam.startDatetime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-gray-500">
                                        {exam.room.name}
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap">
                                        <span className={`px-2 py-1 rounded text-xs font-bold ${seatsLeft > 5 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                            {seatsLeft} Seats Left
                                        </span>
                                    </td>
                                    <td className="px-6 py-4 text-center whitespace-nowrap">
                                        {alreadyBooked ? (
                                            <span className="text-xs font-bold text-green-600 bg-green-50 px-3 py-1 rounded border border-green-200">
                                                Booked
                                            </span>
                                        ) : (
                                            <button 
                                                onClick={() => handleBook(exam.id)}
                                                disabled={!isClickable}
                                                className={`px-4 py-2 rounded-md font-bold text-xs transition ${
                                                    !isClickable
                                                    ? "bg-gray-300 text-gray-500 cursor-not-allowed" 
                                                    : "bg-aerojet-sky text-white hover:bg-aerojet-soft-blue"
                                                }`}
                                            >
                                                {seatsLeft === 0 ? 'Full' : (bookingId === exam.id ? 'Booking...' : 'Book Seat')}
                                            </button>
                                        )}
                                    </td>
                                </tr>
                            );
                        })}
                    </tbody>
                </table>
            </div>
        </div>
      </div>
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import { UploadButton } from "@/app/utils/uploadthing";

type Fee = {
  id: string;
  amount: number; 
  paid: number;
  status: string;
  description: string;
  dueDate: string;
};

const Icons = {
  Ledger: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>,
  Wallet: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>,
};

export default function FinancePage() {
  const [fees, setFees] = useState<Fee[]>([]);
  const [balance, setBalance] = useState(0);
  const [loading, setLoading] = useState(true);
  const [selectedFee, setSelectedFee] = useState<Fee | null>(null);

  const [isEuro, setIsEuro] = useState(true);
  const [exchangeRate, setExchangeRate] = useState(13.09);
  const [rateLoading, setRateLoading] = useState(false);

  // Inside FinancePage
useEffect(() => {
    async function fetchRate() {
      setRateLoading(true);
      
      const primaryUrl = `https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/eur.json`;
      const fallbackUrl = `https://latest.currency-api.pages.dev/v1/currencies/eur.json`;

      try {
        // Try Primary
        const res = await fetch(primaryUrl);
        if (!res.ok) throw new Error("Primary failed");
        const data = await res.json();
        if (data.eur && data.eur.ghs) {
            setExchangeRate(data.eur.ghs);
            return; // Success, exit
        }
        throw new Error("Primary data invalid");
      } catch (primaryError) {
        console.warn("Primary currency API failed, trying fallback...", primaryError);
        
        try {
            // Try Fallback
            const resBackup = await fetch(fallbackUrl);
            const dataBackup = await resBackup.json();
            if (dataBackup.eur && dataBackup.eur.ghs) {
                setExchangeRate(dataBackup.eur.ghs);
            } else {
                setExchangeRate(17.50); // Hard fallback
            }
        } catch (backupError) {
            console.error("All currency APIs failed.", backupError);
            setExchangeRate(17.50); // Hard fallback
        }
      } finally {
        setRateLoading(false);
      }
    }
    fetchRate();
  }, []);


  const formatCurrency = (amount: number) => {
    if (isEuro) {
      return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(amount);
    } else {
      return new Intl.NumberFormat('en-GH', { style: 'currency', currency: 'GHS' }).format(amount * exchangeRate);
    }
  };

  async function fetchLedger() {
    try {
      const res = await fetch('/api/portal/finance');
      const data = await res.json();
      setFees(data.fees || []);
      setBalance(data.balance || 0);
    } catch (error) {
      toast.error("Failed to load finance data.");
    } finally {
      setLoading(false);
    }
  }

  useEffect(() => { fetchLedger(); }, []);

  const handleUploadComplete = async (res: any[]) => {
    if (!selectedFee || !res?.[0]?.url) return;
    try {
        const fileUrl = res[0].url;
        const apiRes = await fetch('/api/portal/finance/upload', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ feeId: selectedFee.id, proofUrl: fileUrl }),
        });

        if (apiRes.ok) {
            toast.success("Proof uploaded successfully!");
            setSelectedFee(null);
            fetchLedger();
        } else {
            toast.error("Failed to link proof.");
        }
    } catch (error) {
        toast.error("An error occurred.");
    }
  };

  if (loading) return <div className="p-8 text-center text-gray-500">Loading Ledger...</div>;

  return (
    <div className="max-w-6xl mx-auto space-y-8">
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div className="flex items-center gap-4">
          <div className="p-3 bg-aerojet-sky/10 text-aerojet-sky rounded-xl">
            <Icons.Ledger />
          </div>
          <div>
            <h1 className="text-3xl font-bold text-aerojet-blue">Finance & Ledger</h1>
            <p className="text-gray-600 text-sm">
                {rateLoading ? 'Syncing live rates...' : `Live Rate: 1 EUR = ${exchangeRate.toFixed(2)} GHS`}
            </p>
          </div>
        </div>

        <div 
          onClick={() => setIsEuro(!isEuro)}
          className="cursor-pointer bg-white p-4 rounded-xl border border-gray-200 shadow-sm text-right hover:border-aerojet-sky transition-all group min-w-50"
        >
            <p className="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1 group-hover:text-aerojet-sky">Outstanding Balance ({isEuro ? 'EUR' : 'GHS'})</p>
            <p className={`text-2xl font-bold ${balance > 0 ? 'text-red-600' : 'text-green-600'}`}>
                {formatCurrency(balance)}
            </p>
        </div>
      </div>

      <div className="grid md:grid-cols-2 gap-6 mb-8">
    <div className="bg-aerojet-blue text-white p-6 rounded-2xl shadow-lg border border-white/10 relative overflow-hidden">
        <h3 className="text-xs font-black uppercase tracking-widest text-aerojet-sky mb-4">Official Banking Details</h3>
        <div className="space-y-2 font-mono text-sm">
            <p><span className="opacity-50">BANK:</span> FNB BANK</p>
            <p><span className="opacity-50">NAME:</span> AEROJET FOUNDATION</p>
            <p><span className="opacity-50">ACCT:</span> 1020003980687</p>
            <p><span className="opacity-50">SWIFT:</span> FIRNGHACXXX</p>
        </div>
        <div className="absolute -right-4 -bottom-4 opacity-10">
            <svg className="w-24 h-24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L1 21h22L12 2zm0 3.45l8.27 14.3H3.73L12 5.45zM11 10v4h2v-4h-2zm0 6v2h2v-2h-2z"/></svg>
        </div>
    </div>

    <div className="bg-white p-6 rounded-2xl border border-slate-200 flex flex-col justify-center">
        <h3 className="font-bold text-slate-800 text-sm mb-2">How to Pay</h3>
        <p className="text-xs text-slate-500 leading-relaxed">
            1. Transfer funds using the bank details provided.<br/>
            2. Use your <b>Full Name</b> or <b>Student ID</b> as the reference.<br/>
            3. Upload a clear photo or PDF of your receipt using the "Upload Proof" button in the table below.
        </p>
    </div>
</div>

      <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col">
        <div className="overflow-x-auto no-scrollbar lg:no-scrollbar">
          <table className="w-full text-left text-sm text-gray-600 min-w-200">
            <thead className="bg-slate-50 text-slate-800 font-bold uppercase text-[10px] tracking-wider border-b border-gray-200">
                <tr>
                    <th className="px-6 py-4">Description</th>
                    <th className="px-6 py-4">Due Date</th>
                    <th className="px-6 py-4 text-right">Amount</th>
                    <th className="px-6 py-4 text-right">Paid</th>
                    <th className="px-6 py-4 text-center">Status</th>
                    <th className="px-6 py-4 text-center">Action</th>
                </tr>
            </thead>
            <tbody className="divide-y divide-gray-100">
                {fees.map((fee) => (
                    <tr key={fee.id} className="hover:bg-slate-50/50 transition">
                        <td className="px-6 py-4 font-semibold text-slate-800">{fee.description}</td>
                        <td className="px-6 py-4 text-slate-500">{new Date(fee.dueDate).toLocaleDateString()}</td>
                        <td className="px-6 py-4 text-right font-mono font-bold text-slate-700 cursor-pointer" onClick={() => setIsEuro(!isEuro)}>
                            {formatCurrency(fee.amount)}
                        </td>
                        <td className="px-6 py-4 text-right font-mono text-green-600">
                            {fee.paid > 0 ? formatCurrency(fee.paid) : '—'}
                        </td>
                        <td className="px-6 py-4 text-center">
                            <span className={`px-2.5 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter ${
                                fee.status === 'PAID' ? 'bg-green-100 text-green-700' : 
                                fee.status === 'VERIFYING' ? 'bg-blue-100 text-blue-700' : 
                                'bg-red-50 text-red-600'
                            }`}>
                                {fee.status}
                            </span>
                        </td>
                        <td className="px-6 py-4 text-center">
                            {fee.status === 'UNPAID' && (
                                <button onClick={() => setSelectedFee(fee)} className="bg-white text-aerojet-sky hover:bg-aerojet-sky hover:text-white font-bold text-[10px] border border-aerojet-sky px-4 py-1.5 rounded-lg transition-all">
                                    Upload Proof
                                </button>
                            )}
                        </td>
                    </tr>
                ))}
            </tbody>
          </table>
        </div>
      </div>

      <div className="p-4 bg-gray-50 border border-gray-200 rounded-lg flex items-center justify-between">
          <p className="text-[10px] text-gray-500 uppercase tracking-widest font-bold">
            Real-time Rates powered by FreeCurrencyAPI
          </p>
          <button onClick={() => setIsEuro(!isEuro)} className="text-[10px] font-bold text-aerojet-sky hover:underline uppercase">
            Switch to {isEuro ? 'Ghana Cedis' : 'Euros'}
          </button>
      </div>

      {selectedFee && (
        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full animate-in fade-in zoom-in duration-200">
                <div className="flex items-center gap-3 mb-4">
                    <div className="p-2 bg-aerojet-sky text-white rounded-lg"><Icons.Wallet /></div>
                    <h2 className="text-xl font-bold text-aerojet-blue">Submit Payment Proof</h2>
                </div>
                <p className="text-sm text-gray-500 mb-6 leading-relaxed">
                    Please upload your bank transfer receipt for: <br/>
                    <span className="font-bold text-slate-800">{selectedFee.description}</span>
                </p>
                <div className="border-2 border-dashed border-gray-200 rounded-xl p-8 bg-gray-50 text-center">
                    <UploadButton
                        endpoint="paymentProof"
                        onClientUploadComplete={(res) => handleUploadComplete(res)}
                        // FIX IS HERE: Wrapped in braces
                        onUploadError={(error: Error) => {
                            toast.error(`Error: ${error.message}`);
                        }}
                        appearance={{
                            button: "bg-aerojet-sky text-white px-6 py-2 rounded-lg font-bold text-sm hover:bg-aerojet-navy transition-all shadow-md",
                            allowedContent: "text-[10px] text-gray-400 mt-2"
                        }}
                    />
                </div>
                <div className="mt-6">
                    <button onClick={() => setSelectedFee(null)} className="w-full py-3 text-gray-500 hover:text-slate-800 font-bold text-sm transition-colors">
                        Cancel and Go Back
                    </button>
                </div>
            </div>
        </div>
      )}
    </div>
  );
}
"use client";
import { useSession } from "next-auth/react";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function ProfilePage() {
  const { data: session, status } = useSession();
  const [activeTab, setActiveTab] = useState<'profile' | 'security'>('profile');
  const [loading, setLoading] = useState(true);
  const [isSaving, setIsSaving] = useState(false);

  // Profile Form State
  const [formData, setFormData] = useState({
    phone: '', 
    dob: '', 
    gender: '', // Added for Admin Demographics
    address: '', 
    city: '', 
    region: '',
    emergencyName: '', 
    emergencyRelation: '', 
    emergencyPhone: ''
  });

  // Password Form State
  const [passwordForm, setPasswordForm] = useState({ newPassword: '', confirmPassword: '' });

  // High-contrast input styling
  const inputClasses = "mt-1 block w-full px-4 py-2 border border-slate-300 rounded-lg bg-white text-slate-900 shadow-sm focus:outline-none focus:border-aerojet-sky focus:ring-1 focus:ring-aerojet-sky transition-all placeholder:text-slate-400";

  useEffect(() => {
    async function fetchProfile() {
      if (status !== 'authenticated') return;
      try {
        const res = await fetch('/api/portal/profile');
        if (!res.ok) throw new Error('Failed to fetch profile');
        const data = await res.json();
        if (data.student) {
          setFormData({
            phone: data.student.phone || '',
            dob: data.student.dob ? new Date(data.student.dob).toISOString().split('T')[0] : '',
            gender: data.student.gender || '',
            address: data.student.address || '',
            city: data.student.city || '',
            region: data.student.region || '',
            emergencyName: data.student.emergencyName || '',
            emergencyRelation: data.student.emergencyRelation || '',
            emergencyPhone: data.student.emergencyPhone || ''
          });
        }
      } catch (error) {
        console.error("Failed to load profile", error);
        toast.error("Could not load your profile data.");
      } finally {
        setLoading(false);
      }
    }
    fetchProfile();
  }, [status]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleProfileSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSaving(true);
    
    const promise = fetch('/api/portal/profile', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData),
    }).then(async (res) => {
      if (!res.ok) throw new Error('Failed to save.');
      return res.json();
    });

    toast.promise(promise, {
      loading: 'Saving profile...',
      success: 'Profile updated successfully!',
      error: 'An error occurred while saving.',
    });
    setIsSaving(false);
  };

  const handlePasswordSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (passwordForm.newPassword !== passwordForm.confirmPassword) {
        toast.error("Passwords do not match.");
        return;
    }
    if (passwordForm.newPassword.length < 6) {
        toast.error("Password must be at least 6 characters.");
        return;
    }

    setIsSaving(true);
    const promise = fetch('/api/user/password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ newPassword: passwordForm.newPassword })
    }).then(async (res) => {
        if (!res.ok) throw new Error('Failed');
        return res.json();
    });

    toast.promise(promise, {
        loading: 'Updating password...',
        success: 'Password updated successfully!',
        error: 'Failed to update password.',
    });
    
    setPasswordForm({ newPassword: '', confirmPassword: '' });
    setIsSaving(false);
  };

  if (status === 'loading' || loading) return <div className="p-8 text-center text-slate-500 animate-pulse">Loading Account Settings...</div>;
  if (status === 'unauthenticated') return <div className="p-8 text-center text-red-500 font-bold">Access Denied.</div>;

  return (
    <div className="max-w-5xl mx-auto pb-20">
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <div>
            <h1 className="text-3xl font-extrabold text-aerojet-blue uppercase tracking-tight">Account Settings</h1>
            <p className="text-slate-500 mt-1">Manage your personal details and login security.</p>
        </div>
        
        <div className="bg-white p-1 rounded-xl border border-slate-200 flex shadow-sm">
          <button onClick={() => setActiveTab('profile')} className={`px-6 py-2 rounded-lg text-xs font-black uppercase tracking-widest transition-all ${activeTab === 'profile' ? "bg-aerojet-sky text-white shadow-md" : "text-slate-400 hover:text-aerojet-blue"}`}>
            Profile
          </button>
          <button onClick={() => setActiveTab('security')} className={`px-6 py-2 rounded-lg text-xs font-black uppercase tracking-widest transition-all ${activeTab === 'security' ? "bg-aerojet-sky text-white shadow-md" : "text-slate-400 hover:text-aerojet-blue"}`}>
            Security
          </button>
        </div>
      </div>
      
      {activeTab === 'profile' && (
        <form onSubmit={handleProfileSubmit} className="space-y-10">
            
            {/* --- Personal Details --- */}
            <section className="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
                <header className="flex items-center gap-4 bg-slate-50 p-4 border-b border-slate-200">
                    <div className="w-8 h-8 flex items-center justify-center bg-aerojet-sky text-white rounded-lg shadow-sm text-sm">👤</div>
                    <h2 className="text-lg font-bold text-aerojet-blue uppercase tracking-tight">Personal Information</h2>
                </header>
                <div className="p-6 bg-slate-50/30 grid md:grid-cols-2 gap-x-8 gap-y-6">
                    <div className="md:col-span-2 grid md:grid-cols-2 gap-6">
                        <div>
                            <label className="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Full Name</label>
                            <input type="text" disabled value={session?.user?.name || ''} className="w-full px-4 py-2 border border-slate-200 rounded-lg bg-slate-100 text-slate-500 cursor-not-allowed font-bold" />
                        </div>
                        <div>
                            <label className="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Email Address</label>
                            <input type="email" disabled value={session?.user?.email || ''} className="w-full px-4 py-2 border border-slate-200 rounded-lg bg-slate-100 text-slate-500 cursor-not-allowed font-bold" />
                        </div>
                    </div>
                    <div>
                        <label htmlFor="dob" className="block text-[10px] font-black text-slate-700 uppercase tracking-widest mb-1">Date of Birth</label>
                        <input id="dob" type="date" name="dob" value={formData.dob} onChange={handleChange} className={inputClasses} />
                    </div>
                    <div>
                        <label htmlFor="gender" className="block text-[10px] font-black text-slate-700 uppercase tracking-widest mb-1">Gender</label>
                        <select id="gender" name="gender" value={formData.gender} onChange={handleChange} className={inputClasses}>
                            <option value="">Select Gender...</option>
                            <option value="MALE">Male</option>
                            <option value="FEMALE">Female</option>
                        </select>
                    </div>
                    <div className="md:col-span-2">
                        <label htmlFor="phone" className="block text-[10px] font-black text-slate-700 uppercase tracking-widest mb-1">Phone Number (WhatsApp)</label>
                        <input id="phone" type="tel" name="phone" value={formData.phone} onChange={handleChange} className={inputClasses} placeholder="+233 XX XXX XXXX" />
                    </div>
                </div>
            </section>

            {/* --- Address --- */}
            <section className="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
                <header className="flex items-center gap-4 bg-slate-50 p-4 border-b border-slate-200">
                    <div className="w-8 h-8 flex items-center justify-center bg-aerojet-sky text-white rounded-lg shadow-sm text-sm">📍</div>
                    <h2 className="text-lg font-bold text-aerojet-blue uppercase tracking-tight">Residential Address</h2>
                </header>
                <div className="p-6 bg-slate-50/30 space-y-6">
                    <div>
                        <label htmlFor="address" className="block text-[10px] font-black text-slate-700 uppercase tracking-widest mb-1">Street Address / House No.</label>
                        <textarea id="address" name="address" rows={2} value={formData.address} onChange={handleChange} className={inputClasses} placeholder="Enter your full street address..."></textarea>
                    </div>
                    <div className="grid md:grid-cols-2 gap-x-8 gap-y-6">
                        <div>
                            <label htmlFor="city" className="block text-[10px] font-black text-slate-700 uppercase tracking-widest mb-1">City / Town</label>
                            <input id="city" type="text" name="city" value={formData.city} onChange={handleChange} className={inputClasses} />
                        </div>
                        <div>
                            <label htmlFor="region" className="block text-[10px] font-black text-slate-700 uppercase tracking-widest mb-1">Region / State</label>
                            <input id="region" type="text" name="region" value={formData.region} onChange={handleChange} className={inputClasses} />
                        </div>
                    </div>
                </div>
            </section>

            {/* --- Emergency --- */}
            <section className="bg-white rounded-xl shadow-md border border-red-200 overflow-hidden">
                <header className="flex items-center gap-4 bg-red-50 p-4 border-b border-red-100">
                    <div className="w-8 h-8 flex items-center justify-center bg-red-600 text-white rounded-lg shadow-sm text-sm">📞</div>
                    <h2 className="text-lg font-bold text-red-800 uppercase tracking-tight">Emergency Contact</h2>
                </header>
                <div className="p-6 bg-red-50/10 grid md:grid-cols-2 gap-x-8 gap-y-6">
                    <div>
                        <label htmlFor="emergencyName" className="block text-[10px] font-black text-red-900 uppercase tracking-widest mb-1">Contact's Full Name</label>
                        <input id="emergencyName" type="text" name="emergencyName" value={formData.emergencyName} onChange={handleChange} className={`${inputClasses} border-red-200 focus:border-red-500 focus:ring-red-500`} />
                    </div>
                    <div>
                        <label htmlFor="emergencyRelation" className="block text-[10px] font-black text-red-900 uppercase tracking-widest mb-1">Relationship</label>
                        <input id="emergencyRelation" type="text" name="emergencyRelation" value={formData.emergencyRelation} onChange={handleChange} className={`${inputClasses} border-red-200 focus:border-red-500 focus:ring-red-500`} placeholder="e.g., Parent, Sibling, Spouse" />
                    </div>
                    <div className="md:col-span-2">
                        <label htmlFor="emergencyPhone" className="block text-[10px] font-black text-red-900 uppercase tracking-widest mb-1">Emergency Phone Number</label>
                        <input id="emergencyPhone" type="tel" name="emergencyPhone" value={formData.emergencyPhone} onChange={handleChange} className={`${inputClasses} border-red-200 focus:border-red-500 focus:ring-red-500`} />
                    </div>
                </div>
            </section>

            <div className="pt-6 flex justify-end">
                <button type="submit" disabled={isSaving} className="bg-aerojet-sky text-white px-12 py-4 rounded-xl font-black uppercase tracking-[0.2em] text-sm hover:bg-aerojet-blue transition-all shadow-lg active:scale-95 disabled:opacity-50">
                    {isSaving ? 'Processing...' : 'Update My Profile'}
                </button>
            </div>
        </form>
      )}

      {activeTab === 'security' && (
        <div className="max-w-2xl mx-auto py-10">
            <section className="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
                <header className="flex items-center gap-4 bg-slate-50 p-4 border-b border-slate-200">
                    <div className="w-8 h-8 flex items-center justify-center bg-slate-800 text-white rounded-lg shadow-sm text-sm">🔒</div>
                    <div>
                        <h2 className="text-lg font-bold text-aerojet-blue uppercase tracking-tight">Security Credentials</h2>
                        <p className="text-xs text-slate-500 font-medium">Set a password to enable email/password login.</p>
                    </div>
                </header>
                <form onSubmit={handlePasswordSubmit} className="p-8 space-y-6">
                    <div>
                        <label className="block text-[10px] font-black text-slate-700 uppercase tracking-widest mb-1">New Password</label>
                        <input type="password" required className={inputClasses} value={passwordForm.newPassword} onChange={e => setPasswordForm({...passwordForm, newPassword: e.target.value})} />
                    </div>
                    <div>
                        <label className="block text-[10px] font-black text-slate-700 uppercase tracking-widest mb-1">Confirm Password</label>
                        <input type="password" required className={inputClasses} value={passwordForm.confirmPassword} onChange={e => setPasswordForm({...passwordForm, confirmPassword: e.target.value})} />
                    </div>
                    <button type="submit" disabled={isSaving} className="w-full bg-slate-900 text-white py-4 rounded-xl font-black uppercase tracking-widest text-xs shadow-lg hover:bg-black transition-all active:scale-95">
                        {isSaving ? 'Updating...' : 'Set My Password'}
                    </button>
                </form>
            </section>
        </div>
      )}
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function StudentResultsPage() {
  const [results, setResults] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function fetchResults() {
      try {
        const res = await fetch('/api/portal/results');
        const data = await res.json();
        setResults(data.results || []);
      } catch (error) {
        toast.error("Failed to load results");
      } finally {
        setLoading(false);
      }
    }
    fetchResults();
  }, []);

  if (loading) return <div className="p-8 text-center text-gray-500">Loading Results...</div>;

  return (
    <div className="max-w-5xl mx-auto">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-aerojet-blue">Academic Transcript</h1>
        <p className="text-gray-600 mt-1">Your official examination results and assessments.</p>
      </div>

            <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col">
        {/* Added overflow-x-auto and no-scrollbar here */}
        <div className="overflow-x-auto no-scrollbar">
          <table className="w-full text-left text-sm text-gray-600 min-w-175">
              <thead className="bg-slate-50 text-slate-800 font-bold uppercase text-[10px] tracking-wider border-b border-gray-200">
                  <tr>
                      <th className="px-6 py-4 whitespace-nowrap">Date</th>
                      <th className="px-6 py-4 whitespace-nowrap">Module / Exam</th>
                      <th className="px-6 py-4 whitespace-nowrap">Type</th>
                      <th className="px-6 py-4 text-center whitespace-nowrap">Score</th>
                      <th className="px-6 py-4 text-center whitespace-nowrap">Grade</th>
                  </tr>
              </thead>
              <tbody className="divide-y divide-gray-100">
                  {results.length === 0 ? (
                      <tr>
                          <td colSpan={5} className="px-6 py-8 text-center text-gray-400 italic">No results published yet.</td>
                      </tr>
                  ) : (
                      results.map((res) => (
                          <tr key={res.id} className="hover:bg-gray-50 transition">
                              <td className="px-6 py-4 font-mono whitespace-nowrap">
                                  {new Date(res.recordedAt).toLocaleDateString()}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                  <p className="font-bold text-aerojet-blue">
                                      {res.run?.course.code || "Internal Assessment"}
                                  </p>
                                  <p className="text-[10px] text-gray-500">
                                      {res.run?.course.title || "-"}
                                  </p>
                              </td>
                              <td className="px-6 py-4 text-[10px] font-black text-gray-500 uppercase whitespace-nowrap">
                                  {res.type.replace('_', ' ')}
                              </td>
                              <td className="px-6 py-4 text-center font-mono text-lg font-bold text-slate-700 whitespace-nowrap">
                                  {res.score}%
                              </td>
                              <td className="px-6 py-4 text-center whitespace-nowrap">
                                  <span className={`px-3 py-1 rounded-full text-[10px] font-black ${
                                      res.isPassed ? 'bg-green-100 text-green-700' : 'bg-red-50 text-red-600'
                                  }`}>
                                      {res.isPassed ? 'PASS' : 'FAIL'}
                                  </span>
                              </td>
                          </tr>
                      ))
                  )}
              </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}
"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function WalletPage() {
  const [balance, setBalance] = useState(0);
  const [loading, setLoading] = useState(false);

  // In a real app, fetch balance from API. For now, we assume 0 or handle it via local state updates after purchase.

  const handleBuy = async (type: string) => {
    setLoading(true);
    const res = await fetch('/api/portal/wallet/purchase', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ bundleType: type })
    });
    if (res.ok) {
        toast.success("Invoice created! Go to Finance to pay.");
    } else {
        toast.error("Failed to create invoice.");
    }
    setLoading(false);
  };

  return (
    <div className="max-w-4xl mx-auto space-y-8">
        <h1 className="text-3xl font-bold text-aerojet-blue">Exam Wallet</h1>
        
        <div className="bg-aerojet-blue text-white p-8 rounded-xl shadow-lg flex justify-between items-center">
            <div>
                <p className="text-sm opacity-80 uppercase tracking-wider">Available Credits</p>
                <h2 className="text-5xl font-bold mt-2">{balance}</h2>
            </div>
            <div className="text-right">
                <p className="text-sm opacity-80">Use credits to book exams instantly.</p>
            </div>
        </div>

        <h2 className="text-xl font-bold text-slate-700">Purchase Credits</h2>
        <div className="grid md:grid-cols-2 gap-6">
            <div className="bg-white p-6 rounded-xl border border-gray-200 hover:border-aerojet-sky transition cursor-pointer" onClick={() => handleBuy('BUNDLE_2')}>
                <h3 className="font-bold text-lg text-aerojet-blue">2-Exam Bundle</h3>
                <p className="text-gray-500 mt-2">Save on individual bookings.</p>
                <div className="mt-4 flex justify-between items-center">
                    <span className="text-2xl font-bold text-slate-800">€980</span>
                    <button className="bg-aerojet-sky text-white px-4 py-2 rounded font-bold text-sm">Buy Now</button>
                </div>
            </div>
            <div className="bg-white p-6 rounded-xl border border-gray-200 hover:border-aerojet-sky transition cursor-pointer" onClick={() => handleBuy('BUNDLE_4')}>
                <h3 className="font-bold text-lg text-aerojet-blue">4-Exam Bundle</h3>
                <p className="text-gray-500 mt-2">Best value. Includes free resit.</p>
                <div className="mt-4 flex justify-between items-center">
                    <span className="text-2xl font-bold text-slate-800">€1,900</span>
                    <button className="bg-aerojet-sky text-white px-4 py-2 rounded font-bold text-sm">Buy Now</button>
                </div>
            </div>
        </div>
    </div>
  );
}

"use client";
import { useSession } from "next-auth/react";
import { redirect, useRouter } from "next/navigation";
import { useState, useEffect } from "react";
import PortalSidebar from "@/components/portal/PortalSidebar";
import PortalHeader from "@/components/portal/PortalHeader";

export default function PortalLayout({ children }: { children: React.ReactNode; }) {
  const router = useRouter();
  const { data: session, status } = useSession({
    required: true,
    onUnauthenticated() {
      redirect('/portal/login');
    },
  });

  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
  const [mobileSidebarOpen, setMobileSidebarOpen] = useState(false);

  // --- Role & Activation Redirect Logic ---
  useEffect(() => {
    if (status === 'authenticated' && session?.user) {
      const user = session.user as any;
      
      // 1. If user is ADMIN/STAFF/INSTRUCTOR, redirect to staff portal
      if (['ADMIN', 'STAFF', 'INSTRUCTOR'].includes(user.role)) {
        router.replace('/staff/dashboard');
        return;
      }
      
      // 2. If user is a STUDENT but not yet active, redirect to pending page
      if (user.role === 'STUDENT' && !user.isActive) {
        router.replace('/portal/pending');
        return;
      }
    }
  }, [status, session, router]);

  // Loading state should check for all redirect conditions to prevent content flashes
  const user = (session?.user as any);
  if (
    status === "loading" ||
    (user && ['ADMIN', 'STAFF', 'INSTRUCTOR'].includes(user.role)) ||
    (user && user.role === 'STUDENT' && !user.isActive)
  ) {
    return <div className="flex h-screen items-center justify-center text-aerojet-blue animate-pulse">Loading Portal...</div>;
  }

  // Final safety check
  if (!session || !session.user) {
    return null;
  }

  return (
    <div className="flex h-screen bg-gray-100">
      <div 
        className={`hidden lg:block h-full z-30 shrink-0 transition-all duration-300 ease-in-out ${
          sidebarCollapsed ? 'w-20' : 'w-64'
        }`}
      >
        <PortalSidebar 
          user={session.user} 
          collapsed={sidebarCollapsed} 
          setCollapsed={setSidebarCollapsed} 
        />
      </div>

      <div className="flex-1 flex flex-col overflow-hidden">
        <div className="lg:hidden">
            <PortalHeader onMenuClick={() => setMobileSidebarOpen(true)} />
        </div>
        
        <main className="flex-1 overflow-y-auto p-4 sm:p-6 md:p-8">
          {children}
        </main>
      </div>

      {mobileSidebarOpen && (
        <div className="lg:hidden fixed inset-0 z-50 flex">
          <div className="fixed inset-0 bg-black/50 transition-opacity" onClick={() => setMobileSidebarOpen(false)}></div>
          <div className="relative w-64 h-full shadow-2xl">
            <PortalSidebar 
                user={session.user} 
                collapsed={false} 
            />
          </div>
        </div>
      )}
    </div>
  );
}

import { getServerSession } from "next-auth/next";
import { redirect } from "next/navigation";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import LoginForm from "@/components/portal/LoginForm"; // We will move the form to a client component

export default async function StudentLoginPage() {
  const session = await getServerSession(authOptions);

  // If the user is already logged in, redirect them to the dashboard
  if (session) {
    redirect('/portal/dashboard');
  }

  // If not logged in, render the login form component
  return (
    <LoginForm />
  );
}
"use client";
import { useSession } from "next-auth/react";
import { toast } from "sonner";
import { UploadButton } from "@/app/utils/uploadthing";

export default function PendingPage() {
  const { data: session } = useSession();

  const handleUploadComplete = async (res: any[]) => {
    // Just need to alert the admin, no DB link needed yet for this fee
    toast.success("Proof uploaded! Admin will review and activate your account within 24 hours.");
  };

  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
      <div className="max-w-xl mx-auto text-center">
        <div className="bg-white p-10 rounded-2xl shadow-lg border border-gray-200">
          <h1 className="text-3xl font-bold text-aerojet-blue">Account Activation Pending</h1>
          <p className="mt-4 text-gray-600">
            Welcome, <span className="font-bold">{session?.user?.name}</span>! Your account is created but not yet active. To unlock the student portal and begin applying for courses, please pay the one-time registration fee.
          </p>

          <div className="my-8 p-6 bg-blue-50 border border-blue-100 rounded-xl">
            <p className="text-sm font-bold text-aerojet-blue uppercase tracking-widest">Registration Fee</p>
            <p className="text-5xl font-black text-aerojet-sky mt-2">GHS 350.00</p>
          </div>

          <p className="text-sm text-gray-500 mb-6">
            Please make a bank transfer using the details provided on our website. After payment, upload your receipt below for verification.
          </p>
          
          <div className="border-2 border-dashed border-gray-300 rounded-xl p-8 bg-gray-50">
            <UploadButton
              endpoint="paymentProof"
              onClientUploadComplete={handleUploadComplete}
              // FIX IS HERE: Wrapped in curly braces to return void
              onUploadError={(error) => {
                toast.error(`Upload Failed: ${error.message}`);
              }}
              appearance={{
                  button: "bg-aerojet-sky text-white px-8 py-3 text-base font-bold rounded-lg hover:bg-aerojet-blue transition-all",
                  allowedContent: "text-[10px] text-gray-400 mt-2 uppercase font-black"
              }}
            />
          </div>
        </div>
      </div>
    </div>
  );
}

import { getServerSession } from "next-auth/next";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import { redirect } from "next/navigation";

export default async function PortalRouter() {
  const session = await getServerSession(authOptions);

  // 1. Not logged in? Go to login.
  if (!session || !session.user) {
    redirect('/portal/login');
  }

  // 2. Is Admin or Staff? Go to Staff Portal.
  if (session.user.role === 'ADMIN' || session.user.role === 'STAFF') {
    redirect('/staff/dashboard');
  }

  // 3. Everyone else (Students)? Go to Student Portal.
  redirect('/portal/dashboard');
}

import { Metadata } from 'next';
import Navbar from '@/components/Navbar';
import Footer from '@/components/Footer';
import RegisterForm from '@/components/RegisterForm';

export const metadata: Metadata = {
  title: "Register",
};

export default function RegisterPage() {
  return (
    <main className="min-h-screen flex flex-col bg-slate-50 pt-20">
      <Navbar theme="light" />
      <div className="grow flex items-center justify-center py-16 px-4">
        <div className="max-w-xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-100">
          <div className="bg-aerojet-blue p-8 text-center text-white">
            <h2 className="text-3xl font-black uppercase tracking-tight">Start Your Journey</h2>
          </div>
          <div className="p-8 md:p-10">
            <RegisterForm />
          </div>
        </div>
      </div>
      <Footer />
    </main>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function ApplicationsPage() {
  const [apps, setApps] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [processingId, setProcessingId] = useState<string | null>(null);
  
  // Document Viewer State
  const [viewingDocs, setViewingDocs] = useState<any | null>(null);

  // Filter States
  const [statusFilter, setStatusFilter] = useState('ALL'); // ALL, PENDING, APPROVED
  const [dateSort, setDateSort] = useState('desc'); // desc (newest first), asc (oldest first)

  async function fetchApps() {
    const res = await fetch('/api/staff/applications');
    const data = await res.json();
    setApps(data.applications || []);
    setLoading(false);
  }

  useEffect(() => {
    fetchApps();
  }, []);

  const handleApprove = async (id: string) => {
    setProcessingId(id);
    try {
      const res = await fetch('/api/staff/applications', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ applicationId: id })
      });
      if (res.ok) {
        toast.success("Application Approved");
        fetchApps();
        setViewingDocs(null); // Close modal if open
      } else {
        toast.error("Failed to approve");
      }
    } catch (e) {
      toast.error("Error occurred");
    } finally {
      setProcessingId(null);
    }
  };

  // --- Filter Logic ---
  const filteredApps = apps
    .filter(app => {
      if (statusFilter === 'ALL') return true;
      return app.status === statusFilter;
    })
    .sort((a, b) => {
      const dateA = new Date(a.appliedAt).getTime();
      const dateB = new Date(b.appliedAt).getTime();
      return dateSort === 'asc' ? dateA - dateB : dateB - dateA;
    });

  if (loading) return <div className="p-8">Loading...</div>;

  return (
    <div>
      <h1 className="text-2xl font-bold text-slate-800 mb-6">Student Applications</h1>
      
      {/* Filter Bar */}
      <div className="bg-white p-4 rounded-lg shadow mb-6 flex flex-wrap gap-4 items-center">
        <div className="flex items-center gap-2">
            <span className="text-sm font-bold text-slate-600">Status:</span>
            <select 
                value={statusFilter} 
                onChange={(e) => setStatusFilter(e.target.value)}
                className="border border-gray-300 rounded px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
            >
                <option value="ALL">All Applications</option>
                <option value="PENDING">Pending</option>
                <option value="APPROVED">Approved</option>
                <option value="UNDER_REVIEW">Under Review</option>
            </select>
        </div>

        <div className="flex items-center gap-2">
            <span className="text-sm font-bold text-slate-600">Date:</span>
            <select 
                value={dateSort} 
                onChange={(e) => setDateSort(e.target.value)}
                className="border border-gray-300 rounded px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
            >
                <option value="desc">Newest First</option>
                <option value="asc">Oldest First</option>
            </select>
        </div>
      </div>

      {/* Table Container - Mobile Optimized */}
      <div className="bg-white rounded-lg shadow overflow-hidden flex flex-col">
        <div className="overflow-x-auto no-scrollbar">
            <table className="w-full text-left text-sm text-gray-600 min-w-200">
            <thead className="bg-slate-50 text-slate-800 font-bold border-b">
                <tr>
                <th className="p-4">Student</th>
                <th className="p-4">Course</th>
                <th className="p-4">Date</th>
                <th className="p-4">Status</th>
                <th className="p-4 text-right">Action</th>
                </tr>
            </thead>
            <tbody className="divide-y">
                {filteredApps.length === 0 ? (
                    <tr><td colSpan={5} className="p-8 text-center text-gray-400">No applications match your filters.</td></tr>
                ) : (
                    filteredApps.map((app) => (
                    <tr key={app.id} className="hover:bg-slate-50">
                        <td className="p-4">
                            <p className="font-bold text-slate-700">{app.student.user.name}</p>
                            <p className="text-xs text-gray-500">{app.student.user.email}</p>
                        </td>
                        <td className="p-4">
                            <p className="font-medium">{app.course.code}</p>
                            <p className="text-xs text-gray-500 truncate w-48">{app.course.title}</p>
                        </td>
                        <td className="p-4">{new Date(app.appliedAt).toLocaleDateString()}</td>
                        <td className="p-4">
                            <span className={`px-2 py-1 rounded text-xs font-bold ${
                                app.status === 'PENDING' ? 'bg-yellow-100 text-yellow-700' :
                                app.status === 'UNDER_REVIEW' ? 'bg-blue-100 text-blue-700' :
                                app.status === 'APPROVED' ? 'bg-green-100 text-green-700' : 'bg-gray-100'
                            }`}>
                                {app.status}
                            </span>
                            {/* View Docs Link if Submitted */}
                            {app.isSubmitted && (
                                <button 
                                    onClick={() => setViewingDocs(app)}
                                    className="ml-2 text-xs text-blue-600 underline hover:text-blue-800 font-bold"
                                >
                                    View Docs
                                </button>
                            )}
                        </td>
                        <td className="p-4 text-right">
                            {app.status !== 'APPROVED' && (
                                <button 
                                    onClick={() => handleApprove(app.id)}
                                    disabled={!!processingId}
                                    className="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 disabled:opacity-50 text-xs font-bold"
                                >
                                    {processingId === app.id ? '...' : 'Approve'}
                                </button>
                            )}
                        </td>
                    </tr>
                    ))
                )}
            </tbody>
            </table>
        </div>
      </div>

      {/* DOCUMENT VIEWER MODAL */}
      {viewingDocs && (
        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onClick={() => setViewingDocs(null)}>
            <div className="bg-white rounded-xl p-8 max-w-2xl w-full relative" onClick={e => e.stopPropagation()}>
                <button onClick={() => setViewingDocs(null)} className="absolute top-4 right-4 text-gray-400 hover:text-red-500 font-bold text-xl">✕</button>
                <h2 className="text-xl font-bold mb-6 text-slate-800 border-b pb-2">Documents: {viewingDocs.student.user.name}</h2>
                
                <div className="space-y-4">
                    <div className="p-4 bg-slate-50 border rounded-lg flex justify-between items-center">
                        <div>
                            <p className="font-bold text-slate-700">Passport / National ID</p>
                            <p className="text-xs text-slate-500">{viewingDocs.idDocumentUrl ? 'Uploaded' : 'Missing'}</p>
                        </div>
                        {viewingDocs.idDocumentUrl ? (
                            <a href={viewingDocs.idDocumentUrl} target="_blank" className="bg-white border px-4 py-2 rounded text-sm font-bold text-blue-600 hover:bg-blue-50">View File ↗</a>
                        ) : <span className="text-gray-400 text-sm italic">N/A</span>}
                    </div>

                    <div className="p-4 bg-slate-50 border rounded-lg flex justify-between items-center">
                        <div>
                            <p className="font-bold text-slate-700">High School Certificate</p>
                            <p className="text-xs text-slate-500">{viewingDocs.certificateUrl ? 'Uploaded' : 'Missing'}</p>
                        </div>
                        {viewingDocs.certificateUrl ? (
                            <a href={viewingDocs.certificateUrl} target="_blank" className="bg-white border px-4 py-2 rounded text-sm font-bold text-blue-600 hover:bg-blue-50">View File ↗</a>
                        ) : <span className="text-gray-400 text-sm italic">N/A</span>}
                    </div>
                </div>

                <div className="mt-8 flex justify-end">
                    <button onClick={() => handleApprove(viewingDocs.id)} className="bg-green-600 text-white px-6 py-2 rounded font-bold hover:bg-green-700">
                        Approve Application
                    </button>
                </div>
            </div>
        </div>
      )}
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function AttendancePage() {
  const [courses, setCourses] = useState<any[]>([]);
  const [selectedCourse, setSelectedCourse] = useState<string>("");
  const [students, setStudents] = useState<any[]>([]);
  const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
  const [loading, setLoading] = useState(true);

  // Form State: studentId -> { attended, late }
  const [rosterState, setRosterState] = useState<Record<string, { attended: string, late: string }>>({});
  const [scheduledHours, setScheduledHours] = useState("6"); // Default 6 hours/day

  useEffect(() => {
    async function init() {
      const res = await fetch('/api/staff/courses');
      const data = await res.json();
      setCourses(data.courses || []);
      setLoading(false);
    }
    init();
  }, []);

  useEffect(() => {
    if (!selectedCourse) {
        setStudents([]);
        return;
    }
    async function fetchRoster() {
        const res = await fetch('/api/staff/applications'); 
        const data = await res.json();
        
        const enrolled = data.applications
            .filter((app: any) => app.courseId === selectedCourse && app.status === 'APPROVED')
            .map((app: any) => app.student);
            
        setStudents(enrolled);
        
        const initial: any = {};
        enrolled.forEach((s: any) => initial[s.id] = { attended: scheduledHours, late: "0" });
        setRosterState(initial);
    }
    fetchRoster();
  }, [selectedCourse, scheduledHours]);

  const handleSubmit = async () => {
    const records = students.map(s => ({
        studentId: s.id,
        scheduled: scheduledHours,
        attended: rosterState[s.id]?.attended || scheduledHours,
        late: rosterState[s.id]?.late || "0"
    }));

    const res = await fetch('/api/staff/attendance', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ courseId: selectedCourse, date, records })
    });

    if (res.ok) toast.success("Attendance Saved");
    else toast.error("Failed to save");
  };

  const markAllPresent = () => {
    if (students.length === 0) return;
    const newState: Record<string, { attended: string, late: string }> = {};
    students.forEach(s => {
        newState[s.id] = { attended: scheduledHours, late: "0" };
    });
    setRosterState(newState);
    toast.info("Marked all students as present.");
  };

  if (loading) return <div className="p-8">Loading...</div>;

  return (
    <div className="max-w-5xl mx-auto space-y-8">
      <h1 className="text-2xl font-bold text-slate-800">Daily Attendance Register</h1>

      <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200 grid md:grid-cols-3 gap-4 items-end">
        <div>
            <label className="block text-xs font-bold text-gray-500 mb-1">Select Course</label>
            <select className="w-full border rounded p-2" value={selectedCourse} onChange={e => setSelectedCourse(e.target.value)}>
                <option value="">-- Choose Course --</option>
                {courses.map(c => <option key={c.id} value={c.id}>{c.code} - {c.title}</option>)}
            </select>
        </div>
        <div className="bg-blue-50 p-4 rounded-lg border border-blue-100">
    <label className="block text-xs font-bold text-blue-800 uppercase mb-1">Date</label>
    <input 
        type="date" 
        className="w-full bg-white border border-blue-200 rounded p-2 font-bold text-blue-900" 
        value={date} 
        onChange={e => setDate(e.target.value)} 
    />
</div>

        <div>
            <label className="block text-xs font-bold text-gray-500 mb-1">Scheduled Hours</label>
            <input type="number" className="w-full border rounded p-2" value={scheduledHours} onChange={e => setScheduledHours(e.target.value)} />
        </div>
      </div>

      {selectedCourse && (
        <>
          <div className="flex justify-end">
              <button 
                onClick={markAllPresent} 
                className="bg-gray-100 text-gray-700 border border-gray-300 px-4 py-2 rounded font-bold text-sm hover:bg-gray-200 disabled:opacity-50"
                disabled={students.length === 0}
              >
                Mark All as Present
              </button>
          </div>
          {students.length > 0 ? (
            <div className="bg-white rounded-lg shadow overflow-hidden flex flex-col">
                <div className="overflow-x-auto no-scrollbar">
                    <table className="w-full text-left text-sm min-w-150">
                        <thead className="bg-slate-50 border-b font-bold text-slate-700">
                            <tr>
                                <th className="p-4">Student</th>
                                <th className="p-4 w-32">Attended (Hrs)</th>
                                <th className="p-4 w-32">Late (Mins)</th>
                                <th className="p-4">Status</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y">
                            {students.map(s => {
                                const state = rosterState[s.id] || { attended: scheduledHours, late: "0" };
                                const isAbsent = parseFloat(state.attended) === 0;
                                const isPartial = parseFloat(state.attended) > 0 && parseFloat(state.attended) < parseFloat(scheduledHours);
                                return (
                                    <tr key={s.id} className={isAbsent ? "bg-red-50" : ""}>
                                        <td className="p-4 font-medium">{s.user.name}</td>
                                        <td className="p-4">
                                            <input type="number" className="border rounded w-20 p-1" value={state.attended} onChange={e => setRosterState({...rosterState, [s.id]: { ...state, attended: e.target.value }})}/>
                                        </td>
                                        <td className="p-4">
                                            <input type="number" className="border rounded w-20 p-1" value={state.late} onChange={e => setRosterState({...rosterState, [s.id]: { ...state, late: e.target.value }})}/>
                                        </td>
                                        <td className="p-4">
                                            {isAbsent ? <span className="text-red-600 font-bold">ABSENT</span> : 
                                            isPartial ? <span className="text-orange-600 font-bold">PARTIAL</span> : 
                                            <span className="text-green-600 font-bold">PRESENT</span>}
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
                <div className="p-4 bg-gray-50 border-t flex justify-end">
                    <button onClick={handleSubmit} className="bg-blue-600 text-white px-8 py-3 rounded font-bold hover:bg-blue-700">
                        Save Attendance
                    </button>
                </div>
            </div>
          ) : (
            <div className="p-8 bg-white rounded text-center text-gray-500">No approved students enrolled in this course yet.</div>
          )}
        </>
      )}
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function StaffCoursesPage() {
  const [courses, setCourses] = useState<any[]>([]);
  const [instructors, setInstructors] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  
  // Edit State
  const [editingCourse, setEditingCourse] = useState<any | null>(null);
  const [formData, setFormData] = useState({ materialLink: '', instructorIds: [] as string[] });

  async function fetchCourses() {
    const res = await fetch('/api/staff/courses');
    const data = await res.json();
    setCourses(data.courses || []);
    setInstructors(data.instructors || []);
    setLoading(false);
  }

  useEffect(() => { fetchCourses(); }, []);

  const handleEdit = (course: any) => {
    setEditingCourse(course);
    setFormData({
        materialLink: course.materialLink || '',
        instructorIds: course.instructors ? course.instructors.map((i: any) => i.id) : []
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    const res = await fetch('/api/staff/courses', {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            id: editingCourse.id, 
            materialLink: formData.materialLink,
            instructorIds: formData.instructorIds
        })
    });

    if (res.ok) {
        toast.success("Course Updated");
        fetchCourses();
        setEditingCourse(null);
    } else {
        toast.error("Failed to update");
    }
  };

  // Helper to toggle instructor selection
  const toggleInstructor = (id: string) => {
    setFormData(prev => {
        const newIds = prev.instructorIds.includes(id) 
            ? prev.instructorIds.filter(i => i !== id) 
            : [...prev.instructorIds, id];
        return { ...prev, instructorIds: newIds };
    });
  };

  if (loading) return <div className="p-8">Loading Catalog...</div>;

  return (
    <div>
      <h1 className="text-2xl font-bold text-slate-800 mb-6">Course Management</h1>
      
            <div className="bg-white rounded-lg shadow overflow-hidden flex flex-col">
        <div className="overflow-x-auto no-scrollbar">
            <table className="w-full text-left text-sm text-gray-600 min-w-175">
            <thead className="bg-slate-50 text-slate-800 font-bold border-b">
                <tr>
                <th className="p-4">Code</th>
                <th className="p-4">Title</th>
                <th className="p-4">Instructors</th>
                <th className="p-4">Materials</th>
                <th className="p-4 text-right">Action</th>
                </tr>
            </thead>
            <tbody className="divide-y">
                {courses.map((c) => (
                <tr key={c.id} className="hover:bg-slate-50">
                    <td className="p-4 font-mono font-bold">{c.code}</td>
                    <td className="p-4">{c.title}</td>
                    <td className="p-4">
                        {c.instructors && c.instructors.length > 0 
                            ? <span className="bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-bold">{c.instructors.length} Assigned</span> 
                            : <span className="text-gray-400 italic">None</span>
                        }
                    </td>
                    <td className="p-4">
                        {c.materialLink ? (
                            <a href={c.materialLink} target="_blank" className="text-blue-600 hover:underline truncate block max-w-37.5">Link Set</a>
                        ) : <span className="text-gray-400 italic">--</span>}
                    </td>
                    <td className="p-4 text-right">
                        <button onClick={() => handleEdit(c)} className="text-blue-600 hover:text-blue-800 font-bold text-xs border border-blue-200 px-3 py-1 rounded">
                            Edit
                        </button>
                    </td>
                </tr>
                ))}
            </tbody>
            </table>
        </div>
      </div>


      {/* Edit Modal */}
      {editingCourse && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
            <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
                <h2 className="text-xl font-bold text-slate-800 mb-4">Edit {editingCourse.code}</h2>
                <form onSubmit={handleSubmit}>
                    <div className="mb-4">
                        <label className="block text-sm font-bold text-gray-700 mb-1">Materials Link (OneDrive/SharePoint)</label>
                        <input 
                            type="url" 
                            className="w-full border rounded p-2 text-sm"
                            value={formData.materialLink}
                            onChange={e => setFormData({...formData, materialLink: e.target.value})}
                            placeholder="https://..."
                        />
                    </div>

                    <div className="mb-6">
                        <label className="block text-sm font-bold text-gray-700 mb-2">Assign Instructors</label>
                        <div className="max-h-40 overflow-y-auto border rounded p-2 space-y-2 bg-gray-50">
                            {instructors.map(inst => (
                                <label key={inst.id} className="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                                    <input 
                                        type="checkbox" 
                                        checked={formData.instructorIds.includes(inst.id)}
                                        onChange={() => toggleInstructor(inst.id)}
                                        className="rounded text-blue-600"
                                    />
                                    <span>{inst.name} <span className="text-gray-400 text-xs">({inst.email})</span></span>
                                </label>
                            ))}
                            {instructors.length === 0 && <p className="text-xs text-gray-400 italic">No instructors found. Change user roles first.</p>}
                        </div>
                    </div>

                    <div className="flex justify-end gap-3">
                        <button type="button" onClick={() => setEditingCourse(null)} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded text-sm font-bold">Cancel</button>
                        <button type="submit" className="px-6 py-2 bg-blue-600 text-white rounded text-sm font-bold hover:bg-blue-700">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
      )}
    </div>
  );
}

import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/app/api/auth/[...nextauth]/route';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET(req: Request) {
  try {
    const session = await getServerSession(authOptions);
    
    // 1. Security Check: Only Admin and Staff allowed
    if (!session || !['ADMIN', 'STAFF'].includes((session.user as any).role)) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
    }

    // --- 2. STUDENT STATS ---
    const totalStudents = await prisma.user.count({ where: { role: 'STUDENT' } });
    const activeStudents = await prisma.user.count({ where: { role: 'STUDENT', isActive: true } });
    const inactiveStudents = totalStudents - activeStudents;

    // Gender Breakdown (Queries the Student table)
    const maleStudents = await prisma.student.count({ where: { gender: 'MALE' } });
    const femaleStudents = await prisma.student.count({ where: { gender: 'FEMALE' } });

    // --- 3. TEAM STATS ---
    const totalStaff = await prisma.user.count({ where: { role: 'STAFF' } });
    const totalInstructors = await prisma.user.count({ where: { role: 'INSTRUCTOR' } });
    const totalAdmins = await prisma.user.count({ where: { role: 'ADMIN' } });

    // --- 4. OPERATIONAL STATS ---
    const pendingApps = await prisma.application.count({ where: { status: 'PENDING' } });
    const verifyingPayments = await prisma.fee.count({ where: { status: 'VERIFYING' } });

    // --- 5. EXAM WINDOW TRACKER LOGIC ---
    const nextWindow = await prisma.examWindow.findFirst({
      where: { endDate: { gt: new Date() } },
      include: {
        runs: {
          include: {
            course: true,
            bookings: {
              include: { 
                student: { include: { fees: true } } 
              }
            }
          }
        }
      },
      orderBy: { startDate: 'asc' }
    });

    let windowStats = null;

    if (nextWindow) {
      let paidSeatsCount = 0;
      nextWindow.runs.forEach(run => {
        run.bookings.forEach(booking => {
          // Check if the student has a PAID fee entry that matches this module code
          const examFee = booking.student.fees.find(f => 
            f.description?.includes(run.course.code) && f.status === 'PAID'
          );
          if (examFee) {
            paidSeatsCount++;
          }
        });
      });

      const today = new Date();
      const cutoff = new Date(nextWindow.cutoffDate);
      const diffTime = cutoff.getTime() - today.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

      windowStats = {
        id: nextWindow.id,
        name: nextWindow.name,
        cutoff: nextWindow.cutoffDate,
        paidSeats: paidSeatsCount,
        targetSeats: nextWindow.minSeatsRequired,
        isGo: paidSeatsCount >= nextWindow.minSeatsRequired,
        daysToCutoff: diffDays > 0 ? diffDays : 0
      };
    }

    // --- 6. FINAL CONSOLIDATED RESPONSE ---
    return NextResponse.json({
      studentStats: {
        total: totalStudents,
        active: activeStudents,
        inactive: inactiveStudents,
        male: maleStudents,
        female: femaleStudents
      },
      teamStats: {
        staff: totalStaff,
        instructors: totalInstructors,
        admins: totalAdmins
      },
      opsStats: {
        pendingApps,
        verifyingPayments
      },
      windowTracker: windowStats // This was missing in your return
    });

  } catch (error) {
    console.error("Dashboard API Error:", error);
    return NextResponse.json({ error: 'Failed to fetch dashboard data' }, { status: 500 });
  }
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import Link from "next/link";
import { useParams } from "next/navigation";
import ConfirmationModal from "@/components/modal/ConfirmationModal";
import InputModal from "@/components/modal/InputModal";

export default function ExamRosterPage() {
  const params = useParams();
  const [run, setRun] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  // Modal States
  const [removeId, setRemoveId] = useState<string | null>(null);
  const [assignData, setAssignData] = useState<{ id: string, currentSeat: string | null } | null>(null);

  async function fetchRun() {
    const res = await fetch(`/api/staff/exams/${params.id}`);
    const data = await res.json();
    setRun(data.run);
    setLoading(false);
  }

  useEffect(() => { fetchRun(); }, []);

  const handleRemoveConfirm = async () => {
    if (!removeId) return;
    
    const res = await fetch(`/api/staff/exams/${params.id}`, {
      method: 'DELETE',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ bookingId: removeId })
    });

    if (res.ok) {
      toast.success("Student removed from exam.");
      fetchRun();
    } else {
      toast.error("Failed to remove.");
    }
    setRemoveId(null);
  };

  const handleAssignConfirm = async (seatLabel: string) => {
    if (!assignData) return;

    const res = await fetch(`/api/staff/exams/${params.id}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ bookingId: assignData.id, seatLabel })
    });

    if (res.ok) {
        toast.success(`Seat ${seatLabel} assigned.`);
        fetchRun();
    } else {
        toast.error("Failed. Seat might be taken.");
    }
    setAssignData(null);
  };

  if (loading) return <div className="p-8">Loading Roster...</div>;
  if (!run) return <div className="p-8">Exam not found.</div>;

  return (
    <div className="max-w-6xl mx-auto space-y-8">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
            <Link href="/staff/exams" className="text-sm text-blue-600 hover:underline mb-2 block">← Back to Exams</Link>
            <h1 className="text-2xl font-bold text-slate-800">{run.course.code}: {run.course.title}</h1>
            <p className="text-slate-500">
                {new Date(run.startDatetime).toLocaleString()} • {run.room.name} • {run.bookings.length} / {run.maxCapacity} Seats
            </p>
        </div>
        <div className="flex gap-2">
            <button className="bg-slate-800 text-white px-4 py-2 rounded text-sm font-bold" onClick={() => window.print()}>Print Roster</button>
        </div>
      </div>

      {/* Booking List */}
      <div className="bg-white rounded-lg shadow overflow-hidden">
        <h3 className="bg-slate-50 px-6 py-3 font-bold text-slate-700 border-b">Registered Students</h3>
        <table className="w-full text-left text-sm text-gray-600">
            <thead className="bg-white border-b text-xs uppercase font-bold text-gray-400">
                <tr>
                    <th className="px-6 py-3">Seat</th>
                    <th className="px-6 py-3">Student Name</th>
                    <th className="px-6 py-3">ID</th>
                    <th className="px-6 py-3">Status</th>
                    <th className="px-6 py-3 text-right">Action</th>
                </tr>
            </thead>
            <tbody className="divide-y">
                {run.bookings.length === 0 ? (
                    <tr><td colSpan={5} className="p-8 text-center italic">No bookings yet.</td></tr>
                ) : (
                    run.bookings.map((booking: any) => (
                        <tr key={booking.id} className="hover:bg-gray-50">
                            <td className="px-6 py-4 font-mono font-bold text-blue-600 text-lg">
                                {booking.seatLabel || <span className="text-gray-300 text-sm font-normal">Unassigned</span>}
                            </td>
                            <td className="px-6 py-4">
                                <p className="font-bold text-slate-700">{booking.student.user.name}</p>
                                <p className="text-xs text-gray-400">{booking.student.user.email}</p>
                            </td>
                            <td className="px-6 py-4 font-mono">{booking.student.studentId || "PENDING"}</td>
                            <td className="px-6 py-4">
                                <span className="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold">CONFIRMED</span>
                            </td>
                            <td className="px-6 py-4 text-right space-x-2">
                                <button 
                                    onClick={() => setAssignData({ id: booking.id, currentSeat: booking.seatLabel })}
                                    className="text-blue-600 hover:text-blue-800 text-xs font-bold border border-blue-200 hover:bg-blue-50 px-3 py-1 rounded"
                                >
                                    {booking.seatLabel ? 'Edit Seat' : 'Assign Seat'}
                                </button>
                                <button 
                                    onClick={() => setRemoveId(booking.id)}
                                    className="text-red-500 hover:text-red-700 text-xs font-bold border border-red-200 hover:bg-red-50 px-3 py-1 rounded"
                                >
                                    Remove
                                </button>
                            </td>
                        </tr>
                    ))
                )}
            </tbody>
        </table>
      </div>

      {/* --- MODALS --- */}
      <ConfirmationModal 
        isOpen={!!removeId}
        onClose={() => setRemoveId(null)}
        onConfirm={handleRemoveConfirm}
        title="Remove Student"
        message="Are you sure you want to remove this student from the exam? This cannot be undone."
      />

      <InputModal 
        isOpen={!!assignData}
        onClose={() => setAssignData(null)}
        onConfirm={handleAssignConfirm}
        title="Assign Seat"
        message="Enter the seat number (e.g. S01, A-12) for this student."
        defaultValue={assignData?.currentSeat || ""}
        placeholder="Seat Number"
      />
    </div>
  );
}
"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import { useRouter } from "next/navigation"; // Use router for SPA navigation

export default function StaffExamsPage() {
  const router = useRouter();
  const [runs, setRuns] = useState<any[]>([]);
  const [rooms, setRooms] = useState<any[]>([]);
  const [modules, setModules] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  
  // Create Form State
  const [newRun, setNewRun] = useState({ moduleId: '', roomId: '', datetime: '', duration: '60' });
  const [isCreating, setIsCreating] = useState(false);

  async function fetchData() {
    try {
        const res = await fetch('/api/staff/exams');
        const data = await res.json();
        setRuns(data.runs || []);
        setRooms(data.rooms || []);
        setModules(data.modules || []);
    } catch (e) {
        toast.error("Failed to load data");
    } finally {
        setLoading(false);
    }
  }

  useEffect(() => { fetchData(); }, []);

  const handleCreate = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsCreating(true);
    try {
        const res = await fetch('/api/staff/exams', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newRun)
        });
        if (res.ok) {
            toast.success("Exam Scheduled Successfully");
            setNewRun({ moduleId: '', roomId: '', datetime: '', duration: '60' }); // Reset
            fetchData();
        } else {
            toast.error("Failed to schedule exam");
        }
    } catch (e) {
        toast.error("Error occurred");
    } finally {
        setIsCreating(false);
    }
  };

  if (loading) return <div className="p-8">Loading Exams...</div>;

  return (
    <div className="space-y-8">
      <h1 className="text-2xl font-bold text-slate-800">Exam Management</h1>

      {/* --- Create Exam Form --- */}
      <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
        <h2 className="text-lg font-bold text-slate-700 mb-4">Schedule New Exam Run</h2>
        <form onSubmit={handleCreate} className="grid md:grid-cols-5 gap-4 items-end">
            <div className="col-span-2 md:col-span-1">
                <label className="block text-xs font-bold text-gray-500 mb-1">Module</label>
                <select 
                    value={newRun.moduleId} onChange={e => setNewRun({...newRun, moduleId: e.target.value})}
                    className="w-full border rounded p-2 text-sm" required
                >
                    <option value="">Select Module...</option>
                    {modules.map(m => <option key={m.id} value={m.id}>{m.code} - {m.title}</option>)}
                </select>
            </div>
            <div>
                <label className="block text-xs font-bold text-gray-500 mb-1">Room</label>
                <select 
                    value={newRun.roomId} onChange={e => setNewRun({...newRun, roomId: e.target.value})}
                    className="w-full border rounded p-2 text-sm" required
                >
                    <option value="">Select Room...</option>
                    {rooms.map(r => <option key={r.id} value={r.id}>{r.name} ({r.capacity})</option>)}
                </select>
            </div>
            <div>
                <label className="block text-xs font-bold text-gray-500 mb-1">Date & Time</label>
                <input 
                    type="datetime-local" 
                    value={newRun.datetime} onChange={e => setNewRun({...newRun, datetime: e.target.value})}
                    className="w-full border rounded p-2 text-sm" required
                />
            </div>
            <div>
                <label className="block text-xs font-bold text-gray-500 mb-1">Duration (Min)</label>
                <input 
                    type="number" 
                    value={newRun.duration} onChange={e => setNewRun({...newRun, duration: e.target.value})}
                    className="w-full border rounded p-2 text-sm" required min="30"
                />
            </div>
            <button disabled={isCreating} className="bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700 disabled:opacity-50 text-sm">
                {isCreating ? 'Creating...' : 'Schedule Exam'}
            </button>
        </form>
      </div>

      {/* --- Exam List --- */}
      <div className="bg-white rounded-lg shadow overflow-hidden flex flex-col">
        <div className="overflow-x-auto no-scrollbar">
            <table className="w-full text-left text-sm text-gray-600 min-w-200">
                <thead className="bg-slate-50 text-slate-800 font-bold border-b">
                    <tr>
                        <th className="p-4">Date</th>
                        <th className="p-4">Module</th>
                        <th className="p-4">Room</th>
                        <th className="p-4">Capacity</th>
                        <th className="p-4">Bookings</th>
                        <th className="p-4 text-center">Status</th>
                    </tr>
                </thead>
                <tbody className="divide-y">
                    {runs.map(run => (
                        <tr 
                            key={run.id} 
                            className="hover:bg-slate-50 cursor-pointer transition-colors" 
                            onClick={() => router.push(`/staff/exams/${run.id}`)} // Use router.push for faster navigation
                        >
                            <td className="p-4 font-mono">{new Date(run.startDatetime).toLocaleString()}</td>
                            <td className="p-4 font-bold">{run.course.code}</td>
                            <td className="p-4">{run.room.name}</td>
                            <td className="p-4">{run.maxCapacity}</td>
                            <td className="p-4 font-bold text-blue-600">{run.bookings.length} Students</td>
                            <td className="p-4 text-center">
                                <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-bold">{run.status}</span>
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
      </div>
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import Image from "next/image";
import Link from "next/link";

export default function FinanceStaffPage() {
  const [payments, setPayments] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  
  // Modal State
  const [viewingProof, setViewingProof] = useState<any | null>(null);
  const [confirmAmount, setConfirmAmount] = useState(""); // New State

  async function fetchPayments() {
    const res = await fetch('/api/staff/finance');
    const data = await res.json();
    setPayments(data.payments || []);
    setLoading(false);
  }

  useEffect(() => { fetchPayments(); }, []);

  const handleConfirm = async () => {
    if (!viewingProof || !confirmAmount) return;
    
    const res = await fetch('/api/staff/finance', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ feeId: viewingProof.id, amountPaid: parseFloat(confirmAmount) })
    });
    
    if (res.ok) {
        toast.success(`Payment of €${confirmAmount} Confirmed`);
        setViewingProof(null); 
        setConfirmAmount("");
        fetchPayments();
    } else {
        toast.error("Failed to confirm payment");
    }
  };

  if (loading) return <div className="p-8">Loading...</div>;

  return (
    <div>
      <h1 className="text-2xl font-bold text-slate-800 mb-6">Payment Verification</h1>
      
      {payments.length === 0 ? (
        <div className="p-8 bg-white rounded shadow text-gray-500">No pending payments to verify.</div>
      ) : (
        <div className="bg-white rounded-lg shadow overflow-hidden">
            <table className="w-full text-left text-sm">
                <thead className="bg-slate-50 border-b">
                    <tr>
                        <th className="p-4">Student</th>
                        <th className="p-4">Description</th>
                        <th className="p-4 text-right">Total</th>
                        <th className="p-4 text-center">Proof</th>
                        <th className="p-4 text-right">Action</th>
                    </tr>
                </thead>
                <tbody className="divide-y">
                    {payments.map(pay => (
                        <tr key={pay.id}>
                            <td className="p-4 font-bold">{pay.student.user.name}</td>
                            <td className="p-4">{pay.description}</td>
                            <td className="p-4 text-right">€{pay.amount.toFixed(2)}</td>
                            <td className="p-4 text-center">
                                {pay.proofUrl ? (
                                    <button 
                                        onClick={() => setViewingProof(pay)}
                                        className="text-blue-600 underline hover:text-blue-800 text-xs font-bold"
                                    >
                                        Verify
                                    </button>
                                ) : (
                                    <span className="text-gray-400 text-xs">No File</span>
                                )}
                            </td>
                            <td className="p-4 text-right text-gray-400 italic text-xs">
                                Verify to Action
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
      )}

      {/* Proof Viewer Modal */}
      {viewingProof && (
        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onClick={() => setViewingProof(null)}>
            <div className="bg-white rounded-xl overflow-hidden max-w-4xl w-full h-[85vh] flex flex-col" onClick={e => e.stopPropagation()}>
                <div className="p-4 border-b flex justify-between items-center bg-gray-50 shrink-0">
                    <h3 className="font-bold text-gray-800">Verify Payment: {viewingProof.student.user.name}</h3>
                    <button onClick={() => setViewingProof(null)} className="text-gray-500 hover:text-red-500 font-bold px-2">✕</button>
                </div>
                
                <div className="flex-1 bg-gray-100 p-4 overflow-auto flex items-center justify-center relative">
                    {viewingProof.proofUrl.endsWith('.pdf') ? (
                        <iframe src={viewingProof.proofUrl} className="w-full h-full rounded border border-gray-300" />
                    ) : (
                        <img src={viewingProof.proofUrl} alt="Proof" className="object-contain max-w-full max-h-full mx-auto" />
                    )}
                </div>

                <div className="p-6 border-t bg-white flex flex-col gap-4 shrink-0">
                    <div className="flex justify-between items-center text-sm text-gray-600">
                        <p>Total Invoice: <span className="font-bold text-slate-800">€{viewingProof.amount.toFixed(2)}</span></p>
                        <Link href={viewingProof.proofUrl} target="_blank" className="text-blue-600 hover:underline">Open File ↗</Link>
                    </div>
                    
                    <div className="flex gap-4 items-end">
                        <div className="flex-1">
                            <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Amount Received (EUR)</label>
                            <input 
                                type="number" 
                                value={confirmAmount}
                                onChange={e => setConfirmAmount(e.target.value)}
                                className="w-full border-2 border-slate-300 rounded-lg p-2 text-lg font-mono font-bold focus:border-green-500 outline-none"
                                placeholder="0.00"
                                autoFocus
                            />
                        </div>
                        <button 
                            onClick={handleConfirm} 
                            disabled={!confirmAmount}
                            className="px-8 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 disabled:opacity-50 shadow-md transition-all"
                        >
                            Confirm Payment
                        </button>
                    </div>
                </div>
            </div>
        </div>
      )}
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { useParams } from "next/navigation";
import Link from "next/link";

export default function ClassRosterPage() {
  const params = useParams();
  const [students, setStudents] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch(`/api/staff/my-teaching/${params.courseId}`)
      .then(res => res.json())
      .then(data => {
        setStudents(data.students || []);
        setLoading(false);
      });
  }, [params.courseId]);

  if (loading) return <div className="p-8">Loading Roster...</div>;

  return (
    <div className="max-w-5xl mx-auto space-y-8">
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
            {/* Improved Back Button */}
            <Link href="/staff/materials" className="inline-flex items-center text-slate-500 hover:text-slate-800 text-sm font-bold mb-2 transition-colors bg-white px-3 py-1 rounded border shadow-sm">
                ← Back to Courses
            </Link>
            <h1 className="text-2xl font-bold text-slate-800">Class Roster</h1>
            <p className="text-slate-500">{students.length} Enrolled Students</p>
        </div>
        
        {/* Placeholder for Attendance Action - could link to the main attendance tool */}
        <Link href="/staff/attendance" className="bg-slate-800 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-slate-900 shadow-md">
            Mark Attendance
        </Link>
      </div>

      <div className="bg-white rounded-lg shadow overflow-hidden flex flex-col">
        {/* Horizontal Scroll Fix */}
        <div className="overflow-x-auto no-scrollbar">
            <table className="w-full text-left text-sm text-gray-600 min-w-150">
            <thead className="bg-slate-50 font-bold border-b">
                <tr>
                    <th className="p-4">Name</th>
                    <th className="p-4">Student ID</th>
                    <th className="p-4">Email</th>
                    <th className="p-4 text-center">Status</th>
                </tr>
            </thead>
            <tbody className="divide-y">
                {students.length === 0 ? (
                    <tr><td colSpan={4} className="p-8 text-center text-gray-400">No students found.</td></tr>
                ) : (
                    students.map(s => (
                        <tr key={s.id} className="hover:bg-slate-50">
                            <td className="p-4 font-bold text-slate-700">{s.user.name}</td>
                            <td className="p-4 font-mono text-blue-600">{s.studentId || "PENDING"}</td>
                            <td className="p-4">{s.user.email}</td>
                            <td className="p-4 text-center">
                                <span className="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold">ACTIVE</span>
                            </td>
                        </tr>
                    ))
                )}
            </tbody>
        </table>
        </div>
        </div>
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { useSession } from "next-auth/react";
import Link from "next/link"; // Import Link

export default function TeachingMaterialsPage() {
  const { data: session } = useSession();
  const [courses, setCourses] = useState<any[]>([]);
  const [loading, setLoading] = useState(true); // Add loading state

  useEffect(() => {
    fetch('/api/staff/my-teaching')
      .then(res => res.json())
      .then(data => {
        setCourses(data.courses || []);
        setLoading(false);
      });
  }, []);

  if (loading) return <div className="p-8">Loading Courses...</div>;

  return (
    <div>
      <h1 className="text-2xl font-bold text-slate-800 mb-6">My Teaching Materials</h1>
      
      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {courses.length === 0 ? <p className="text-gray-500 col-span-3 text-center py-10 bg-white rounded shadow-sm">You are not assigned to any courses yet.</p> : courses.map(c => (
            
            <div key={c.id} className="bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-all flex flex-col overflow-hidden group">
                
                {/* Clickable Card Header -> Goes to Roster */}
                <Link href={`/staff/materials/${c.id}`} className="block p-6 bg-slate-50 border-b border-gray-100 grow group-hover:bg-blue-50 transition-colors">
                    <div className="flex justify-between items-start mb-2">
                        <span className="bg-blue-600 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">Class Roster</span>
                        <svg className="w-5 h-5 text-gray-400 group-hover:text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                    </div>
                    <h3 className="font-bold text-lg text-slate-800 group-hover:text-blue-700">{c.code}</h3>
                    <p className="text-sm text-slate-500 mt-1 line-clamp-2">{c.title}</p>
                </Link>
                
                {/* Material Link Footer */}
                <div className="p-4 bg-white">
                    <h4 className="font-bold text-[10px] uppercase text-slate-400 mb-2 tracking-widest">Course Materials</h4>
                    {c.materialLink ? (
                        <a 
                            href={c.materialLink} 
                            target="_blank" 
                            rel="noopener noreferrer"
                            className="flex items-center text-blue-600 hover:text-blue-800 text-xs font-bold transition-colors"
                        >
                            <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                            Open Link
                        </a>
                    ) : (
                        <p className="text-red-400 text-xs italic">No materials link set.</p>
                    )}
                </div>
            </div>
        ))}
      </div>
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function RegistrationsPage() {
  const [users, setUsers] = useState<any[]>([]);

  const fetchInactive = async () => {
    // API should fetch users where isActive: false
    const res = await fetch('/api/staff/users'); // Reuse this for now
    const data = await res.json();
    setUsers(data.users.filter((u: any) => !u.isActive && u.role === 'STUDENT'));
  };

  useEffect(() => { fetchInactive(); }, []);
  
  const handleActivate = async (userId: string) => {
    await fetch('/api/staff/users', { method: 'PATCH', body: JSON.stringify({ userId, isActive: true }) });
    toast.success("Account Activated!");
    fetchInactive();
  };

  return (
    <div>
      <h1 className="text-2xl font-bold text-slate-800 mb-6">Pending Registrations</h1>
      <div className="bg-white rounded-lg shadow">
        <table className="w-full text-left text-sm">
          <thead className="bg-slate-50 border-b"><tr><th className="p-4">Name</th><th className="p-4">Email</th><th className="p-4 text-right">Action</th></tr></thead>
          <tbody className="divide-y">
            {users.map(u => (
              <tr key={u.id}>
                <td className="p-4 font-bold">{u.name}</td>
                <td className="p-4">{u.email}</td>
                <td className="p-4 text-right">
                    <button onClick={() => handleActivate(u.id)} className="bg-green-600 text-white px-3 py-1 rounded text-xs font-bold">
                        Activate
                    </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function ResultsEntryPage() {
  const [examRuns, setExamRuns] = useState<any[]>([]);
  const [selectedRun, setSelectedRun] = useState<string>("");
  const [students, setStudents] = useState<any[]>([]);
  const [grades, setGrades] = useState<Record<string, string>>({}); 
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch('/api/staff/exams').then(res => res.json()).then(data => {
        setExamRuns(data.runs || []);
        setLoading(false);
    });
  }, []);

  useEffect(() => {
    if (!selectedRun) return;
    fetch(`/api/staff/exams/${selectedRun}`).then(res => res.json()).then(data => {
        setStudents(data.run.bookings.map((b: any) => b.student));
        // You would ideally fetch existing grades here to pre-fill
    });
  }, [selectedRun]);

  const handleSubmit = async () => {
    const payload = students.map(s => ({
        studentId: s.id,
        score: grades[s.id] || "0"
    }));

    const res = await fetch('/api/staff/results', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ examRunId: selectedRun, results: payload })
    });

    if (res.ok) toast.success("Grades Published / Updated");
    else toast.error("Failed to publish");
  };

  if (loading) return <div className="p-8">Loading...</div>;

  return (
    <div className="max-w-5xl mx-auto space-y-8">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold text-slate-800">Results Publishing</h1>
      </div>

      <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
        <label className="block text-xs font-bold text-gray-500 uppercase mb-2">Select Exam Session</label>
        <select className="w-full border rounded-lg p-3 text-sm" onChange={e => setSelectedRun(e.target.value)}>
            <option value="">-- Choose Exam --</option>
            {examRuns.map(run => (
                <option key={run.id} value={run.id}>
                    {new Date(run.startDatetime).toLocaleDateString()} — {run.course.code} ({run.bookings.length} Students)
                </option>
            ))}
        </select>
      </div>

      {selectedRun && (
        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col">
            <div className="overflow-x-auto no-scrollbar">
                <table className="w-full text-left text-sm min-w-150">
                    <thead className="bg-slate-50 font-bold border-b text-slate-700">
                        <tr>
                            <th className="p-4">Student Name</th>
                            <th className="p-4">ID Number</th>
                            <th className="p-4">Score (0-100)</th>
                            <th className="p-4">Status</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y">
                        {students.map(s => {
                            const score = parseFloat(grades[s.id] || "0");
                            const passed = score >= 75;
                            return (
                                <tr key={s.id} className="hover:bg-slate-50/50">
                                    <td className="p-4 font-medium">{s.user.name}</td>
                                    <td className="p-4 font-mono text-slate-500">{s.studentId || "PENDING"}</td>
                                    <td className="p-4">
                                        <input 
                                            type="number" 
                                            className="border border-gray-300 rounded-md w-24 p-2 font-bold text-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            min="0" max="100"
                                            placeholder="-"
                                            onChange={e => setGrades({...grades, [s.id]: e.target.value})}
                                        />
                                    </td>
                                    <td className="p-4">
                                        {grades[s.id] ? (
                                            <span className={`px-3 py-1 rounded-full text-xs font-black ${passed ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                                {passed ? 'PASS' : 'FAIL'}
                                            </span>
                                        ) : <span className="text-gray-300 text-xs">Pending Input</span>}
                                    </td>
                                </tr>
                            );
                        })}
                    </tbody>
                </table>
            </div>
            <div className="p-4 bg-slate-50 border-t flex justify-end">
                <button onClick={handleSubmit} className="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 shadow-md transition-all">
                    Publish / Update Results
                </button>
            </div>
        </div>
      )}
    </div>
  );
}
"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";

export default function StaffSettingsPage() {
  const [activeTab, setActiveTab] = useState<'rooms' | 'modules' | 'email'>('rooms');
  const [rooms, setRooms] = useState<any[]>([]); 
  const [modules, setModules] = useState<any[]>([]);
  const [systemSettings, setSystemSettings] = useState<Record<string, string>>({});
  const [loading, setLoading] = useState(true);

  // Form States
  const [roomForm, setRoomForm] = useState({ id: '', name: '', code: '', capacity: '28' });
  const [isEditingRoom, setIsEditingRoom] = useState(false);
  const [modForm, setModForm] = useState({ id: '', code: 'MOD-', title: '', price: '520' });
  const [isEditingMod, setIsEditingMod] = useState(false);

  const fetchData = async () => {
    try {
        const [resRooms, resModules, resSettings] = await Promise.all([
            fetch('/api/staff/settings'),
            fetch('/api/staff/courses'),
            fetch('/api/staff/settings/system')
        ]);
        const rData = await resRooms.json();
        const mData = await resModules.json();
        const sData = await resSettings.json();
        setRooms(rData.rooms || []);
        setModules(mData.courses || []);
        const settingsMap: Record<string, string> = {};
        sData.settings?.forEach((s: any) => settingsMap[s.key] = s.value);
        setSystemSettings(settingsMap);
    } catch (e) { toast.error("Failed to load settings"); }
    finally { setLoading(false); }
  };

  useEffect(() => { fetchData(); }, []);

  // --- MISSING FUNCTIONS ADDED HERE ---
  const handleEditRoom = (room: any) => {
    setRoomForm({ id: room.id, name: room.name, code: room.code, capacity: room.capacity.toString() });
    setIsEditingRoom(true);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const handleEditMod = (mod: any) => {
    setModForm({ id: mod.id, code: mod.code, title: mod.title, price: mod.price.toString() });
    setIsEditingMod(true);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const handleRoomSubmit = async () => {
    const method = isEditingRoom ? 'PATCH' : 'POST';
    const res = await fetch('/api/staff/settings', {
        method, headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ...roomForm, type: 'room' })
    });
    if (res.ok) {
        toast.success("Room saved");
        setRoomForm({ id: '', name: '', code: '', capacity: '28' });
        setIsEditingRoom(false);
        fetchData();
    }
  };

  const handleModuleSubmit = async () => {
    const method = isEditingMod ? 'PATCH' : 'POST';
    const res = await fetch('/api/staff/courses', {
        method, headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(modForm)
    });
    if (res.ok) {
        toast.success("Module saved");
        setModForm({ id: '', code: 'MOD-', title: '', price: '520' });
        setIsEditingMod(false);
        fetchData();
    }
  };

  const handleSaveSystemSetting = async (key: string, value: string) => {
    await fetch('/api/staff/settings/system', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ key, value })
    });
    toast.success("Email setting updated");
  };

  if (loading) return <div className="p-8 animate-pulse">Loading...</div>;

  return (
    <div className="max-w-5xl mx-auto space-y-8 pb-20">
      <h1 className="text-2xl font-bold text-slate-800">System Configuration</h1>
      
      {/* Tabs */}
      <div className="flex border-b border-gray-200">
        {['rooms', 'modules', 'email'].map((tab) => (
          <button key={tab} onClick={() => setActiveTab(tab as any)} className={`px-6 py-3 font-bold text-xs uppercase tracking-widest ${activeTab === tab ? 'border-b-4 border-aerojet-sky text-aerojet-sky' : 'text-gray-400'}`}>
            {tab}
          </button>
        ))}
      </div>

      {activeTab === 'rooms' && (
        <div className="space-y-8">
            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 className="font-bold mb-4">{isEditingRoom ? 'Edit Room' : 'Add Room'}</h2>
                <div className="grid grid-cols-3 gap-4">
                    <input type="text" value={roomForm.name} onChange={e => setRoomForm({...roomForm, name: e.target.value})} className="border rounded p-2 text-sm" placeholder="Room Name" />
                    <input type="text" value={roomForm.code} onChange={e => setRoomForm({...roomForm, code: e.target.value})} className="border rounded p-2 text-sm uppercase" placeholder="Code" />
                    <input type="number" value={roomForm.capacity} onChange={e => setRoomForm({...roomForm, capacity: e.target.value})} className="border rounded p-2 text-sm" placeholder="Capacity" />
                </div>
                <button onClick={handleRoomSubmit} className="mt-4 bg-blue-600 text-white px-4 py-2 rounded font-bold text-xs uppercase tracking-widest">Save Room</button>
            </div>
            <div className="bg-white rounded-xl shadow-sm border overflow-hidden">
                <div className="overflow-x-auto no-scrollbar">
                    <table className="w-full text-left text-sm min-w-150">
                        <thead className="bg-slate-50 border-b font-bold"><tr><th className="p-4">Name</th><th className="p-4">Code</th><th className="p-4">Capacity</th><th className="p-4 text-right">Action</th></tr></thead>
                        <tbody className="divide-y">
                            {rooms.map(r => (
                                <tr key={r.id}>
                                    <td className="p-4">{r.name}</td>
                                    <td className="p-4 font-mono">{r.code}</td>
                                    <td className="p-4">{r.capacity}</td>
                                    <td className="p-4 text-right"><button onClick={() => handleEditRoom(r)} className="text-blue-600 font-bold">Edit</button></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
      )}

      {activeTab === 'modules' && (
        <div className="space-y-8">
            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 className="font-bold mb-4">{isEditingMod ? 'Edit Module' : 'Add Module'}</h2>
                <div className="grid grid-cols-3 gap-4">
                    <input type="text" value={modForm.code} onChange={e => setModForm({...modForm, code: e.target.value})} className="border rounded p-2 text-sm uppercase" />
                    <input type="text" value={modForm.title} onChange={e => setModForm({...modForm, title: e.target.value})} className="border rounded p-2 text-sm" placeholder="Title" />
                    <input type="number" value={modForm.price} onChange={e => setModForm({...modForm, price: e.target.value})} className="border rounded p-2 text-sm" />
                </div>
                <button onClick={handleModuleSubmit} className="mt-4 bg-blue-600 text-white px-4 py-2 rounded font-bold text-xs uppercase tracking-widest">Save Module</button>
            </div>
            <div className="bg-white rounded-xl shadow-sm border overflow-hidden">
                <div className="overflow-x-auto no-scrollbar">
                    <table className="w-full text-left text-sm min-w-150">
                        <thead className="bg-slate-50 border-b font-bold"><tr><th className="p-4">Code</th><th className="p-4">Title</th><th className="p-4">Price</th><th className="p-4 text-right">Action</th></tr></thead>
                        <tbody className="divide-y">
                            {modules.map(m => (
                                <tr key={m.id}>
                                    <td className="p-4 font-mono">{m.code}</td>
                                    <td className="p-4">{m.title}</td>
                                    <td className="p-4">€{m.price}</td>
                                    <td className="p-4 text-right"><button onClick={() => handleEditMod(m)} className="text-blue-600 font-bold">Edit</button></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
      )}

      {activeTab === 'email' && (
        <div className="bg-white p-8 rounded-xl shadow-sm border border-gray-200 max-w-2xl">
            <h2 className="text-lg font-bold text-slate-800 mb-2">Notification Routing</h2>
            <div className="space-y-6">
                <div>
                    <label className="block text-[10px] font-black text-gray-400 uppercase mb-1">Contact Form Recipient</label>
                    <input type="email" className="w-full border rounded-lg p-3 text-sm" defaultValue={systemSettings['CONTACT_FORM_RECIPIENT'] || ''} onBlur={(e) => handleSaveSystemSetting('CONTACT_FORM_RECIPIENT', e.target.value)} />
                </div>
                <div>
                    <label className="block text-[10px] font-black text-gray-400 uppercase mb-1">Admissions Recipient</label>
                    <input type="email" className="w-full border rounded-lg p-3 text-sm" defaultValue={systemSettings['ADMISSIONS_RECIPIENT'] || ''} onBlur={(e) => handleSaveSystemSetting('ADMISSIONS_RECIPIENT', e.target.value)} />
                </div>
            </div>
        </div>
      )}
    </div>
  );
}

"use client";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import { useParams, useRouter } from "next/navigation"; // Added useRouter
import Link from "next/link";
import Image from "next/image";
import InputModal from "@/components/modal/InputModal";
import ConfirmationModal from "@/components/modal/ConfirmationModal"; // Added for Delete
import { UploadButton } from "@/app/utils/uploadthing"; 

export default function StudentDetailPage() {
  const params = useParams();
  const router = useRouter();
  const [student, setStudent] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [isEditIdOpen, setIsEditIdOpen] = useState(false);
  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);

  async function fetchStudent() {
    try {
      const res = await fetch(`/api/staff/students/${params.id}`);
      const data = await res.json();
      if (res.ok) {
        setStudent(data.student);
      } else {
        toast.error("Student not found");
      }
    } catch (error) {
      toast.error("Failed to load student data");
    } finally {
      setLoading(false);
    }
  }

  useEffect(() => { fetchStudent(); }, []);

  // --- 1. HANDLE PHOTO UPLOAD ---
  const handlePhotoUpload = async (res: any[]) => {
    if (!res?.[0]?.url) return;
    const url = res[0].url;

    const apiRes = await fetch(`/api/staff/students/${params.id}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ photoUrl: url })
    });

    if (apiRes.ok) {
        toast.success("Official ID Photo Updated");
        fetchStudent();
    } else {
        toast.error("Failed to update photo");
    }
  };

  // --- 2. HANDLE MANUAL ENROLLMENT ---
  const handleEnroll = async () => {
    const res = await fetch(`/api/staff/students/${params.id}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ enrollmentStatus: 'ENROLLED' })
    });

    if (res.ok) {
        toast.success("Student officially ENROLLED");
        fetchStudent();
    } else {
        toast.error("Failed to update status");
    }
  };

  // --- 3. HANDLE STUDENT ID UPDATE ---
  const handleUpdateId = async (newId: string) => {
    const res = await fetch(`/api/staff/students/${params.id}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ studentId: newId })
    });
    if (res.ok) {
        toast.success("Student ID Updated");
        fetchStudent();
    } else {
        toast.error("Failed to update ID");
    }
  };

  // --- 4. HANDLE DELETE ACCOUNT ---
  const handleDelete = async () => {
    const res = await fetch(`/api/staff/students/${params.id}`, {
      method: 'DELETE',
    });

    if (res.ok) {
        toast.success("Account permanently deleted");
        router.push('/staff/students'); // Go back to list
    } else {
        toast.error("Failed to delete account");
    }
  };

  if (loading) return <div className="p-8 text-center text-slate-500 animate-pulse">Loading Profile...</div>;
  if (!student) return <div className="p-8 text-center text-red-500">Student record not found.</div>;

  return (
    <div className="max-w-5xl mx-auto space-y-8 pb-20">
      
      {/* Header Profile Section */}
      <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 flex flex-col md:flex-row justify-between items-start gap-6 relative overflow-hidden">
        <div className="flex gap-6 items-center z-10">
            
            {/* Photo Section with Hover Upload */}
            <div className="relative group w-28 h-28 shrink-0">
                <div className="w-full h-full rounded-full overflow-hidden border-4 border-slate-100 shadow-md relative bg-slate-200">
                    {student.photoUrl ? (
                        <Image 
                          src={student.photoUrl} 
                          alt="Official" 
                          fill
                          className="object-cover" 
                        />
                    ) : (
                        <div className="w-full h-full flex items-center justify-center text-4xl font-bold text-slate-400">
                            {student.user.name?.[0]}
                        </div>
                    )}
                </div>
                
                {/* Upload Overlay */}
                <div className="absolute inset-0 bg-slate-900/70 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer overflow-hidden">
                     <div className="absolute inset-0 flex items-center justify-center">
                        <UploadButton
                            endpoint="adminStudentPhoto"
                            onClientUploadComplete={handlePhotoUpload}
                            onUploadError={(error: Error) => {
                                toast.error(`Upload Failed: ${error.message}`);
                            }}
                            appearance={{
                                button: "w-full h-full bg-transparent text-transparent absolute inset-0 cursor-pointer",
                                container: "w-full h-full",
                                allowedContent: "hidden"
                            }}
                        />
                        <span className="text-white text-[10px] font-black uppercase pointer-events-none relative z-10 text-center px-2">Update Photo</span>
                     </div>
                </div>
            </div>

            <div>
                <h1 className="text-3xl font-black text-slate-900 tracking-tight">{student.user.name}</h1>
                <p className="text-slate-500 font-medium">{student.user.email}</p>
                <div className="flex items-center gap-3 mt-3">
                    <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Student ID</span>
                    <span className="font-mono text-blue-600 font-black bg-blue-50 px-3 py-1 rounded-lg text-sm border border-blue-100">
                        {student.studentId || "UNASSIGNED"}
                    </span>
                    <button onClick={() => setIsEditIdOpen(true)} className="text-[10px] font-bold text-aerojet-sky hover:underline uppercase tracking-tighter">Modify ID</button>
                </div>
            </div>
        </div>
        
        {/* Status Area */}
        <div className="text-left md:text-right w-full md:w-auto border-t md:border-0 pt-4 md:pt-0 z-10">
            <span className="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Academic Standing</span>
            <div className="flex flex-col gap-3 md:items-end">
                <span className={`font-black text-sm uppercase px-3 py-1 rounded-full border ${student.enrollmentStatus === 'ENROLLED' ? 'text-green-600 border-green-200 bg-green-50' : 'text-orange-500 border-orange-200 bg-orange-50'}`}>
                    {student.enrollmentStatus}
                </span>
                
                <div className="flex gap-2">
                    {student.enrollmentStatus !== 'ENROLLED' && (
                        <button 
                            onClick={handleEnroll}
                            className="bg-green-600 hover:bg-green-700 text-white text-[10px] font-black px-4 py-2 rounded-lg shadow-sm transition-all uppercase tracking-widest"
                        >
                            Confirm Enrollment
                        </button>
                    )}
                    <button 
                        onClick={() => setIsDeleteModalOpen(true)}
                        className="bg-white hover:bg-red-50 text-red-500 border border-red-100 text-[10px] font-black px-4 py-2 rounded-lg shadow-sm transition-all uppercase tracking-widest"
                    >
                        Delete Account
                    </button>
                </div>
            </div>
        </div>
      </div>

      <div className="grid md:grid-cols-2 gap-8">
        {/* Applications */}
        <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
            <h3 className="font-black text-slate-900 mb-6 border-b border-slate-50 pb-4 text-xs uppercase tracking-[0.2em]">Active Applications</h3>
            {student.applications.length === 0 ? <p className="text-sm text-slate-400 italic">No course applications on record.</p> : (
                <div className="space-y-3">
                    {student.applications.map((app: any) => (
                        <div key={app.id} className="flex justify-between items-center p-4 bg-slate-50 rounded-xl border border-slate-100">
                            <div>
                                <p className="font-black text-slate-800 text-sm">{app.course.code}</p>
                                <p className="text-[10px] text-slate-500 font-medium uppercase mt-0.5">{app.course.title}</p>
                            </div>
                            <span className={`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-tighter ${app.status === 'APPROVED' ? 'bg-green-500 text-white' : 'bg-orange-400 text-white'}`}>
                                {app.status}
                            </span>
                        </div>
                    ))}
                </div>
            )}
        </div>

        {/* Financials */}
        <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
            <h3 className="font-black text-slate-900 mb-6 border-b border-slate-50 pb-4 text-xs uppercase tracking-[0.2em]">Financial Ledger</h3>
            {student.fees.length === 0 ? <p className="text-sm text-slate-400 italic">No financial transactions found.</p> : (
                <div className="space-y-3">
                    {student.fees.map((fee: any) => (
                        <div key={fee.id} className="flex justify-between items-center p-4 border-b border-slate-50 last:border-0">
                            <div className="max-w-[60%]">
                                <p className="font-bold text-slate-700 text-sm truncate">{fee.description}</p>
                                <p className="text-[10px] text-slate-400 font-medium uppercase tracking-tight">Due: {new Date(fee.dueDate).toLocaleDateString()}</p>
                            </div>
                            <div className="text-right">
                                <p className="font-black text-slate-900 text-sm font-mono">€{fee.amount.toFixed(2)}</p>
                                <span className={`text-[9px] font-black uppercase tracking-widest ${fee.status === 'PAID' ? 'text-green-600' : 'text-red-500'}`}>
                                    {fee.status}
                                </span>
                            </div>
                        </div>
                    ))}
                </div>
            )}
        </div>
      </div>

      {/* --- MODALS --- */}
      <InputModal 
        isOpen={isEditIdOpen}
        onClose={() => setIsEditIdOpen(false)}
        onConfirm={handleUpdateId}
        title="Assign Student ID"
        message="Enter the official Student ID format. This will be used for all certificates and exams."
        defaultValue={student.studentId || ""}
        placeholder="AATA000#"
      />

      <ConfirmationModal
        isOpen={isDeleteModalOpen}
        onClose={() => setIsDeleteModalOpen(false)}
        onConfirm={handleDelete}
        title="Delete Student Account"
        message={`Are you sure you want to permanently delete ${student.user.name}? This will remove all their applications, grades, and financial records. This action cannot be reversed.`}
      />
    </div>
  );
}
"use client";
import { useState, useEffect, useRef } from "react";
import Link from "next/link";
import { toast } from "sonner";
import Papa from 'papaparse';

export default function StudentsListPage() {
  const [students, setStudents] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const fileInputRef = useRef<HTMLInputElement>(null);

  async function fetchStudents() {
    const res = await fetch('/api/staff/students');
    const data = await res.json();
    setStudents(data.students || []);
    setLoading(false);
  }

  useEffect(() => { fetchStudents(); }, []);

  const handleImport = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    // Parse CSV
    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      complete: async (results) => {
        const loadingToast = toast.loading("Processing bulk import...");
        
        try {
          const res = await fetch('/api/staff/students/import', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ students: results.data })
          });

          if (res.ok) {
            const data = await res.json();
            toast.success(`Success! Imported ${data.count} students.`, { id: loadingToast });
            fetchStudents();
          } else {
            toast.error("Import failed. Check column names.", { id: loadingToast });
          }
        } catch (error) {
          toast.error("Network error during import.", { id: loadingToast });
        }
      }
    });
  };

  if (loading) return <div className="p-8">Loading Directory...</div>;

  return (
    <div className="space-y-6">
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <h1 className="text-2xl font-bold text-slate-800">Student Directory</h1>
        
        <div className="flex gap-3">
          {/* Hidden File Input */}
          <input 
            type="file" 
            ref={fileInputRef} 
            onChange={handleImport} 
            accept=".csv" 
            className="hidden" 
          />
          
          <button 
            onClick={() => fileInputRef.current?.click()}
            className="bg-white border border-slate-300 text-slate-700 px-4 py-2 rounded-lg font-bold text-sm hover:bg-slate-50 transition shadow-sm"
          >
            ⇅ Import DreamClass CSV
          </button>

          <Link href="/staff/students/add" className="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-blue-700 transition shadow-md">
            + Add Individual
          </Link>
        </div>
      </div>

      <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div className="overflow-x-auto no-scrollbar">
            <table className="w-full text-left text-sm text-gray-600 min-w-200">
            <thead className="bg-slate-50 text-slate-800 font-bold border-b">
                <tr>
                <th className="p-4">Name</th>
                <th className="p-4">Email</th>
                <th className="p-4">Phone</th>
                <th className="p-4">Student ID</th>
                <th className="p-4 text-right">Action</th>
                </tr>
            </thead>
            <tbody className="divide-y">
                {students.map((student) => (
                <tr key={student.id} className="hover:bg-slate-50">
                    <td className="p-4 font-bold text-slate-700">{student.user.name}</td>
                    <td className="p-4">{student.user.email}</td>
                    <td className="p-4">{student.phone || "-"}</td>
                    <td className="p-4 font-mono text-blue-600 font-bold">{student.studentId || "PENDING"}</td>
                    <td className="p-4 text-right">
                        <Link href={`/staff/students/${student.id}`} className="text-blue-600 hover:underline font-bold text-xs">
                            View Details
                        </Link>
                    </td>
                </tr>
                ))}
            </tbody>
            </table>
        </div>
      </div>
    </div>
  );
}